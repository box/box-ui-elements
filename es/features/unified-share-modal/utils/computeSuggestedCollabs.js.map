{"version":3,"file":"computeSuggestedCollabs.js","names":["fuzzySearch","scoreComparator","optionA","optionB","userScore","computeSuggestedCollabs","contacts","suggestedCollabLookup","inputValue","maxSuggestions","minCharacters","maxGaps","contactIdSet","Set","map","contact","id","toString","suggestedCollabs","Object","values","exactMatches","filter","suggestedCollab","has","exactMatchIds","suggestedFuzzyMatches","length","option","includes","nameMatches","name","emailAddress","email","emailAlias","substring","indexOf","emailMatches","suggestedResult","sort","slice","suggestedResultIds","suggestion","otherResults"],"sources":["../../../../src/features/unified-share-modal/utils/computeSuggestedCollabs.js"],"sourcesContent":["/**\n * @flow\n * @file Suggested Collaborator utility functions\n * @author Box\n */\nimport type { SuggestedCollab, SuggestedCollabLookup } from '../flowTypes';\nimport fuzzySearch from '../../../utils/fuzzySearch';\n\nfunction scoreComparator(optionA: SuggestedCollab, optionB: SuggestedCollab): number {\n    return optionB.userScore - optionA.userScore;\n}\n\n/**\n * Function to compute suggested collaborators given a list of contacts and cached suggested collaborators.\n * Used by input components to help augment API results with cached suggestions using a fuzzy search.\n */\nfunction computeSuggestedCollabs<C: { id: string }>(\n    contacts: Array<C>,\n    suggestedCollabLookup: SuggestedCollabLookup,\n    inputValue: string,\n    maxSuggestions: number = 3,\n    minCharacters: number = 3,\n    maxGaps: number = 2,\n): [Array<SuggestedCollab>, Array<C>] {\n    const contactIdSet = new Set(contacts.map(contact => contact.id.toString()));\n    // $FlowFixMe\n    const suggestedCollabs: Array<SuggestedCollab> = Object.values(suggestedCollabLookup);\n    const exactMatches: Array<SuggestedCollab> = suggestedCollabs.filter(\n        suggestedCollab => suggestedCollab.id && contactIdSet.has(suggestedCollab.id.toString()),\n    );\n    const exactMatchIds = exactMatches.map(suggestedCollab => suggestedCollab.id.toString());\n\n    const suggestedFuzzyMatches =\n        exactMatches.length >= maxSuggestions\n            ? []\n            : suggestedCollabs.filter((option: SuggestedCollab) => {\n                  if (!inputValue || exactMatchIds.includes(option.id.toString())) {\n                      return false;\n                  }\n                  const nameMatches = fuzzySearch(inputValue, option.name, minCharacters, maxGaps);\n                  const emailAddress = option.email || '';\n                  const emailAlias = emailAddress.substring(0, emailAddress.indexOf('@'));\n                  const emailMatches = inputValue.length >= minCharacters && emailAlias.includes(inputValue);\n                  return nameMatches || emailMatches;\n              });\n\n    // combine both lists preferring exact id matches over fuzzy matches\n    const suggestedResult = [\n        ...exactMatches.sort(scoreComparator),\n        ...suggestedFuzzyMatches.sort(scoreComparator),\n    ].slice(0, maxSuggestions);\n    const suggestedResultIds = suggestedResult.map(suggestion => suggestion.id);\n    const otherResults = contacts.filter(contact => !suggestedResultIds.includes(contact.id));\n\n    return [suggestedResult, otherResults];\n}\n\nexport default computeSuggestedCollabs;\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,WAAW,MAAM,4BAA4B;AAEpD,SAASC,eAAeA,CAACC,OAAwB,EAAEC,OAAwB,EAAU;EACjF,OAAOA,OAAO,CAACC,SAAS,GAAGF,OAAO,CAACE,SAAS;AAChD;;AAEA;AACA;AACA;AACA;AACA,SAASC,uBAAuBA,CAC5BC,QAAkB,EAClBC,qBAA4C,EAC5CC,UAAkB,EAClBC,cAAsB,GAAG,CAAC,EAC1BC,aAAqB,GAAG,CAAC,EACzBC,OAAe,GAAG,CAAC,EACe;EAClC,MAAMC,YAAY,GAAG,IAAIC,GAAG,CAACP,QAAQ,CAACQ,GAAG,CAACC,OAAO,IAAIA,OAAO,CAACC,EAAE,CAACC,QAAQ,CAAC,CAAC,CAAC,CAAC;EAC5E;EACA,MAAMC,gBAAwC,GAAGC,MAAM,CAACC,MAAM,CAACb,qBAAqB,CAAC;EACrF,MAAMc,YAAoC,GAAGH,gBAAgB,CAACI,MAAM,CAChEC,eAAe,IAAIA,eAAe,CAACP,EAAE,IAAIJ,YAAY,CAACY,GAAG,CAACD,eAAe,CAACP,EAAE,CAACC,QAAQ,CAAC,CAAC,CAC3F,CAAC;EACD,MAAMQ,aAAa,GAAGJ,YAAY,CAACP,GAAG,CAACS,eAAe,IAAIA,eAAe,CAACP,EAAE,CAACC,QAAQ,CAAC,CAAC,CAAC;EAExF,MAAMS,qBAAqB,GACvBL,YAAY,CAACM,MAAM,IAAIlB,cAAc,GAC/B,EAAE,GACFS,gBAAgB,CAACI,MAAM,CAAEM,MAAuB,IAAK;IACjD,IAAI,CAACpB,UAAU,IAAIiB,aAAa,CAACI,QAAQ,CAACD,MAAM,CAACZ,EAAE,CAACC,QAAQ,CAAC,CAAC,CAAC,EAAE;MAC7D,OAAO,KAAK;IAChB;IACA,MAAMa,WAAW,GAAG9B,WAAW,CAACQ,UAAU,EAAEoB,MAAM,CAACG,IAAI,EAAErB,aAAa,EAAEC,OAAO,CAAC;IAChF,MAAMqB,YAAY,GAAGJ,MAAM,CAACK,KAAK,IAAI,EAAE;IACvC,MAAMC,UAAU,GAAGF,YAAY,CAACG,SAAS,CAAC,CAAC,EAAEH,YAAY,CAACI,OAAO,CAAC,GAAG,CAAC,CAAC;IACvE,MAAMC,YAAY,GAAG7B,UAAU,CAACmB,MAAM,IAAIjB,aAAa,IAAIwB,UAAU,CAACL,QAAQ,CAACrB,UAAU,CAAC;IAC1F,OAAOsB,WAAW,IAAIO,YAAY;EACtC,CAAC,CAAC;;EAEZ;EACA,MAAMC,eAAe,GAAG,CACpB,GAAGjB,YAAY,CAACkB,IAAI,CAACtC,eAAe,CAAC,EACrC,GAAGyB,qBAAqB,CAACa,IAAI,CAACtC,eAAe,CAAC,CACjD,CAACuC,KAAK,CAAC,CAAC,EAAE/B,cAAc,CAAC;EAC1B,MAAMgC,kBAAkB,GAAGH,eAAe,CAACxB,GAAG,CAAC4B,UAAU,IAAIA,UAAU,CAAC1B,EAAE,CAAC;EAC3E,MAAM2B,YAAY,GAAGrC,QAAQ,CAACgB,MAAM,CAACP,OAAO,IAAI,CAAC0B,kBAAkB,CAACZ,QAAQ,CAACd,OAAO,CAACC,EAAE,CAAC,CAAC;EAEzF,OAAO,CAACsB,eAAe,EAAEK,YAAY,CAAC;AAC1C;AAEA,eAAetC,uBAAuB","ignoreList":[]}