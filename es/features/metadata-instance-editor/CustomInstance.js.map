{"version":3,"file":"CustomInstance.js","names":["React","isEqual","CustomNewField","CustomMetadataField","EmptyContent","FIELD_TYPE_STRING","CustomInstance","PureComponent","getDerivedStateFromProps","data","properties","_objectSpread","constructor","props","_defineProperty","key","value","canEdit","onFieldChange","onFieldRemove","setState","prevState","isAddFieldVisible","state","render","fields","Object","keys","canAddFields","length","createElement","Fragment","map","index","dataKey","dataValue","isLast","onAdd","onAddFieldToggle","onChange","onRemove","isCancellable","onCancel"],"sources":["../../../src/features/metadata-instance-editor/CustomInstance.js"],"sourcesContent":["// @flow\nimport * as React from 'react';\nimport isEqual from 'lodash/isEqual';\n\nimport CustomNewField from './CustomInstanceNewField';\nimport CustomMetadataField from '../metadata-instance-fields/CustomMetadataField';\nimport EmptyContent from './EmptyContent';\nimport { FIELD_TYPE_STRING } from '../metadata-instance-fields/constants';\nimport type { MetadataFieldValue, MetadataFields } from '../../common/types/metadata';\n\ntype Props = {\n    canEdit: boolean,\n    data: MetadataFields,\n    onFieldChange?: (key: string, value: MetadataFieldValue, type: string) => void,\n    onFieldRemove?: (key: string) => void,\n};\n\ntype State = {\n    isAddFieldVisible: boolean,\n    properties: MetadataFields,\n};\n\nclass CustomInstance extends React.PureComponent<Props, State> {\n    static defaultProps = {\n        canEdit: true,\n        data: {},\n    };\n\n    static getDerivedStateFromProps({ data }: Props, { properties }: State): any {\n        if (!isEqual(data, properties)) {\n            return {\n                properties: { ...data },\n            };\n        }\n\n        return null;\n    }\n\n    constructor(props: Props) {\n        super(props);\n        this.state = {\n            isAddFieldVisible: false,\n            properties: { ...props.data },\n        };\n    }\n\n    /**\n     * Adds/updates a new metadata key value pair\n     *\n     * @param {string} key - metadata key\n     * @param {string} value - metadata value\n     * @return {void}\n     */\n    onFieldChange = (key: string, value: MetadataFieldValue) => {\n        const { canEdit, onFieldChange }: Props = this.props;\n        if (canEdit && onFieldChange) {\n            onFieldChange(key, value, FIELD_TYPE_STRING);\n        }\n    };\n\n    /**\n     * Adds/updates a new metadata key value pair\n     *\n     * @param {string} key - metadata key\n     * @param {string} value - metadata value\n     * @return {void}\n     */\n    onFieldRemove = (key: string) => {\n        const { canEdit, onFieldRemove }: Props = this.props;\n        if (canEdit && onFieldRemove) {\n            onFieldRemove(key);\n        }\n    };\n\n    /**\n     * Shows the add new field field\n     *\n     * @return {void}\n     */\n    onAddFieldToggle = () => {\n        this.setState(prevState => ({\n            isAddFieldVisible: !prevState.isAddFieldVisible,\n        }));\n    };\n\n    render() {\n        const { canEdit }: Props = this.props;\n        const { isAddFieldVisible, properties }: State = this.state;\n        const fields = Object.keys(properties);\n        const canAddFields = canEdit && (isAddFieldVisible || fields.length === 0);\n\n        return (\n            <>\n                {fields.map((key, index) => (\n                    <CustomMetadataField\n                        key={key}\n                        canEdit={canEdit}\n                        dataKey={key}\n                        dataValue={properties[key]}\n                        isLast={!isAddFieldVisible && index === fields.length - 1}\n                        onAdd={this.onAddFieldToggle}\n                        onChange={this.onFieldChange}\n                        onRemove={this.onFieldRemove}\n                    />\n                ))}\n                {!canAddFields && fields.length === 0 && <EmptyContent />}\n                {canAddFields && (\n                    <CustomNewField\n                        isCancellable={fields.length !== 0}\n                        onAdd={this.onFieldChange}\n                        onCancel={this.onAddFieldToggle}\n                        properties={this.props.data}\n                    />\n                )}\n            </>\n        );\n    }\n}\n\nexport default CustomInstance;\n"],"mappings":"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","ignoreList":[]}