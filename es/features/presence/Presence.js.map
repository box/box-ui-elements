{"version":3,"file":"Presence.js","names":["React","Component","classNames","PropTypes","FormattedMessage","injectIntl","Button","messages","PresenceAvatarList","PresenceCollaboratorsList","ARROW_DOWN","ENTER","SPACE","collaboratorsPropType","flyoutPositionPropType","Flyout","Overlay","GROWTH_382_EXPERIMENT_BUCKET","GROWTH_382_AUTOFLY_CLASS","GROWTH_382_AUTOFLY_CLASS_FIRST_LOAD","Presence","constructor","args","_defineProperty","isDropdownActive","showActivityPrompt","Boolean","props","collaborators","length","onClickViewCollaborators","experimentBucket","el","presenceContainerEl","event","onFlyoutOpen","setState","onFlyoutClose","stopPropagation","preventDefault","click","key","openDropDown","stopPropagationAndPreventDefault","render","avatarAttributes","className","closeOnWindowBlur","constrainToScrollParent","constrainToWindow","containerAttributes","flyoutPosition","getLinkCallback","intl","inviteCallback","maxAdditionalCollaboratorsNum","maxDisplayedAvatars","onAvatarMouseEnter","onAvatarMouseLeave","onFlyoutScroll","state","onAccessStatsRequested","requestAccessStats","createElement","href","onClick","previewPresenceFlyoutAccessStatsLink","overlayClassNames","overlayContent","Fragment","previewPresenceFlyoutCopy","_showRecentsFlyout","previewPresenceFlyoutActivityCTA","onScroll","isVisibleByDefault","onClose","_handleOverlayClose","onOpen","_handleOverlayOpen","position","_extends","ref","saveRefToContainer","formatMessage","toggleButtonLabel","hideTooltips","maxAdditionalCollaborators","onKeyDown","handleKeyDown","shouldDefaultFocus","object","string","arrayOf","isRequired","func","number","bool","any","PresenceComponent"],"sources":["../../../src/features/presence/Presence.js"],"sourcesContent":["import React, { Component } from 'react';\nimport classNames from 'classnames';\nimport PropTypes from 'prop-types';\nimport { FormattedMessage, injectIntl } from 'react-intl';\nimport Button from '../../components/button';\nimport messages from './messages';\nimport PresenceAvatarList from './PresenceAvatarList';\nimport PresenceCollaboratorsList from './PresenceCollaboratorsList';\nimport { ARROW_DOWN, ENTER, SPACE } from '../../common/keyboard-events';\nimport { collaboratorsPropType, flyoutPositionPropType } from './propTypes';\nimport { Flyout, Overlay } from '../../components/flyout';\nimport {\n    GROWTH_382_EXPERIMENT_BUCKET,\n    GROWTH_382_AUTOFLY_CLASS,\n    GROWTH_382_AUTOFLY_CLASS_FIRST_LOAD,\n} from './constants';\nimport './Presence.scss';\n\nclass Presence extends Component {\n    /* eslint-disable no-underscore-dangle */\n    static propTypes = {\n        /** Addtional attributes for avatar container */\n        avatarAttributes: PropTypes.object,\n        className: PropTypes.string,\n        collaborators: PropTypes.arrayOf(collaboratorsPropType).isRequired,\n        /** Addtional attributes for presence container */\n        containerAttributes: PropTypes.object,\n        /** Get Link callback */\n        getLinkCallback: PropTypes.func,\n        /** Invite button callback */\n        inviteCallback: PropTypes.func,\n        /** Maximum number of avatars to display before showing a +{n} avatar */\n        maxDisplayedAvatars: PropTypes.number,\n        /** Maximum number of collaborators before displaying a {maxAdditionalCollaboratorsNum}+ avatar */\n        maxAdditionalCollaboratorsNum: PropTypes.number,\n        /** Callback funtion for avatar mouseEnter, argument: id of user */\n        onAvatarMouseEnter: PropTypes.func,\n        /** Callback function for avatar mouseLeave */\n        onAvatarMouseLeave: PropTypes.func,\n        /** Callback funtion for Flyout events, argument: SyntheticEvent */\n        onFlyoutClose: PropTypes.func,\n        onFlyoutOpen: PropTypes.func,\n        onFlyoutScroll: PropTypes.func,\n        /** GROWTH-382 bucketing */\n        experimentBucket: PropTypes.string,\n        /** GROWTH-382 broadcast that the user wants to view stats from the flyout */\n        onAccessStatsRequested: PropTypes.func,\n        /** GROWTH-382 log that the user wants to view collaborators from the flyout */\n        onClickViewCollaborators: PropTypes.func,\n        /** Option to change the orientation of the dropdown. MUST be: bottom-right, bottom-left, bottom-center etc. or in this specific format */\n        flyoutPosition: flyoutPositionPropType,\n        /** Sets the tether constraint to scrollParent for the flyout */\n        constrainToScrollParent: PropTypes.bool,\n        /** Sets the tether constraint to window for the flyout */\n        constrainToWindow: PropTypes.bool,\n        /** Closes the flyout when window loses focus */\n        closeOnWindowBlur: PropTypes.bool,\n        intl: PropTypes.any,\n    };\n\n    static defaultProps = {\n        className: '',\n        maxDisplayedAvatars: 3,\n        maxAdditionalCollaboratorsNum: 99,\n        experimentBucket: null,\n        flyoutPosition: 'bottom-left',\n        constrainToScrollParent: true,\n        constrainToWindow: false,\n        closeOnWindowBlur: false,\n    };\n\n    state = {\n        isDropdownActive: false,\n        showActivityPrompt: Boolean(\n            this.props.collaborators.length &&\n                this.props.onClickViewCollaborators &&\n                this.props.experimentBucket === GROWTH_382_EXPERIMENT_BUCKET,\n        ),\n    };\n\n    saveRefToContainer = el => {\n        this.presenceContainerEl = el;\n    };\n\n    _handleOverlayOpen = event => {\n        const { onFlyoutOpen } = this.props;\n        this.setState({\n            isDropdownActive: true,\n        });\n        if (onFlyoutOpen) {\n            onFlyoutOpen(event);\n        }\n    };\n\n    _handleOverlayClose = event => {\n        const { onFlyoutClose } = this.props;\n        this.setState({\n            isDropdownActive: false,\n        });\n        if (onFlyoutClose) {\n            onFlyoutClose(event);\n        }\n    };\n\n    stopPropagationAndPreventDefault = event => {\n        event.stopPropagation();\n        event.preventDefault();\n    };\n\n    openDropDown = () => {\n        if (this.presenceContainerEl) {\n            this.presenceContainerEl.click();\n        }\n    };\n\n    handleKeyDown = event => {\n        switch (event.key) {\n            case ARROW_DOWN:\n            case ENTER:\n            case SPACE:\n                this.openDropDown();\n                this.stopPropagationAndPreventDefault(event);\n                break;\n\n            default:\n                break;\n        }\n    };\n\n    // GROWTH-382 click through the first CTA, spawn the normal Presence dropdown\n    _showRecentsFlyout = event => {\n        const { onClickViewCollaborators } = this.props;\n        onClickViewCollaborators();\n        this.stopPropagationAndPreventDefault(event);\n        this.setState({ showActivityPrompt: false });\n    };\n\n    render() {\n        const {\n            avatarAttributes,\n            className,\n            closeOnWindowBlur,\n            collaborators,\n            constrainToScrollParent,\n            constrainToWindow,\n            containerAttributes,\n            flyoutPosition,\n            getLinkCallback,\n            intl,\n            inviteCallback,\n            maxAdditionalCollaboratorsNum,\n            maxDisplayedAvatars,\n            onAvatarMouseEnter,\n            onAvatarMouseLeave,\n            onFlyoutScroll,\n        } = this.props;\n\n        const { isDropdownActive } = this.state;\n\n        // GROWTH-382\n        const { experimentBucket, onAccessStatsRequested } = this.props;\n        const { showActivityPrompt } = this.state;\n        let requestAccessStats = null;\n\n        if (!showActivityPrompt && experimentBucket === GROWTH_382_EXPERIMENT_BUCKET) {\n            requestAccessStats = (\n                // eslint-disable-next-line jsx-a11y/anchor-is-valid\n                <a className=\"presence-overlay-request-stats\" href=\"#\" onClick={onAccessStatsRequested}>\n                    <FormattedMessage {...messages.previewPresenceFlyoutAccessStatsLink} />\n                </a>\n            );\n        }\n\n        const overlayClassNames = classNames('presence-overlay', {\n            [GROWTH_382_AUTOFLY_CLASS]: experimentBucket && !showActivityPrompt,\n            [GROWTH_382_AUTOFLY_CLASS_FIRST_LOAD]: experimentBucket && showActivityPrompt,\n        });\n\n        const overlayContent = showActivityPrompt ? (\n            <>\n                <FormattedMessage {...messages.previewPresenceFlyoutCopy} />\n                <Button className=\"btn-primary\" onClick={this._showRecentsFlyout}>\n                    <FormattedMessage {...messages.previewPresenceFlyoutActivityCTA} />\n                </Button>\n            </>\n        ) : (\n            <PresenceCollaboratorsList\n                collaborators={collaborators}\n                experimentBucket={experimentBucket}\n                getLinkCallback={getLinkCallback}\n                inviteCallback={inviteCallback}\n                onScroll={onFlyoutScroll}\n            />\n        );\n        return (\n            <Flyout\n                className={`presence ${className}`}\n                closeOnWindowBlur={closeOnWindowBlur}\n                constrainToScrollParent={constrainToScrollParent}\n                constrainToWindow={constrainToWindow}\n                isVisibleByDefault={showActivityPrompt}\n                onClose={this._handleOverlayClose}\n                onOpen={this._handleOverlayOpen}\n                position={flyoutPosition}\n            >\n                <PresenceAvatarList\n                    ref={this.saveRefToContainer}\n                    aria-label={intl.formatMessage(messages.toggleButtonLabel)}\n                    avatarAttributes={avatarAttributes}\n                    className={classNames('presence-avatar-container', { 'dropdown-active': isDropdownActive })}\n                    collaborators={collaborators}\n                    hideTooltips={isDropdownActive}\n                    maxAdditionalCollaborators={maxAdditionalCollaboratorsNum}\n                    maxDisplayedAvatars={maxDisplayedAvatars}\n                    onAvatarMouseEnter={onAvatarMouseEnter}\n                    onAvatarMouseLeave={onAvatarMouseLeave}\n                    onKeyDown={this.handleKeyDown}\n                    {...containerAttributes}\n                />\n                <Overlay className={overlayClassNames} shouldDefaultFocus={false}>\n                    {overlayContent}\n                    {requestAccessStats}\n                </Overlay>\n            </Flyout>\n        );\n    }\n}\n\nexport { Presence as PresenceComponent };\nexport default injectIntl(Presence);\n"],"mappings":"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","ignoreList":[]}