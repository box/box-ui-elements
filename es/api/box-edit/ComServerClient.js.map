{"version":3,"file":"ComServerClient.js","names":["Browser","BROWSER_CONSTANTS","promiseOne","ActiveXChannel","Channel","HTTPChannel","SafariChannel","CONSTANTS","MIN_FIREFOX_VERSION_FOR_MIXED_CONTENT","MIN_EDGE_16_VERSION_FOR_MIXED_CONTENT","MIN_EDGE_VERSION_FOR_MIXED_CONTENT","REQUEST_TIMEOUT_MS","boxToolsLogData","createHTTPChannel","appName","BOX_UNSECURE_LOCAL_BASE_URL","CREATED_STATUS","HTTP_CHANNEL_NAME","http_channel_status","createSafariChannel","safari_channel_status","createActiveXChannel","activex_channel_status","createSynchronousActiveXChannel","isSupportedMSEdgeVersion","EDGE","isMinBrowser","getVersion","startsWith","isUnsupportedMSEdgeVersion","isEdge","isMixedContentAllowedOnLocalhost","CHROME","FIREFOX","isSupportedSafariVersion","SAFARI","isUnsupportedSafariVersion","isSafari","isFirefoxWithExtensionsCapability","isFirefox","isSupportedIEVersion","IE","isSupportedIEAndBoxToolsPluginAvailable","isIEAndSpecificBrowserPluginSupported","BOX_TOOLS_PLUGIN_NAME","comServerErrorGenerator","reject","BOX_EDIT_NOT_SUPPORTED_ERROR","BOX_EDIT_SAFARI_ERROR","BOX_EDIT_UNINSTALLED_ERROR","BOX_EDIT_UPGRADE_BROWSER_ERROR","errorMessageID","isChrome","error_message","Error","validateAndReturnBrowserToComServerTimeout","customTimeoutMS","timeoutMS","Math","floor","shortenAndReturnComServerToApplicationTimeout","browserToComServerTimeoutMS","timeoutSec","toFixed","initBoxToolsLogData","browserName","getName","browserVersion","UNCREATED_STATUS","box_tools_version","browser_name","browser_version","installation_type","https_channel_status","ComServerClient","constructor","_defineProperty","channels","isInitialized","push","concat","getComServerStatus","ACTIVE_STATUS","comServerToApplicationTimeoutSec","shouldRejectPromiseDueToUnSupportedMSEdgeOrVersion","Promise","resolve","call","length","map","channel","then","res","activeChannel","version","channelName","catch","bind","sendRequest","requestData","isSynchronous","sendCommand","data"],"sources":["../../../src/api/box-edit/ComServerClient.js"],"sourcesContent":["// @flow\n\nimport Browser, { BROWSER_CONSTANTS } from './BrowserUtils';\n\nimport promiseOne from './promise';\nimport ActiveXChannel from './ActiveXChannel';\nimport Channel from './Channel';\nimport HTTPChannel from './HTTPChannel';\nimport SafariChannel from './SafariChannel';\nimport CONSTANTS from './constants';\n\nconst MIN_FIREFOX_VERSION_FOR_MIXED_CONTENT = 55;\nconst MIN_EDGE_16_VERSION_FOR_MIXED_CONTENT = '16.16299';\nconst MIN_EDGE_VERSION_FOR_MIXED_CONTENT = '17.17134';\nconst REQUEST_TIMEOUT_MS = 5000;\n\nlet boxToolsLogData: {\n    activex_channel_status: string,\n    box_tools_version: ?string,\n    browser_name: string,\n    browser_version: string,\n    error_message: ?string,\n    http_channel_status: string,\n    https_channel_status: string,\n    installation_type: ?string,\n    safari_channel_status: string,\n};\n\nfunction createHTTPChannel(appName: string): HTTPChannel {\n    const { BOX_UNSECURE_LOCAL_BASE_URL, CREATED_STATUS, HTTP_CHANNEL_NAME } = CONSTANTS;\n\n    boxToolsLogData.http_channel_status = CREATED_STATUS;\n\n    return new HTTPChannel(appName, BOX_UNSECURE_LOCAL_BASE_URL, HTTP_CHANNEL_NAME);\n}\n\nfunction createSafariChannel(appName: string): SafariChannel {\n    const { CREATED_STATUS } = CONSTANTS;\n\n    boxToolsLogData.safari_channel_status = CREATED_STATUS;\n\n    return new SafariChannel(appName);\n}\n\nfunction createActiveXChannel(appName: string): ActiveXChannel {\n    const { CREATED_STATUS } = CONSTANTS;\n\n    boxToolsLogData.activex_channel_status = CREATED_STATUS;\n\n    return new ActiveXChannel(appName, false);\n}\n\n/**\n * Returns an instance of the ActiveX Channel that runs commands in the ActiveX process synchronously.\n * This is required for running in certain embedded IE-based webviews.\n */\nfunction createSynchronousActiveXChannel(appName): ActiveXChannel {\n    const { CREATED_STATUS } = CONSTANTS;\n\n    boxToolsLogData.activex_channel_status = CREATED_STATUS;\n    return new ActiveXChannel(appName, true);\n}\n\n/**\n * Returns TRUE for MS Edge versions 17.17692+ OR\n * Returns TRUE for MS Edge version 16 greater than 16.16299\n * @returns {boolean}\n */\nfunction isSupportedMSEdgeVersion() {\n    const { EDGE } = BROWSER_CONSTANTS;\n    return (\n        Browser.isMinBrowser(EDGE, MIN_EDGE_VERSION_FOR_MIXED_CONTENT) ||\n        (Browser.isMinBrowser(EDGE, MIN_EDGE_16_VERSION_FOR_MIXED_CONTENT) && Browser.getVersion().startsWith('16.'))\n    );\n}\n\nfunction isUnsupportedMSEdgeVersion() {\n    return Browser.isEdge() && !isSupportedMSEdgeVersion();\n}\n\nfunction isMixedContentAllowedOnLocalhost() {\n    const { CHROME, FIREFOX } = BROWSER_CONSTANTS;\n    // TODO can we do this with feature detection rather than sniffing?\n    return (\n        Browser.isMinBrowser(CHROME, 53) ||\n        Browser.isMinBrowser(FIREFOX, MIN_FIREFOX_VERSION_FOR_MIXED_CONTENT) ||\n        isSupportedMSEdgeVersion()\n    );\n}\n\nfunction isSupportedSafariVersion() {\n    return Browser.isMinBrowser(BROWSER_CONSTANTS.SAFARI, 10);\n}\n\nfunction isUnsupportedSafariVersion() {\n    return Browser.isSafari() && !isSupportedSafariVersion();\n}\n\n/**\n * @TODO: (2018-07-24) Rename this to isFirefoxWithoutMixedContentCapability\n * since we do not have an Extension planned for the Firefox versions below 55.\n */\nfunction isFirefoxWithExtensionsCapability() {\n    return (\n        Browser.isFirefox() && !Browser.isMinBrowser(BROWSER_CONSTANTS.FIREFOX, MIN_FIREFOX_VERSION_FOR_MIXED_CONTENT)\n    );\n}\n\n/**\n * Checks if the IE version is supported\n * @returns {boolean}\n */\nfunction isSupportedIEVersion() {\n    return Browser.isMinBrowser(BROWSER_CONSTANTS.IE, 11);\n}\n\n/**\n * Checks if the user is on IE 11 and has a specific ActiveXObject plugin loaded on the page\n */\nfunction isSupportedIEAndBoxToolsPluginAvailable() {\n    // Browser Plugins Support is the check for ActiveX-like plugins\n    return isSupportedIEVersion() && Browser.isIEAndSpecificBrowserPluginSupported(CONSTANTS.BOX_TOOLS_PLUGIN_NAME);\n}\n\n/**\n * Analyze the cause of Channel failure and return a rejected Promise with an error message\n */\nfunction comServerErrorGenerator(reject) {\n    const {\n        BOX_EDIT_NOT_SUPPORTED_ERROR,\n        BOX_EDIT_SAFARI_ERROR,\n        BOX_EDIT_UNINSTALLED_ERROR,\n        BOX_EDIT_UPGRADE_BROWSER_ERROR,\n    } = CONSTANTS;\n    let errorMessageID = BOX_EDIT_NOT_SUPPORTED_ERROR;\n\n    if (isMixedContentAllowedOnLocalhost()) {\n        errorMessageID = BOX_EDIT_UNINSTALLED_ERROR;\n    } else if (isSupportedIEVersion()) {\n        errorMessageID = BOX_EDIT_UNINSTALLED_ERROR;\n    } else if (\n        Browser.isFirefox() ||\n        Browser.isChrome() ||\n        isUnsupportedSafariVersion() ||\n        isUnsupportedMSEdgeVersion()\n        // Show UPGRADE message when MS Edge support has been enabled\n    ) {\n        errorMessageID = BOX_EDIT_UPGRADE_BROWSER_ERROR;\n    } else if (isSupportedSafariVersion()) {\n        errorMessageID = BOX_EDIT_SAFARI_ERROR;\n    }\n\n    boxToolsLogData.error_message = errorMessageID;\n    return reject(new Error(errorMessageID));\n}\n\n/**\n * Default returns the timeout value of 5000ms, if a timeout is not passed.\n * When passed validates it to be a number and parse it to the lower integer value\n *\n * @param {number} [customTimeoutMS] optional field to override the timeout value passed in miliseconds\n * @returns {number}\n */\nfunction validateAndReturnBrowserToComServerTimeout(customTimeoutMS) {\n    let timeoutMS = REQUEST_TIMEOUT_MS;\n\n    // validate timeout is a positive number\n    if (typeof customTimeoutMS === 'number' && customTimeoutMS >= 0) {\n        timeoutMS = Math.floor(customTimeoutMS);\n    }\n\n    return timeoutMS;\n}\n\n/**\n * Returns reduced timeout converted to seconds\n * We need to use a shortened timeout for the connection between local com server and application,\n * so that we will receive a message that that connection has timed out,\n * before the connection between the browser and the local com server itself times out.\n */\nfunction shortenAndReturnComServerToApplicationTimeout(browserToComServerTimeoutMS) {\n    let timeoutSec = +(browserToComServerTimeoutMS / 1000).toFixed(2);\n\n    if (browserToComServerTimeoutMS < 2) {\n        timeoutSec /= 2;\n    } else {\n        timeoutSec -= 1;\n    }\n\n    return timeoutSec;\n}\n\nfunction initBoxToolsLogData() {\n    const browserName = Browser.getName();\n    const browserVersion = Browser.getVersion();\n    const { UNCREATED_STATUS } = CONSTANTS;\n\n    boxToolsLogData = {\n        box_tools_version: null,\n        browser_name: browserName,\n        browser_version: browserVersion,\n        error_message: null,\n        installation_type: null,\n        http_channel_status: UNCREATED_STATUS,\n        https_channel_status: UNCREATED_STATUS,\n        activex_channel_status: UNCREATED_STATUS,\n        safari_channel_status: UNCREATED_STATUS,\n    };\n}\n\nclass ComServerClient {\n    activeChannel: Channel;\n\n    channels: Array<Channel>;\n\n    isInitialized: boolean = false;\n\n    browser: string;\n\n    constructor(appName: string) {\n        this.channels = [];\n\n        this.isInitialized = true;\n        initBoxToolsLogData();\n\n        if (isMixedContentAllowedOnLocalhost()) {\n            this.channels.push(createHTTPChannel(appName));\n        } else if (isSupportedSafariVersion()) {\n            this.channels.push(createSafariChannel(appName));\n        } else if (isSupportedIEAndBoxToolsPluginAvailable()) {\n            this.channels.push(createActiveXChannel(appName));\n        } else if (isFirefoxWithExtensionsCapability() || isUnsupportedMSEdgeVersion()) {\n            // @NOTE (2018-07-24) No Action - Trying all channels is not an option in this case\n            // @TODO (2018-07-24) Remove this empty case from here?\n        } else {\n            // @NOTE: (2018-01-16) Trying all channels in case of custom useragent\n            this.channels = this.channels.concat([\n                createHTTPChannel(appName),\n                createSafariChannel(appName),\n                createSynchronousActiveXChannel(appName),\n            ]);\n        }\n    }\n\n    getComServerStatus(customTimeoutMS: ?number): Promise<any> {\n        const { ACTIVE_STATUS } = CONSTANTS;\n\n        const browserToComServerTimeoutMS = validateAndReturnBrowserToComServerTimeout(customTimeoutMS);\n        const comServerToApplicationTimeoutSec = shortenAndReturnComServerToApplicationTimeout(\n            browserToComServerTimeoutMS,\n        );\n\n        const shouldRejectPromiseDueToUnSupportedMSEdgeOrVersion = isUnsupportedMSEdgeVersion();\n\n        return new Promise((resolve, reject) => {\n            if (shouldRejectPromiseDueToUnSupportedMSEdgeOrVersion) {\n                return comServerErrorGenerator.call(null, reject);\n            }\n\n            if (!this.channels.length) {\n                return comServerErrorGenerator.call(null, reject);\n            }\n\n            return promiseOne(\n                this.channels.map(channel => {\n                    return channel\n                        .getComServerStatus(browserToComServerTimeoutMS, comServerToApplicationTimeoutSec)\n                        .then(res => {\n                            this.activeChannel = channel;\n\n                            if (res) {\n                                boxToolsLogData.installation_type = res.installation_type;\n                                boxToolsLogData.box_tools_version = res.version;\n                            }\n\n                            boxToolsLogData[`${channel.channelName}_status`] = ACTIVE_STATUS;\n                            return resolve(res);\n                        });\n                }),\n            ).catch(comServerErrorGenerator.bind(null, reject));\n        });\n    }\n\n    // TODO isSynchronous? do we need it?\n    sendRequest(requestData: string, isSynchronous: ?boolean, customTimeoutMS: ?number): Object {\n        const browserToComServerTimeoutMS = validateAndReturnBrowserToComServerTimeout(customTimeoutMS);\n        const comServerToApplicationTimeoutSec = shortenAndReturnComServerToApplicationTimeout(\n            browserToComServerTimeoutMS,\n        );\n\n        if (this.activeChannel) {\n            return this.activeChannel.sendRequest(\n                requestData,\n                browserToComServerTimeoutMS,\n                comServerToApplicationTimeoutSec,\n            );\n        }\n\n        return this.getComServerStatus().then(() => {\n            return this.activeChannel.sendRequest(\n                requestData,\n                browserToComServerTimeoutMS,\n                comServerToApplicationTimeoutSec,\n            );\n        });\n    }\n\n    sendCommand(data: string, customTimeoutMS: number): Promise<any> {\n        const browserToComServerTimeoutMS = validateAndReturnBrowserToComServerTimeout(customTimeoutMS);\n        const comServerToApplicationTimeoutSec = shortenAndReturnComServerToApplicationTimeout(\n            browserToComServerTimeoutMS,\n        );\n\n        if (this.activeChannel) {\n            return this.activeChannel.sendCommand(data, browserToComServerTimeoutMS, comServerToApplicationTimeoutSec);\n        }\n\n        return this.getComServerStatus().then(() => {\n            return this.activeChannel.sendCommand(data, browserToComServerTimeoutMS, comServerToApplicationTimeoutSec);\n        });\n    }\n}\n\nexport default ComServerClient;\n"],"mappings":"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","ignoreList":[]}