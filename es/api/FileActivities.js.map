{"version":3,"file":"FileActivities.js","names":["Base","ERROR_CODE_FETCH_ACTIVITY","FILE_ACTIVITY_TYPE_ANNOTATION","FILE_ACTIVITY_TYPE_COMMENT","PERMISSION_CAN_COMMENT","PERMISSION_CAN_VIEW_ANNOTATIONS","REPLY_LIMIT","getFileActivityQueryParams","fileID","activityTypes","shouldShowReplies","baseEndpoint","hasActivityTypes","length","enableReplies","enabledRepliesQueryParam","activityTypeQueryParam","join","FileActivities","getFilteredUrl","id","getBaseApiUrl","getActivities","errorCallback","permissions","repliesCount","successCallback","errorCode","Error","includes","checkApiCallValidity","e","get","requestData","_objectSpread","replies_count","url"],"sources":["../../src/api/FileActivities.js"],"sourcesContent":["/**\n * @flow\n * @file Helper for the box File Activity API\n * @author Box\n */\n\nimport Base from './Base';\nimport {\n    ERROR_CODE_FETCH_ACTIVITY,\n    FILE_ACTIVITY_TYPE_ANNOTATION,\n    FILE_ACTIVITY_TYPE_COMMENT,\n    PERMISSION_CAN_COMMENT,\n    PERMISSION_CAN_VIEW_ANNOTATIONS,\n} from '../constants';\nimport type { BoxItemPermission } from '../common/types/core';\nimport type { ElementsXhrError } from '../common/types/api';\nimport type { FileActivity, FileActivityTypes } from '../common/types/feed';\n\n// We only show the latest reply in the UI\nconst REPLY_LIMIT = 1;\n\nconst getFileActivityQueryParams = (\n    fileID: string,\n    activityTypes?: FileActivityTypes[] = [],\n    shouldShowReplies?: boolean = false,\n) => {\n    const baseEndpoint = `/file_activities?file_id=${fileID}`;\n    const hasActivityTypes = !!activityTypes && !!activityTypes.length;\n    const enableReplies = shouldShowReplies ? 'true' : 'false';\n    const enabledRepliesQueryParam = `&enable_replies=${enableReplies}&reply_limit=${REPLY_LIMIT}`;\n    const activityTypeQueryParam = hasActivityTypes ? `&activity_types=${activityTypes.join()}` : '';\n\n    return `${baseEndpoint}${activityTypeQueryParam}${enabledRepliesQueryParam}`;\n};\n\nclass FileActivities extends Base {\n    /**\n     * API URL for filtered file activities\n     *\n     * @param {string} [id] - a box file id\n     * @param {Array<FileActivityTypes>} activityTypes - optional. Array of File Activity types to filter by, returns all Activity Types if omitted.\n     * @param {boolean} shouldShowReplies - optional. Specify if replies should be included in the response\n     * @return {string} base url for files\n     */\n    getFilteredUrl(id: string, activityTypes?: FileActivityTypes[], shouldShowReplies?: boolean): string {\n        return `${this.getBaseApiUrl()}${getFileActivityQueryParams(id, activityTypes, shouldShowReplies)}`;\n    }\n\n    /**\n     * API for fetching file activities\n     *\n     * @param {Array<FileActivityTypes>} activityTypes - optional. Array of File Activity types to filter by, returns all Activity Types if omitted.\n     * @param {Function} errorCallback - the error callback\n     * @param {string} fileId - the file id\n     * @param {BoxItemPermission} permissions - the permissions for the file\n     * @param {number} repliesCount - number of replies to return, by default all replies are returned\n     * @param {boolean} shouldShowReplies - specify if replies should be included in the response\n     * @param {Function} successCallback - the success callback\n     * @returns {void}\n     */\n    getActivities({\n        activityTypes,\n        errorCallback,\n        fileID,\n        permissions,\n        repliesCount,\n        shouldShowReplies,\n        successCallback,\n    }: {\n        activityTypes: FileActivityTypes[],\n        errorCallback: (e: ElementsXhrError, code: string) => void,\n        fileID: string,\n        permissions: BoxItemPermission,\n        repliesCount?: number,\n        shouldShowReplies?: boolean,\n        successCallback: (activity: FileActivity) => void,\n    }): void {\n        this.errorCode = ERROR_CODE_FETCH_ACTIVITY;\n        try {\n            if (!fileID) {\n                throw new Error('Missing file id!');\n            }\n\n            if (activityTypes.includes(FILE_ACTIVITY_TYPE_COMMENT)) {\n                this.checkApiCallValidity(PERMISSION_CAN_COMMENT, permissions, fileID);\n            }\n            if (activityTypes.includes(FILE_ACTIVITY_TYPE_ANNOTATION)) {\n                this.checkApiCallValidity(PERMISSION_CAN_VIEW_ANNOTATIONS, permissions, fileID);\n            }\n        } catch (e) {\n            errorCallback(e, this.errorCode);\n            return;\n        }\n\n        this.get({\n            id: fileID,\n            successCallback,\n            errorCallback,\n            requestData: {\n                ...(repliesCount ? { replies_count: repliesCount } : null),\n            },\n            url: this.getFilteredUrl(fileID, activityTypes, shouldShowReplies),\n        });\n    }\n}\n\nexport default FileActivities;\n"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,IAAI,MAAM,QAAQ;AACzB,SACIC,yBAAyB,EACzBC,6BAA6B,EAC7BC,0BAA0B,EAC1BC,sBAAsB,EACtBC,+BAA+B,QAC5B,cAAc;AAKrB;AACA,MAAMC,WAAW,GAAG,CAAC;AAErB,MAAMC,0BAA0B,GAAGA,CAC/BC,MAAc,EACdC,aAAmC,GAAG,EAAE,EACxCC,iBAA2B,GAAG,KAAK,KAClC;EACD,MAAMC,YAAY,GAAG,4BAA4BH,MAAM,EAAE;EACzD,MAAMI,gBAAgB,GAAG,CAAC,CAACH,aAAa,IAAI,CAAC,CAACA,aAAa,CAACI,MAAM;EAClE,MAAMC,aAAa,GAAGJ,iBAAiB,GAAG,MAAM,GAAG,OAAO;EAC1D,MAAMK,wBAAwB,GAAG,mBAAmBD,aAAa,gBAAgBR,WAAW,EAAE;EAC9F,MAAMU,sBAAsB,GAAGJ,gBAAgB,GAAG,mBAAmBH,aAAa,CAACQ,IAAI,CAAC,CAAC,EAAE,GAAG,EAAE;EAEhG,OAAO,GAAGN,YAAY,GAAGK,sBAAsB,GAAGD,wBAAwB,EAAE;AAChF,CAAC;AAED,MAAMG,cAAc,SAASlB,IAAI,CAAC;EAC9B;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;EACImB,cAAcA,CAACC,EAAU,EAAEX,aAAmC,EAAEC,iBAA2B,EAAU;IACjG,OAAO,GAAG,IAAI,CAACW,aAAa,CAAC,CAAC,GAAGd,0BAA0B,CAACa,EAAE,EAAEX,aAAa,EAAEC,iBAAiB,CAAC,EAAE;EACvG;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIY,aAAaA,CAAC;IACVb,aAAa;IACbc,aAAa;IACbf,MAAM;IACNgB,WAAW;IACXC,YAAY;IACZf,iBAAiB;IACjBgB;EASJ,CAAC,EAAQ;IACL,IAAI,CAACC,SAAS,GAAG1B,yBAAyB;IAC1C,IAAI;MACA,IAAI,CAACO,MAAM,EAAE;QACT,MAAM,IAAIoB,KAAK,CAAC,kBAAkB,CAAC;MACvC;MAEA,IAAInB,aAAa,CAACoB,QAAQ,CAAC1B,0BAA0B,CAAC,EAAE;QACpD,IAAI,CAAC2B,oBAAoB,CAAC1B,sBAAsB,EAAEoB,WAAW,EAAEhB,MAAM,CAAC;MAC1E;MACA,IAAIC,aAAa,CAACoB,QAAQ,CAAC3B,6BAA6B,CAAC,EAAE;QACvD,IAAI,CAAC4B,oBAAoB,CAACzB,+BAA+B,EAAEmB,WAAW,EAAEhB,MAAM,CAAC;MACnF;IACJ,CAAC,CAAC,OAAOuB,CAAC,EAAE;MACRR,aAAa,CAACQ,CAAC,EAAE,IAAI,CAACJ,SAAS,CAAC;MAChC;IACJ;IAEA,IAAI,CAACK,GAAG,CAAC;MACLZ,EAAE,EAAEZ,MAAM;MACVkB,eAAe;MACfH,aAAa;MACbU,WAAW,EAAAC,aAAA,KACHT,YAAY,GAAG;QAAEU,aAAa,EAAEV;MAAa,CAAC,GAAG,IAAI,CAC5D;MACDW,GAAG,EAAE,IAAI,CAACjB,cAAc,CAACX,MAAM,EAAEC,aAAa,EAAEC,iBAAiB;IACrE,CAAC,CAAC;EACN;AACJ;AAEA,eAAeQ,cAAc","ignoreList":[]}