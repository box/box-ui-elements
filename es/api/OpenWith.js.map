{"version":3,"file":"OpenWith.js","names":["Base","ERROR_CODE_FETCH_INTEGRATIONS","BOX_EDIT_INTEGRATION_ID","BOX_EDIT_SFC_INTEGRATION_ID","OpenWith","getUrl","id","Error","getBaseApiUrl","getOpenWithIntegrations","fileId","successCallback","errorCallback","errorCode","get","openWithIntegrations","formattedOpenWithData","formatOpenWithData","consolidatedOpenWithIntegrations","consolidateBoxEditIntegrations","integrations","consolidatedIntegrations","boxEditIntegration","some","item","appIntegrationId","filter","items","default_app_integration","defaultIntegration","map","app_integration","disabled_reasons","display_name","display_description","display_order","is_disabled","should_show_consent_popup","type","displayDescription","disabledReasons","displayOrder","isDefault","isDisabled","displayName","requiresConsent","sort","integrationA","integrationB"],"sources":["../../src/api/OpenWith.js"],"sourcesContent":["/**\n * @flow\n * @file Helper for the open_with_integrations API endpoint\n * @author Box\n */\n\nimport Base from './Base';\nimport { ERROR_CODE_FETCH_INTEGRATIONS, BOX_EDIT_INTEGRATION_ID, BOX_EDIT_SFC_INTEGRATION_ID } from '../constants';\nimport type { ElementsErrorCallback } from '../common/types/api';\nimport type { Integration, OpenWithAPI } from '../common/types/integrations';\n\nclass OpenWith extends Base {\n    /**\n     * API URL for Open With\n     *\n     * @param {string} [id] - a box file id\n     * @return {string} base url for files\n     */\n    getUrl(id: string): string {\n        if (!id) {\n            throw new Error('Missing file id!');\n        }\n\n        return `${this.getBaseApiUrl()}/files/${id}/open_with_integrations`;\n    }\n\n    /**\n     * Gets Open With integration data\n     *\n     * @param {string} fileId - Box file ID\n     * @param {Function} successCallback - Success callback\n     * @param {Function} errorCallback - Error callback\n     * @return {void}\n     */\n    getOpenWithIntegrations(fileId: string, successCallback: Function, errorCallback: ElementsErrorCallback) {\n        this.errorCode = ERROR_CODE_FETCH_INTEGRATIONS;\n\n        this.get({\n            id: fileId,\n            successCallback: openWithIntegrations => {\n                const formattedOpenWithData = this.formatOpenWithData(openWithIntegrations);\n                const consolidatedOpenWithIntegrations = this.consolidateBoxEditIntegrations(formattedOpenWithData);\n                successCallback(consolidatedOpenWithIntegrations);\n            },\n            errorCallback,\n        });\n    }\n\n    /**\n     * Removes the Box Edit SFC integration if the higher scoped Box Edit integration is present.\n     * Box Edit and SFC Box Edit are considered separate integrations by the API. We only want to show one,\n     * even if both are enabled and returned from the API.\n     *\n     * @param {Array<Integration>} integrations - List of integrations\n     * @return {Array<Integration>} Integrations with only one Box Edit integration\n     */\n    consolidateBoxEditIntegrations(integrations: Array<Integration>): Array<Integration> {\n        let consolidatedIntegrations = [...integrations];\n        const boxEditIntegration = integrations.some(item => item.appIntegrationId === BOX_EDIT_INTEGRATION_ID);\n\n        if (boxEditIntegration) {\n            consolidatedIntegrations = integrations.filter(\n                item => item.appIntegrationId !== BOX_EDIT_SFC_INTEGRATION_ID,\n            );\n        }\n\n        return consolidatedIntegrations;\n    }\n\n    /**\n     * Formats Open With data conveniently for the client\n     *\n     * @param {Array<Object>} openWithIntegrations - The modified Open With integration objects\n     * @return {Array<Integration>} formatted Open With integrations\n     */\n    formatOpenWithData(openWithIntegrations: OpenWithAPI): Array<Integration> {\n        const { items, default_app_integration: defaultIntegration } = openWithIntegrations;\n        const integrations: Array<Integration> = items.map(\n            ({\n                app_integration,\n                disabled_reasons,\n                display_name,\n                display_description,\n                display_order,\n                is_disabled,\n                should_show_consent_popup,\n            }: Object) => {\n                const { id, type } = app_integration;\n\n                return {\n                    appIntegrationId: id,\n                    displayDescription: display_description,\n                    disabledReasons: disabled_reasons || [],\n                    displayOrder: display_order,\n                    isDefault: !!defaultIntegration && id === defaultIntegration.id,\n                    isDisabled: is_disabled,\n                    displayName: display_name,\n                    requiresConsent: should_show_consent_popup,\n                    type,\n                };\n            },\n        );\n\n        // Sort integrations by displayOrder\n        return integrations.sort(\n            (integrationA: Integration, integrationB: Integration) =>\n                integrationA.displayOrder - integrationB.displayOrder,\n        );\n    }\n}\n\nexport default OpenWith;\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,IAAI,MAAM,QAAQ;AACzB,SAASC,6BAA6B,EAAEC,uBAAuB,EAAEC,2BAA2B,QAAQ,cAAc;AAIlH,MAAMC,QAAQ,SAASJ,IAAI,CAAC;EACxB;AACJ;AACA;AACA;AACA;AACA;EACIK,MAAMA,CAACC,EAAU,EAAU;IACvB,IAAI,CAACA,EAAE,EAAE;MACL,MAAM,IAAIC,KAAK,CAAC,kBAAkB,CAAC;IACvC;IAEA,OAAO,GAAG,IAAI,CAACC,aAAa,CAAC,CAAC,UAAUF,EAAE,yBAAyB;EACvE;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;EACIG,uBAAuBA,CAACC,MAAc,EAAEC,eAAyB,EAAEC,aAAoC,EAAE;IACrG,IAAI,CAACC,SAAS,GAAGZ,6BAA6B;IAE9C,IAAI,CAACa,GAAG,CAAC;MACLR,EAAE,EAAEI,MAAM;MACVC,eAAe,EAAEI,oBAAoB,IAAI;QACrC,MAAMC,qBAAqB,GAAG,IAAI,CAACC,kBAAkB,CAACF,oBAAoB,CAAC;QAC3E,MAAMG,gCAAgC,GAAG,IAAI,CAACC,8BAA8B,CAACH,qBAAqB,CAAC;QACnGL,eAAe,CAACO,gCAAgC,CAAC;MACrD,CAAC;MACDN;IACJ,CAAC,CAAC;EACN;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;EACIO,8BAA8BA,CAACC,YAAgC,EAAsB;IACjF,IAAIC,wBAAwB,GAAG,CAAC,GAAGD,YAAY,CAAC;IAChD,MAAME,kBAAkB,GAAGF,YAAY,CAACG,IAAI,CAACC,IAAI,IAAIA,IAAI,CAACC,gBAAgB,KAAKvB,uBAAuB,CAAC;IAEvG,IAAIoB,kBAAkB,EAAE;MACpBD,wBAAwB,GAAGD,YAAY,CAACM,MAAM,CAC1CF,IAAI,IAAIA,IAAI,CAACC,gBAAgB,KAAKtB,2BACtC,CAAC;IACL;IAEA,OAAOkB,wBAAwB;EACnC;;EAEA;AACJ;AACA;AACA;AACA;AACA;EACIJ,kBAAkBA,CAACF,oBAAiC,EAAsB;IACtE,MAAM;MAAEY,KAAK;MAAEC,uBAAuB,EAAEC;IAAmB,CAAC,GAAGd,oBAAoB;IACnF,MAAMK,YAAgC,GAAGO,KAAK,CAACG,GAAG,CAC9C,CAAC;MACGC,eAAe;MACfC,gBAAgB;MAChBC,YAAY;MACZC,mBAAmB;MACnBC,aAAa;MACbC,WAAW;MACXC;IACI,CAAC,KAAK;MACV,MAAM;QAAE/B,EAAE;QAAEgC;MAAK,CAAC,GAAGP,eAAe;MAEpC,OAAO;QACHN,gBAAgB,EAAEnB,EAAE;QACpBiC,kBAAkB,EAAEL,mBAAmB;QACvCM,eAAe,EAAER,gBAAgB,IAAI,EAAE;QACvCS,YAAY,EAAEN,aAAa;QAC3BO,SAAS,EAAE,CAAC,CAACb,kBAAkB,IAAIvB,EAAE,KAAKuB,kBAAkB,CAACvB,EAAE;QAC/DqC,UAAU,EAAEP,WAAW;QACvBQ,WAAW,EAAEX,YAAY;QACzBY,eAAe,EAAER,yBAAyB;QAC1CC;MACJ,CAAC;IACL,CACJ,CAAC;;IAED;IACA,OAAOlB,YAAY,CAAC0B,IAAI,CACpB,CAACC,YAAyB,EAAEC,YAAyB,KACjDD,YAAY,CAACN,YAAY,GAAGO,YAAY,CAACP,YACjD,CAAC;EACL;AACJ;AAEA,eAAerC,QAAQ","ignoreList":[]}