{"version":3,"file":"TasksNew.js","names":["TasksBase","ERROR_CODE_CREATE_TASK","ERROR_CODE_UPDATE_TASK","ERROR_CODE_DELETE_TASK","ERROR_CODE_FETCH_TASKS","API_PAGE_LIMIT","TasksNew","getUrlForFileTasks","id","getBaseApiUrl","getUrlForTaskCreateWithDeps","getUrlForTask","getUrlForTaskWithDeps","updateTaskWithDeps","errorCallback","file","successCallback","task","errorCode","createTaskCollabsPayload","addedAssignees","map","assignee","op","item","type","payload","target","deleteTaskCollabsPayload","removedAssignees","updateTaskPayload","_objectWithoutProperties","_excluded","put","url","data","_objectSpread","deleteTask","delete","getTasksForFile","get","getTask","createTaskWithDeps","assignees","createTaskLinksPayload","createTaskWithDepsPayload","assigned_to","task_links","post"],"sources":["../../../src/api/tasks/TasksNew.js"],"sourcesContent":["/**\n * @flow\n * @file Helper for the box Tasks API\n * @author Box\n */\n\nimport TasksBase from './TasksBase';\nimport {\n    ERROR_CODE_CREATE_TASK,\n    ERROR_CODE_UPDATE_TASK,\n    ERROR_CODE_DELETE_TASK,\n    ERROR_CODE_FETCH_TASKS,\n    API_PAGE_LIMIT,\n} from '../../constants';\nimport type { TaskUpdatePayload } from '../../common/types/tasks';\nimport type { ElementsXhrError, ElementsErrorCallback } from '../../common/types/api';\nimport type { SelectorItems, SelectorItem, UserMini, GroupMini, BoxItem } from '../../common/types/core';\n\nclass TasksNew extends TasksBase {\n    getUrlForFileTasks(id: string): string {\n        return `${this.getBaseApiUrl()}/undoc/files/${id}/linked_tasks?limit=${API_PAGE_LIMIT}`;\n    }\n\n    getUrlForTaskCreateWithDeps(): string {\n        return `${this.getBaseApiUrl()}/undoc/tasks/with_dependencies`;\n    }\n\n    getUrlForTask(id: string): string {\n        return `${this.getBaseApiUrl()}/undoc/tasks/${id}`;\n    }\n\n    getUrlForTaskWithDeps(id: string): string {\n        return `${this.getBaseApiUrl()}/undoc/tasks/${id}/with_dependencies`;\n    }\n\n    updateTaskWithDeps({\n        errorCallback,\n        file,\n        successCallback,\n        task,\n    }: {\n        errorCallback: ElementsErrorCallback,\n        file: BoxItem,\n        successCallback: Function,\n        task: TaskUpdatePayload,\n    }): void {\n        this.errorCode = ERROR_CODE_UPDATE_TASK;\n\n        const createTaskCollabsPayload = task.addedAssignees.map(assignee => {\n            return {\n                op:\n                    assignee.item && assignee.item.type === 'group'\n                        ? 'add_task_collaborators_expand_group'\n                        : 'add_task_collaborator',\n                payload: {\n                    target: {\n                        type: assignee.item && assignee.item.type === 'group' ? 'group' : 'user',\n                        id: assignee.id,\n                    },\n                },\n            };\n        });\n\n        const deleteTaskCollabsPayload = task.removedAssignees.map(assignee => {\n            return {\n                op: 'delete_task_collaborator',\n                id: assignee.id,\n            };\n        });\n\n        const { id, addedAssignees, removedAssignees, ...updateTaskPayload } = task;\n        this.put({\n            id: file.id,\n            url: this.getUrlForTaskWithDeps(task.id),\n            data: {\n                data: [\n                    {\n                        op: 'update_task',\n                        payload: { ...updateTaskPayload },\n                    },\n                    ...createTaskCollabsPayload,\n                    ...deleteTaskCollabsPayload,\n                ],\n            },\n            successCallback,\n            errorCallback,\n        });\n    }\n\n    deleteTask({\n        errorCallback,\n        file,\n        successCallback,\n        task,\n    }: {\n        errorCallback: ElementsErrorCallback,\n        file: BoxItem,\n        successCallback: Function,\n        task: { id: string },\n    }): void {\n        this.errorCode = ERROR_CODE_DELETE_TASK;\n\n        this.delete({\n            id: file.id,\n            url: this.getUrlForTask(task.id),\n            successCallback,\n            errorCallback,\n        });\n    }\n\n    getTasksForFile({\n        errorCallback,\n        file,\n        successCallback,\n    }: {\n        errorCallback: ElementsErrorCallback,\n        file: { id: string },\n        successCallback: Function,\n    }): void {\n        this.errorCode = ERROR_CODE_FETCH_TASKS;\n        this.get({\n            id: file.id,\n            url: this.getUrlForFileTasks(file.id),\n            successCallback,\n            errorCallback,\n        });\n    }\n\n    getTask({\n        errorCallback,\n        file,\n        id,\n        successCallback,\n    }: {\n        errorCallback: ElementsErrorCallback,\n        file: { id: string },\n        id: string,\n        successCallback: Function,\n    }): void {\n        this.errorCode = ERROR_CODE_FETCH_TASKS;\n        this.get({\n            id: file.id,\n            url: this.getUrlForTask(id),\n            successCallback,\n            errorCallback,\n        });\n    }\n\n    createTaskWithDeps({\n        errorCallback,\n        file,\n        successCallback,\n        task,\n        assignees,\n    }: {\n        assignees: SelectorItems<UserMini | GroupMini>,\n        errorCallback: (e: ElementsXhrError, code: string) => void,\n        file: BoxItem,\n        successCallback: Function,\n        task: {}, // Partial task object\n    }): void {\n        this.errorCode = ERROR_CODE_CREATE_TASK;\n\n        const createTaskCollabsPayload = assignees.map((assignee: SelectorItem<UserMini | GroupMini>) => {\n            return {\n                target: {\n                    type: assignee.item && assignee.item.type === 'group' ? 'group' : 'user',\n                    id: assignee.id,\n                },\n            };\n        });\n\n        const createTaskLinksPayload = [\n            {\n                target: {\n                    id: file.id,\n                    type: 'file',\n                },\n            },\n        ];\n\n        const createTaskWithDepsPayload = {\n            task: { ...task },\n            assigned_to: createTaskCollabsPayload,\n            task_links: createTaskLinksPayload,\n        };\n\n        this.post({\n            id: file.id,\n            url: this.getUrlForTaskCreateWithDeps(),\n            data: { data: { ...createTaskWithDepsPayload } },\n            successCallback,\n            errorCallback,\n        });\n    }\n}\n\nexport default TasksNew;\n"],"mappings":"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","ignoreList":[]}