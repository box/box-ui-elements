{"version":3,"file":"Users.js","names":["queryString","TokenService","getTypedFileId","Base","ERROR_CODE_FETCH_CURRENT_USER","Users","getUrl","getBaseApiUrl","getAvatarUrl","id","Error","getAvatarUrlWithAccessToken","userId","fileId","cache","getCache","has","get","accessToken","getReadToken","options","token","access_token","pic_type","urlParams","stringify","url","set","getUser","successCallback","errorCallback","requestData","errorCode"],"sources":["../../src/api/Users.js"],"sourcesContent":["/**\n * @flow\n * @file Helper for the box Users API\n * @author Box\n */\n\nimport queryString from 'query-string';\nimport TokenService from '../utils/TokenService';\nimport { getTypedFileId } from '../utils/file';\nimport Base from './Base';\nimport { ERROR_CODE_FETCH_CURRENT_USER } from '../constants';\nimport type { ElementsErrorCallback } from '../common/types/api';\nimport type { TokenLiteral } from '../common/types/core';\n\nclass Users extends Base {\n    /**\n     * API URL for Users\n     *\n     * @returns {string} base url for users\n     */\n    getUrl(): string {\n        return `${this.getBaseApiUrl()}/users/me`;\n    }\n\n    /**\n     * API URL for Users avatar\n     *\n     * @param {string} id - A box user id.\n     * @returns {string} base url for users\n     */\n    getAvatarUrl(id: string): string {\n        if (!id) {\n            throw new Error('Missing user id');\n        }\n\n        return `${this.getBaseApiUrl()}/users/${id}/avatar`;\n    }\n\n    /**\n     * Gets authenticated user avatar URL from cache or by getting new token\n     *\n     * @param {string} userId the user id\n     * @param {string} fileId the file id\n     * @returns {string} the user avatar URL string for a given user with access token attached\n     */\n    async getAvatarUrlWithAccessToken(userId?: ?string, fileId: string): Promise<?string> {\n        if (!userId) {\n            return null;\n        }\n\n        // treat cache as key-value pairs of { userId: avatarUrl }\n        const cache = this.getCache();\n        if (cache.has(userId)) {\n            return cache.get(userId);\n        }\n\n        const accessToken: TokenLiteral = await TokenService.getReadToken(getTypedFileId(fileId), this.options.token);\n\n        if (typeof accessToken === 'string') {\n            const options = {\n                access_token: accessToken,\n                pic_type: 'large',\n            };\n            const urlParams = queryString.stringify(options);\n            const url = `${this.getAvatarUrl(userId)}?${urlParams}`;\n            cache.set(userId, url);\n            return url;\n        }\n\n        return null;\n    }\n\n    /**\n     * API for fetching a user\n     *\n     * @param {string} id - a Box item id\n     * @param {Function} successCallback - Success callback\n     * @param {Function} errorCallback - Error callback\n     * @param {Object} requestData - additional request data\n     * @returns {Promise<void>}\n     */\n    getUser(\n        id: string,\n        successCallback: Function,\n        errorCallback: ElementsErrorCallback,\n        requestData: Object = {},\n    ): void {\n        this.errorCode = ERROR_CODE_FETCH_CURRENT_USER;\n        this.get({\n            id,\n            successCallback,\n            errorCallback,\n            requestData,\n        });\n    }\n}\n\nexport default Users;\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,WAAW,MAAM,cAAc;AACtC,OAAOC,YAAY,MAAM,uBAAuB;AAChD,SAASC,cAAc,QAAQ,eAAe;AAC9C,OAAOC,IAAI,MAAM,QAAQ;AACzB,SAASC,6BAA6B,QAAQ,cAAc;AAI5D,MAAMC,KAAK,SAASF,IAAI,CAAC;EACrB;AACJ;AACA;AACA;AACA;EACIG,MAAMA,CAAA,EAAW;IACb,OAAO,GAAG,IAAI,CAACC,aAAa,CAAC,CAAC,WAAW;EAC7C;;EAEA;AACJ;AACA;AACA;AACA;AACA;EACIC,YAAYA,CAACC,EAAU,EAAU;IAC7B,IAAI,CAACA,EAAE,EAAE;MACL,MAAM,IAAIC,KAAK,CAAC,iBAAiB,CAAC;IACtC;IAEA,OAAO,GAAG,IAAI,CAACH,aAAa,CAAC,CAAC,UAAUE,EAAE,SAAS;EACvD;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;EACI,MAAME,2BAA2BA,CAACC,MAAgB,EAAEC,MAAc,EAAoB;IAClF,IAAI,CAACD,MAAM,EAAE;MACT,OAAO,IAAI;IACf;;IAEA;IACA,MAAME,KAAK,GAAG,IAAI,CAACC,QAAQ,CAAC,CAAC;IAC7B,IAAID,KAAK,CAACE,GAAG,CAACJ,MAAM,CAAC,EAAE;MACnB,OAAOE,KAAK,CAACG,GAAG,CAACL,MAAM,CAAC;IAC5B;IAEA,MAAMM,WAAyB,GAAG,MAAMjB,YAAY,CAACkB,YAAY,CAACjB,cAAc,CAACW,MAAM,CAAC,EAAE,IAAI,CAACO,OAAO,CAACC,KAAK,CAAC;IAE7G,IAAI,OAAOH,WAAW,KAAK,QAAQ,EAAE;MACjC,MAAME,OAAO,GAAG;QACZE,YAAY,EAAEJ,WAAW;QACzBK,QAAQ,EAAE;MACd,CAAC;MACD,MAAMC,SAAS,GAAGxB,WAAW,CAACyB,SAAS,CAACL,OAAO,CAAC;MAChD,MAAMM,GAAG,GAAG,GAAG,IAAI,CAAClB,YAAY,CAACI,MAAM,CAAC,IAAIY,SAAS,EAAE;MACvDV,KAAK,CAACa,GAAG,CAACf,MAAM,EAAEc,GAAG,CAAC;MACtB,OAAOA,GAAG;IACd;IAEA,OAAO,IAAI;EACf;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIE,OAAOA,CACHnB,EAAU,EACVoB,eAAyB,EACzBC,aAAoC,EACpCC,WAAmB,GAAG,CAAC,CAAC,EACpB;IACJ,IAAI,CAACC,SAAS,GAAG5B,6BAA6B;IAC9C,IAAI,CAACa,GAAG,CAAC;MACLR,EAAE;MACFoB,eAAe;MACfC,aAAa;MACbC;IACJ,CAAC,CAAC;EACN;AACJ;AAEA,eAAe1B,KAAK","ignoreList":[]}