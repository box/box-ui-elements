{"version":3,"file":"WebLink.js","names":["Item","CACHE_PREFIX_WEBLINK","ERROR_CODE_FETCH_WEBLINK","findMissingProperties","WebLink","getCacheKey","id","getUrl","suffix","getBaseApiUrl","getWeblink","successCallback","errorCallback","fields","isDestroyed","cache","getCache","key","errorCode","has","missingFields","get","length","xhrOptions","url","params","toString","data","xhr","merge","set","successHandler","e","errorHandler"],"sources":["../../src/api/WebLink.js"],"sourcesContent":["/**\n * @flow\n * @file Helper for the box web link api\n * @author Box\n */\n\nimport Item from './Item';\nimport { CACHE_PREFIX_WEBLINK, ERROR_CODE_FETCH_WEBLINK } from '../constants';\nimport { findMissingProperties } from '../utils/fields';\nimport type { RequestOptions } from '../common/types/api';\nimport type APICache from '../utils/Cache';\n\nclass WebLink extends Item {\n    /**\n     * Creates a key for the cache\n     *\n     * @param {string} id folder id\n     * @return {string} key\n     */\n    getCacheKey(id: string): string {\n        return `${CACHE_PREFIX_WEBLINK}${id}`;\n    }\n\n    /**\n     * URL for weblink api\n     *\n     * @param {string} [id] optional file id\n     * @return {string} base url for files\n     */\n    getUrl(id: string): string {\n        const suffix: string = id ? `/${id}` : '';\n        return `${this.getBaseApiUrl()}/web_links${suffix}`;\n    }\n\n    /**\n     * Gets a Box weblink\n     *\n     * @param {string} id - Weblink id\n     * @param {Function} successCallback - Function to call with results\n     * @param {Function} errorCallback - Function to call with errors\n     * @param {Array<string>|void} fields - Optionally include specific fields\n     * @returns {Promise}\n     */\n    async getWeblink(\n        id: string,\n        successCallback: Function,\n        errorCallback: Function,\n        { fields }: RequestOptions = {},\n    ): Promise<void> {\n        if (this.isDestroyed()) {\n            return;\n        }\n\n        const cache: APICache = this.getCache();\n        const key: string = this.getCacheKey(id);\n        this.errorCode = ERROR_CODE_FETCH_WEBLINK;\n        this.successCallback = successCallback;\n        this.errorCallback = errorCallback;\n\n        if (cache.has(key)) {\n            const missingFields: Array<string> = findMissingProperties(cache.get(key), fields);\n            if (missingFields.length === 0) {\n                successCallback(cache.get(key));\n                return;\n            }\n        }\n\n        const xhrOptions: Object = {\n            url: this.getUrl(id),\n        };\n\n        if (fields) {\n            xhrOptions.params = {\n                fields: fields.toString(),\n            };\n        }\n\n        try {\n            const { data } = await this.xhr.get(xhrOptions);\n\n            if (this.isDestroyed()) {\n                return;\n            }\n\n            // Cache check is again done since this code is executed async\n            if (cache.has(key)) {\n                cache.merge(key, data);\n            } else {\n                // If there was nothing in the cache\n                cache.set(key, data);\n            }\n\n            this.successHandler(cache.get(key));\n        } catch (e) {\n            this.errorHandler(e);\n        }\n    }\n}\n\nexport default WebLink;\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,IAAI,MAAM,QAAQ;AACzB,SAASC,oBAAoB,EAAEC,wBAAwB,QAAQ,cAAc;AAC7E,SAASC,qBAAqB,QAAQ,iBAAiB;AAIvD,MAAMC,OAAO,SAASJ,IAAI,CAAC;EACvB;AACJ;AACA;AACA;AACA;AACA;EACIK,WAAWA,CAACC,EAAU,EAAU;IAC5B,OAAO,GAAGL,oBAAoB,GAAGK,EAAE,EAAE;EACzC;;EAEA;AACJ;AACA;AACA;AACA;AACA;EACIC,MAAMA,CAACD,EAAU,EAAU;IACvB,MAAME,MAAc,GAAGF,EAAE,GAAG,IAAIA,EAAE,EAAE,GAAG,EAAE;IACzC,OAAO,GAAG,IAAI,CAACG,aAAa,CAAC,CAAC,aAAaD,MAAM,EAAE;EACvD;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,MAAME,UAAUA,CACZJ,EAAU,EACVK,eAAyB,EACzBC,aAAuB,EACvB;IAAEC;EAAuB,CAAC,GAAG,CAAC,CAAC,EAClB;IACb,IAAI,IAAI,CAACC,WAAW,CAAC,CAAC,EAAE;MACpB;IACJ;IAEA,MAAMC,KAAe,GAAG,IAAI,CAACC,QAAQ,CAAC,CAAC;IACvC,MAAMC,GAAW,GAAG,IAAI,CAACZ,WAAW,CAACC,EAAE,CAAC;IACxC,IAAI,CAACY,SAAS,GAAGhB,wBAAwB;IACzC,IAAI,CAACS,eAAe,GAAGA,eAAe;IACtC,IAAI,CAACC,aAAa,GAAGA,aAAa;IAElC,IAAIG,KAAK,CAACI,GAAG,CAACF,GAAG,CAAC,EAAE;MAChB,MAAMG,aAA4B,GAAGjB,qBAAqB,CAACY,KAAK,CAACM,GAAG,CAACJ,GAAG,CAAC,EAAEJ,MAAM,CAAC;MAClF,IAAIO,aAAa,CAACE,MAAM,KAAK,CAAC,EAAE;QAC5BX,eAAe,CAACI,KAAK,CAACM,GAAG,CAACJ,GAAG,CAAC,CAAC;QAC/B;MACJ;IACJ;IAEA,MAAMM,UAAkB,GAAG;MACvBC,GAAG,EAAE,IAAI,CAACjB,MAAM,CAACD,EAAE;IACvB,CAAC;IAED,IAAIO,MAAM,EAAE;MACRU,UAAU,CAACE,MAAM,GAAG;QAChBZ,MAAM,EAAEA,MAAM,CAACa,QAAQ,CAAC;MAC5B,CAAC;IACL;IAEA,IAAI;MACA,MAAM;QAAEC;MAAK,CAAC,GAAG,MAAM,IAAI,CAACC,GAAG,CAACP,GAAG,CAACE,UAAU,CAAC;MAE/C,IAAI,IAAI,CAACT,WAAW,CAAC,CAAC,EAAE;QACpB;MACJ;;MAEA;MACA,IAAIC,KAAK,CAACI,GAAG,CAACF,GAAG,CAAC,EAAE;QAChBF,KAAK,CAACc,KAAK,CAACZ,GAAG,EAAEU,IAAI,CAAC;MAC1B,CAAC,MAAM;QACH;QACAZ,KAAK,CAACe,GAAG,CAACb,GAAG,EAAEU,IAAI,CAAC;MACxB;MAEA,IAAI,CAACI,cAAc,CAAChB,KAAK,CAACM,GAAG,CAACJ,GAAG,CAAC,CAAC;IACvC,CAAC,CAAC,OAAOe,CAAC,EAAE;MACR,IAAI,CAACC,YAAY,CAACD,CAAC,CAAC;IACxB;EACJ;AACJ;AAEA,eAAe5B,OAAO","ignoreList":[]}