{"version":3,"file":"AppActivity.js","names":["MarkerBasedAPI","ERROR_CODE_DELETE_APP_ACTIVITY","HTTP_STATUS_CODE_NOT_FOUND","APP_ACTIVITY_FIELDS_TO_FETCH","AppActivity","constructor","args","_defineProperty","item","activity_template","app","created_by","id","occurred_at","rendered_text","type","can_delete","permissions","created_at","entries","isDestroyed","successCallback","activityEntries","map","mapAppActivityItem","total_count","length","error","errorCallback","response","status","successHandler","getUrl","getBaseApiUrl","getDeleteUrl","Error","getAppActivity","requestData","item_id","item_type","fields","toString","markerGet","deleteAppActivity","appActivityId","errorCode","delete","url"],"sources":["../../src/api/AppActivity.js"],"sourcesContent":["/**\n * @flow\n * @file Helper for the box App Activity API\n * @author Box\n */\nimport MarkerBasedAPI from './MarkerBasedAPI';\nimport { ERROR_CODE_DELETE_APP_ACTIVITY, HTTP_STATUS_CODE_NOT_FOUND } from '../constants';\nimport { APP_ACTIVITY_FIELDS_TO_FETCH } from '../utils/fields';\nimport type { ElementsErrorCallback } from '../common/types/api';\nimport type { AppActivityAPIItem, AppActivityAPIItems, AppActivityItem } from '../common/types/feed';\nimport type { BoxItemPermission } from '../common/types/core';\n\nclass AppActivity extends MarkerBasedAPI {\n    /** @property {BoxItemPermission} - Placeholder permissions object to determine if app activity can be deleted */\n    permissions: BoxItemPermission = {};\n\n    /**\n     * Map an entry from the AppActivityAPIItem to an AppActivityItem.\n     * occurred_at -> created_at\n     * Adds permissions to item\n     *\n     * @param {AppActivityAPIItem} item - A single entry in the AppActivity API entries list\n     *\n     * @return {AppActivityItem}\n     */\n    mapAppActivityItem = (item: AppActivityAPIItem): AppActivityItem => {\n        const { activity_template, app, created_by, id, occurred_at, rendered_text, type } = item;\n        const { can_delete } = this.permissions;\n\n        return {\n            activity_template,\n            app,\n            created_at: occurred_at,\n            created_by,\n            id,\n            permissions: {\n                can_delete,\n            },\n            rendered_text,\n            type,\n        };\n    };\n\n    /**\n     * API URL for getting App Activity on a file\n     *\n     * @return {string} Url for all app activity on a file\n     */\n    getUrl(): string {\n        return `${this.getBaseApiUrl()}/app_activities`;\n    }\n\n    /**\n     * API URL for deleting app activity from a file\n     *\n     * @param id - ID of an app activity item\n     * @return {string} - URL to delete app activity\n     */\n    getDeleteUrl(id: string): string {\n        if (!id) {\n            throw new Error('Missing file id!');\n        }\n\n        return `${this.getUrl()}/${id}`;\n    }\n\n    /**\n     * Generic success handler\n     *\n     * @param {AppActivityAPIItems} data - the response data\n     */\n    successHandler = ({ entries = [] }: AppActivityAPIItems): void => {\n        if (this.isDestroyed() || typeof this.successCallback !== 'function') {\n            return;\n        }\n\n        const activityEntries = entries.map(this.mapAppActivityItem);\n        this.successCallback({ entries: activityEntries, total_count: activityEntries.length });\n    };\n\n    /**\n     * Generic error handler\n     *\n     * @param {AxiosError} error - the error response\n     */\n    errorHandler = (error: $AxiosError<any>): void => {\n        if (this.isDestroyed() && typeof this.errorCallback !== 'function') {\n            return;\n        }\n\n        const { response } = error;\n\n        // In the case of a 404, the enterprise does not have App Activities enabled.\n        // Show no App Activity\n        if (response.status === HTTP_STATUS_CODE_NOT_FOUND) {\n            this.successHandler({\n                entries: [],\n                total_count: 0,\n            });\n        } else {\n            this.errorCallback(error, response.status);\n        }\n    };\n\n    /**\n     * API for fetching App Activity on a file\n     *\n     * @param {string} id - the file id\n     * @param {BoxItemPermission} permissions - Permissions to attach to the app activity items. Determines if it can be deleted.\n     * @param {Function} successCallback - the success callback\n     * @param {Function} errorCallback - the error callback\n     * @param {number} [limit] - the max number of app activity items to return.\n     *\n     * @returns {void}\n     */\n    getAppActivity(\n        id: string,\n        permissions: BoxItemPermission,\n        successCallback: Function,\n        errorCallback: ElementsErrorCallback,\n    ): void {\n        const requestData = {\n            item_id: id,\n            item_type: 'file',\n            fields: APP_ACTIVITY_FIELDS_TO_FETCH.toString(),\n        };\n\n        this.permissions = permissions;\n\n        this.markerGet({\n            id,\n            successCallback,\n            errorCallback,\n            requestData,\n        });\n    }\n\n    /**\n     * Delete an app activity item\n     *\n     * @param {string} id - The ID of the Box file that App Activity is on\n     * @param {string} appActivityId - An AppActivity item id\n     * @param {Function} successCallback - The success callback\n     * @param {Function} errorCallback - The error callback\n     */\n    deleteAppActivity({\n        id,\n        appActivityId,\n        successCallback,\n        errorCallback,\n    }: {\n        appActivityId: string,\n        errorCallback: Function,\n        id: string,\n        successCallback: Function,\n    }): void {\n        this.errorCode = ERROR_CODE_DELETE_APP_ACTIVITY;\n\n        this.delete({\n            id,\n            url: this.getDeleteUrl(appActivityId),\n            successCallback,\n            errorCallback,\n        });\n    }\n}\n\nexport default AppActivity;\n"],"mappings":"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","ignoreList":[]}