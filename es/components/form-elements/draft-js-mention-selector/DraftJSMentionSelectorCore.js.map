{"version":3,"file":"DraftJSMentionSelectorCore.js","names":["React","FormattedMessage","classNames","EditorState","DatalistItem","DraftJSEditor","SelectorDropdown","addMention","defaultMentionTriggers","getActiveMentionForEditorState","messages","DefaultSelectorRow","_ref","item","rest","_objectWithoutProperties","_excluded","createElement","name","className","email","DefaultStartMentionMessage","startMention","MentionStartState","message","role","DraftJSMentionSelector","Component","constructor","props","_defineProperty","onMention","activeMention","state","mentionString","index","contacts","setState","isFocused","handleMention","event","onBlur","onFocus","nextEditorState","onChange","length","mentionTriggers","reduce","prev","current","mentionPattern","RegExp","componentDidUpdate","prevProps","prevContacts","currentContacts","editorState","mention","editorStateWithLink","handleChange","render","contactsLoaded","error","hideLabel","isDisabled","isRequired","label","description","onReturn","placeholder","selectorRow","startMentionMessage","classes","showMentionStartState","usersFoundMessage","shouldDisplayMentionLookup","_objectSpread","usersFound","values","usersCount","noUsersFound","onSelect","handleContactSelected","selector","handleBlur","handleFocus","map","contact","cloneElement","key","id"],"sources":["../../../../src/components/form-elements/draft-js-mention-selector/DraftJSMentionSelectorCore.js"],"sourcesContent":["// @flow\nimport * as React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport classNames from 'classnames';\nimport { EditorState } from 'draft-js';\n\nimport DatalistItem from '../../datalist-item';\nimport DraftJSEditor from '../../draft-js-editor';\nimport SelectorDropdown from '../../selector-dropdown';\nimport { addMention, defaultMentionTriggers, getActiveMentionForEditorState } from './utils';\n\nimport messages from './messages';\n\nimport type { SelectorItems } from '../../../common/types/core';\nimport type { Mention } from './utils';\n\nimport './MentionSelector.scss';\n\ntype DefaultSelectorRowProps = {\n    item?: {\n        email?: string,\n        name?: string,\n    },\n};\n\nconst DefaultSelectorRow = ({ item = {}, ...rest }: DefaultSelectorRowProps) => (\n    <DatalistItem {...rest}>\n        {item.name} <span className=\"dropdown-secondary-text\">{item.email}</span>\n    </DatalistItem>\n);\n\nconst DefaultStartMentionMessage = () => <FormattedMessage {...messages.startMention} />;\n\ntype MentionStartStateProps = {\n    message?: React.Node,\n};\n\nconst MentionStartState = ({ message }: MentionStartStateProps) => (\n    <div role=\"alert\" className=\"mention-start-state\">\n        {message}\n    </div>\n);\n\ntype Props = {\n    className?: string,\n    contacts: SelectorItems<>,\n    contactsLoaded?: boolean,\n    description?: React.Node,\n    editorState: EditorState,\n    error?: ?Object,\n    hideLabel?: boolean,\n    isDisabled?: boolean,\n    isRequired?: boolean,\n    label: React.Node,\n    mentionTriggers: Array<string>,\n    onBlur?: Function,\n    onChange?: Function,\n    onFocus?: Function,\n    onMention?: Function,\n    onReturn?: Function,\n    placeholder?: string,\n    selectorRow: React.Element<any>,\n    startMentionMessage?: React.Node,\n};\n\ntype State = {\n    activeMention: Mention | null,\n    isFocused: boolean,\n    mentionPattern: RegExp,\n};\n\nclass DraftJSMentionSelector extends React.Component<Props, State> {\n    static defaultProps = {\n        className: '',\n        contacts: [],\n        isDisabled: false,\n        isRequired: false,\n        mentionTriggers: defaultMentionTriggers,\n        selectorRow: <DefaultSelectorRow />,\n        startMentionMessage: <DefaultStartMentionMessage />,\n    };\n\n    constructor(props: Props) {\n        super(props);\n        const mentionTriggers = props.mentionTriggers.reduce((prev, current) => `${prev}\\\\${current}`, '');\n\n        this.state = {\n            activeMention: null,\n            isFocused: false,\n            mentionPattern: new RegExp(`([${mentionTriggers}])([^${mentionTriggers}]*)$`),\n        };\n    }\n\n    /**\n     * Lifecycle method that gets called immediately after an update\n     * @param {object} lastProps Props the component is receiving\n     * @returns {void}\n     */\n    componentDidUpdate(prevProps: Props) {\n        const { contacts: prevContacts } = prevProps;\n        const { contacts: currentContacts } = this.props;\n        const { activeMention } = this.state;\n\n        if (activeMention !== null && !currentContacts.length && prevContacts.length !== currentContacts.length) {\n            // if empty set of contacts get passed in, set active mention to null\n            this.setState({\n                activeMention: null,\n            });\n        }\n    }\n\n    /**\n     * Extracts the active mention from the editor state\n     *\n     * @param {EditorState} editorState\n     * @returns {object}\n     */\n    getActiveMentionForEditorState(editorState: EditorState) {\n        const { mentionPattern } = this.state;\n\n        return getActiveMentionForEditorState(editorState, mentionPattern);\n    }\n\n    /**\n     * Called on each keypress when a mention is being composed\n     * @returns {void}\n     */\n    handleMention = () => {\n        const { onMention } = this.props;\n        const { activeMention } = this.state;\n\n        if (onMention) {\n            onMention(activeMention ? activeMention.mentionString : '');\n        }\n    };\n\n    /**\n     * Method that gets called when a mention contact is selected\n     * @param {number} index The selected index\n     * @returns {void}\n     */\n    handleContactSelected = (index: number) => {\n        const { contacts } = this.props;\n        this.addMention(contacts[index]);\n        this.setState(\n            {\n                activeMention: null,\n                isFocused: true,\n            },\n            () => {\n                this.handleMention();\n            },\n        );\n    };\n\n    handleBlur = (event: SyntheticEvent<>) => {\n        const { onBlur } = this.props;\n\n        this.setState({\n            isFocused: false,\n        });\n\n        if (onBlur) {\n            onBlur(event);\n        }\n    };\n\n    handleFocus = (event: SyntheticEvent<>) => {\n        const { onFocus } = this.props;\n\n        this.setState({\n            isFocused: true,\n        });\n\n        if (onFocus) {\n            onFocus(event);\n        }\n    };\n\n    /**\n     * Event handler called when DraftJSEditor emits onChange\n     * Checks current text to see if any mentions were made\n     * @param {EditorState} editorState The new editor state\n     * @returns {void}\n     */\n    handleChange = (nextEditorState: EditorState) => {\n        const { onChange } = this.props;\n        const activeMention = this.getActiveMentionForEditorState(nextEditorState);\n\n        this.setState(\n            {\n                activeMention,\n            },\n            () => {\n                if (onChange) {\n                    onChange(nextEditorState);\n                }\n\n                if (activeMention && activeMention.mentionString) {\n                    this.handleMention();\n                }\n            },\n        );\n    };\n\n    /**\n     * Inserts a selected mention into the editor\n     * @param {object} mention The selected mention to insert\n     */\n    addMention(mention: Object) {\n        const { activeMention } = this.state;\n        const { editorState } = this.props;\n\n        const editorStateWithLink = addMention(editorState, activeMention, mention);\n\n        this.setState(\n            {\n                activeMention: null,\n            },\n            () => {\n                this.handleChange(editorStateWithLink);\n            },\n        );\n    }\n\n    /**\n     * @returns {boolean}\n     */\n    shouldDisplayMentionLookup = () => {\n        const { contacts } = this.props;\n        const { activeMention } = this.state;\n\n        return !!(activeMention && activeMention.mentionString && contacts.length);\n    };\n\n    render() {\n        const {\n            className,\n            contacts,\n            contactsLoaded,\n            editorState,\n            error,\n            hideLabel,\n            isDisabled,\n            isRequired,\n            label,\n            description,\n            onReturn,\n            placeholder,\n            selectorRow,\n            startMentionMessage,\n            onMention,\n        } = this.props;\n        const { activeMention, isFocused } = this.state;\n\n        const classes = classNames('mention-selector-wrapper', className);\n\n        const showMentionStartState = !!(onMention && activeMention && !activeMention.mentionString && isFocused);\n\n        const usersFoundMessage = this.shouldDisplayMentionLookup()\n            ? { ...messages.usersFound, values: { usersCount: contacts.length } }\n            : messages.noUsersFound;\n\n        return (\n            <div className={classes}>\n                <SelectorDropdown\n                    onSelect={this.handleContactSelected}\n                    selector={\n                        <DraftJSEditor\n                            editorState={editorState}\n                            error={error}\n                            hideLabel={hideLabel}\n                            isDisabled={isDisabled}\n                            isFocused={isFocused}\n                            isRequired={isRequired}\n                            label={label}\n                            description={description}\n                            onBlur={this.handleBlur}\n                            onFocus={this.handleFocus}\n                            onChange={this.handleChange}\n                            onReturn={onReturn}\n                            placeholder={placeholder}\n                        />\n                    }\n                >\n                    {this.shouldDisplayMentionLookup()\n                        ? contacts.map(contact =>\n                              React.cloneElement(selectorRow, {\n                                  ...selectorRow.props,\n                                  ...contact,\n                                  key: contact.id,\n                              }),\n                          )\n                        : []}\n                </SelectorDropdown>\n                {showMentionStartState ? <MentionStartState message={startMentionMessage} /> : null}\n                {contactsLoaded && (\n                    <span className=\"accessibility-hidden\" data-testid=\"accessibility-alert\" role=\"alert\">\n                        <FormattedMessage {...usersFoundMessage} />\n                    </span>\n                )}\n            </div>\n        );\n    }\n}\n\nexport default DraftJSMentionSelector;\n"],"mappings":"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","ignoreList":[]}