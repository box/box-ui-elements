{"version":3,"file":"ContextMenu.js","names":["React","TetherComponent","uniqueId","ContextMenu","Component","constructor","props","_defineProperty","isOpen","targetOffset","onMenuClose","setState","menuTargetEl","document","getElementById","menuTargetID","focus","closeMenu","focusTarget","event","menuEl","menuID","target","Node","contains","isDisabled","targetRect","getBoundingClientRect","left","top","verticalOffset","clientY","horizontalOffset","clientX","onMenuOpen","preventDefault","componentDidUpdate","prevProps","prevState","state","prevIsOpen","prevIsDisabled","addEventListener","handleDocumentClick","removeEventListener","handleMenuClose","componentWillUnmount","render","children","constraints","elements","Children","toArray","length","Error","menuTarget","menu","menuTargetProps","id","key","onContextMenu","handleContextMenu","menuProps","initialFocusIndex","onClose","tetherProps","attachment","classPrefix","targetAttachment","body","renderElementTo","createElement","_extends","renderTarget","ref","isValidElement","cloneElement","renderElement"],"sources":["../../../src/components/context-menu/ContextMenu.tsx"],"sourcesContent":["import * as React from 'react';\nimport TetherComponent, { TetherProps } from 'react-tether';\nimport uniqueId from 'lodash/uniqueId';\n\nimport './ContextMenu.scss';\n\nexport interface ContextMenuProps {\n    /** children - a target component to attach to and a menu */\n    children: Array<React.ReactChild> | React.ReactChild;\n    /**\n     * constraints - an array of tether constraints\n     *\n     * @see See [Tether](http://tether.io) for possible constraints\n     */\n    constraints: Array<unknown>;\n    /** isDisabled - when disabled, native context menu behavior is applied, and the menu will close if it was open */\n    isDisabled?: boolean;\n    /** onMenuClose - called when menu is closed */\n    onMenuClose?: Function;\n    /** onMenuOpen - called when menu is opened */\n    onMenuOpen?: Function;\n}\n\nexport interface ContextMenuState {\n    /** isOpen - whether the menu is open or not */\n    isOpen: boolean;\n    /** targetOffset - CSS representation of the menu's offset */\n    targetOffset: string;\n}\n\nclass ContextMenu extends React.Component<ContextMenuProps, ContextMenuState> {\n    static defaultProps = {\n        constraints: [],\n    };\n\n    constructor(props: ContextMenuProps) {\n        super(props);\n\n        this.menuID = uniqueId('contextmenu');\n        this.menuTargetID = uniqueId('contextmenutarget');\n    }\n\n    state = {\n        isOpen: false,\n        targetOffset: '',\n    };\n\n    componentDidUpdate(prevProps: ContextMenuProps, prevState: ContextMenuState): void {\n        const { isOpen } = this.state;\n        const { isOpen: prevIsOpen } = prevState;\n        const { isDisabled: prevIsDisabled } = prevProps;\n        const { isDisabled } = this.props;\n\n        if (!prevIsOpen && isOpen) {\n            // When menu is being opened\n            document.addEventListener('click', this.handleDocumentClick, true);\n            document.addEventListener('contextmenu', this.handleDocumentClick, true);\n        } else if (prevIsOpen && !isOpen) {\n            // When menu is being closed\n            document.removeEventListener('contextmenu', this.handleDocumentClick, true);\n            document.removeEventListener('click', this.handleDocumentClick, true);\n        }\n\n        // if the menu becomes disabled while it is open, we should close it\n        if (!isDisabled && prevIsDisabled && isOpen) {\n            this.handleMenuClose();\n        }\n    }\n\n    componentWillUnmount() {\n        if (this.state.isOpen) {\n            // Clean-up global click handlers\n            document.removeEventListener('contextmenu', this.handleDocumentClick, true);\n            document.removeEventListener('click', this.handleDocumentClick, true);\n        }\n    }\n\n    menuID: string;\n\n    menuTargetID: string;\n\n    closeMenu = () => {\n        const { onMenuClose } = this.props;\n\n        this.setState({ isOpen: false });\n        if (onMenuClose) {\n            onMenuClose();\n        }\n    };\n\n    focusTarget = () => {\n        // breaks encapsulation but the only alternative is passing a ref to an unknown child component\n        const menuTargetEl = document.getElementById(this.menuTargetID);\n        if (menuTargetEl) {\n            menuTargetEl.focus();\n        }\n    };\n\n    handleMenuClose = () => {\n        this.closeMenu();\n        this.focusTarget();\n    };\n\n    handleDocumentClick = (event: MouseEvent) => {\n        const menuEl = document.getElementById(this.menuID);\n        if (menuEl && event.target instanceof Node && menuEl.contains(event.target)) {\n            return;\n        }\n        this.closeMenu();\n    };\n\n    handleContextMenu = (event: MouseEvent) => {\n        if (this.props.isDisabled) {\n            return;\n        }\n\n        const menuTargetEl = document.getElementById(this.menuTargetID);\n        const targetRect = menuTargetEl ? menuTargetEl.getBoundingClientRect() : { left: 0, top: 0 };\n        const verticalOffset = event.clientY - targetRect.top;\n        const horizontalOffset = event.clientX - targetRect.left;\n\n        this.setState({\n            isOpen: true,\n            targetOffset: `${verticalOffset}px ${horizontalOffset}px`,\n        });\n\n        const { onMenuOpen } = this.props;\n        if (onMenuOpen) {\n            onMenuOpen();\n        }\n\n        event.preventDefault();\n    };\n\n    render() {\n        const { children, constraints } = this.props;\n        const { isOpen, targetOffset } = this.state;\n\n        const elements = React.Children.toArray(children);\n\n        if (elements.length !== 2) {\n            throw new Error('ContextMenu must have exactly two children: a target component and a <Menu>');\n        }\n\n        const menuTarget = elements[0];\n        const menu = elements[1];\n\n        const menuTargetProps = {\n            id: this.menuTargetID,\n            key: this.menuTargetID,\n            onContextMenu: this.handleContextMenu,\n        };\n\n        const menuProps = {\n            id: this.menuID,\n            key: this.menuID,\n            initialFocusIndex: null,\n            onClose: this.handleMenuClose,\n        };\n\n        const tetherProps: TetherProps = {\n            attachment: 'top left',\n            classPrefix: 'context-menu',\n            constraints,\n            targetAttachment: 'top left',\n            targetOffset,\n        };\n\n        if (document?.body) {\n            tetherProps.renderElementTo = document.body;\n        }\n\n        return (\n            <TetherComponent\n                {...tetherProps}\n                renderTarget={ref => {\n                    return React.isValidElement(menuTarget) ? (\n                        <div ref={ref}>{React.cloneElement(menuTarget, menuTargetProps)}</div>\n                    ) : null;\n                }}\n                renderElement={ref => {\n                    return isOpen && React.isValidElement(menu) ? (\n                        <div ref={ref}>{React.cloneElement(menu, menuProps)}</div>\n                    ) : null;\n                }}\n            />\n        );\n    }\n}\n\nexport default ContextMenu;\n"],"mappings":"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","ignoreList":[]}