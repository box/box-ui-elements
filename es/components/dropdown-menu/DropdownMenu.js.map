{"version":3,"file":"DropdownMenu.js","names":["React","TetherComponent","classNames","noop","uniqueId","KEYS","DropdownMenu","Component","constructor","args","_defineProperty","initialFocusIndex","isOpen","setState","event","onMenuClose","props","menuButtonEl","document","getElementById","menuButtonID","focus","state","stopPropagation","preventDefault","closeMenu","openMenuAndSetFocusIndex","key","space","enter","arrowDown","arrowUp","escape","isKeyboardEvent","focusButton","menuEl","menuID","target","Node","contains","componentDidUpdate","prevProps","prevState","useBubble","addEventListener","handleDocumentClick","onMenuOpen","removeEventListener","componentWillUnmount","render","bodyElement","children","className","targetWrapperClassName","constrainToScrollParent","constrainToWindow","constrainToWindowWithPin","isResponsive","isRightAligned","tetherAttachment","tetherTargetAttachment","elements","Children","toArray","length","Error","menuButton","menu","menuButtonProps","id","onClick","handleButtonClick","onKeyDown","handleButtonKeyDown","undefined","menuProps","onClose","handleMenuClose","attachment","targetAttachment","constraints","push","to","pin","bodyEl","HTMLElement","body","createElement","classPrefix","enabled","renderElementTo","renderTarget","ref","cloneElement","renderElement"],"sources":["../../../src/components/dropdown-menu/DropdownMenu.js"],"sourcesContent":["// @flow\nimport * as React from 'react';\nimport TetherComponent from 'react-tether';\nimport classNames from 'classnames';\nimport noop from 'lodash/noop';\nimport uniqueId from 'lodash/uniqueId';\n\nimport { KEYS } from '../../constants';\nimport './DropdownMenu.scss';\n\ntype Props = {\n    bodyElement?: HTMLElement,\n    children: React.Node,\n    /** Forces menu to render within the scroll parent */\n    className?: string,\n    /** Optional class name for the target wrapper element */\n    targetWrapperClassName?: string,\n    /** Forces menu to render within the visible window */\n    constrainToScrollParent: boolean,\n    /** Right aligns menu to button */\n    constrainToWindow: boolean,\n    /** Forces menu to render within the visible window and pins the dropdown if scrolled */\n    constrainToWindowWithPin?: boolean,\n    /** Enables responsive behaviors for this component */\n    isResponsive?: boolean,\n    /** Function called when menu is opened */\n    isRightAligned: boolean,\n    /** Handler for dropdown menu close events */\n    onMenuClose?: (event: SyntheticEvent<> | MouseEvent) => void,\n    /** Handler for dropdown menu open events */\n    onMenuOpen?: () => void,\n    /** \"attachment\" prop for the TetherComponent, will overwrite the default settings and ignore isRightAligned option */\n    tetherAttachment?: string,\n    /** \"targetAttachment\" prop for the TetherComponent, will overwrite the default settings and ignore isRightAligned option */\n    tetherTargetAttachment?: string,\n    /** Set true to close dropdown menu on event bubble instead of event capture */\n    useBubble?: boolean,\n};\n\ntype State = {\n    initialFocusIndex: ?number,\n    isOpen: boolean,\n};\n\nclass DropdownMenu extends React.Component<Props, State> {\n    static defaultProps = {\n        constrainToScrollParent: false,\n        constrainToWindow: false,\n        isResponsive: false,\n        isRightAligned: false,\n    };\n\n    menuID: string = uniqueId('menu');\n\n    menuButtonID: string = uniqueId('menubutton');\n\n    state = {\n        initialFocusIndex: null,\n        isOpen: false,\n    };\n\n    componentDidUpdate(prevProps: Props, prevState: State) {\n        const { useBubble } = this.props;\n        if (!prevState.isOpen && this.state.isOpen) {\n            // When menu is being opened\n            document.addEventListener('click', this.handleDocumentClick, !useBubble);\n            document.addEventListener('contextmenu', this.handleDocumentClick, !useBubble);\n\n            const { onMenuOpen } = this.props;\n            if (onMenuOpen) {\n                onMenuOpen();\n            }\n        } else if (prevState.isOpen && !this.state.isOpen) {\n            // When menu is being closed\n            document.removeEventListener('contextmenu', this.handleDocumentClick, !useBubble);\n            document.removeEventListener('click', this.handleDocumentClick, !useBubble);\n        }\n    }\n\n    componentWillUnmount() {\n        const { useBubble } = this.props;\n        if (this.state.isOpen) {\n            // Clean-up global click handlers\n            document.removeEventListener('contextmenu', this.handleDocumentClick, !useBubble);\n            document.removeEventListener('click', this.handleDocumentClick, !useBubble);\n        }\n    }\n\n    openMenuAndSetFocusIndex = (initialFocusIndex: ?number) => {\n        this.setState({\n            initialFocusIndex,\n            isOpen: true,\n        });\n    };\n\n    closeMenu = (event: SyntheticEvent<> | MouseEvent) => {\n        const { onMenuClose = noop } = this.props;\n        this.setState(\n            {\n                isOpen: false,\n            },\n            () => onMenuClose(event),\n        );\n    };\n\n    focusButton = () => {\n        // @NOTE: This breaks encapsulation a bit, but the only other way is passing ref functions to unknown children components\n        const menuButtonEl = document.getElementById(this.menuButtonID);\n        if (menuButtonEl) {\n            menuButtonEl.focus();\n        }\n    };\n\n    handleButtonClick = (event: SyntheticEvent<>) => {\n        const { isOpen } = this.state;\n\n        event.stopPropagation();\n        event.preventDefault();\n\n        if (isOpen) {\n            this.closeMenu(event);\n        } else {\n            this.openMenuAndSetFocusIndex(null);\n        }\n    };\n\n    handleButtonKeyDown = (event: SyntheticKeyboardEvent<>) => {\n        const { isOpen } = this.state;\n\n        switch (event.key) {\n            case KEYS.space:\n            case KEYS.enter:\n            case KEYS.arrowDown:\n                event.stopPropagation();\n                event.preventDefault();\n\n                this.openMenuAndSetFocusIndex(0);\n                break;\n\n            case KEYS.arrowUp:\n                event.stopPropagation();\n                event.preventDefault();\n\n                this.openMenuAndSetFocusIndex(-1);\n                break;\n\n            case KEYS.escape:\n                if (isOpen) {\n                    event.stopPropagation();\n                }\n\n                event.preventDefault();\n                this.closeMenu(event);\n                break;\n\n            default:\n                break;\n        }\n    };\n\n    handleMenuClose = (isKeyboardEvent: boolean, event: SyntheticEvent<> | MouseEvent) => {\n        this.closeMenu(event);\n        this.focusButton();\n    };\n\n    handleDocumentClick = (event: MouseEvent) => {\n        const menuEl = document.getElementById(this.menuID);\n        const menuButtonEl = document.getElementById(this.menuButtonID);\n\n        // Some DOM magic to get global click handlers to close menu when not interacting with menu or associated button\n        if (\n            menuEl &&\n            menuButtonEl &&\n            event.target instanceof Node &&\n            !menuEl.contains(event.target) &&\n            !menuButtonEl.contains(event.target)\n        ) {\n            this.closeMenu(event);\n        }\n    };\n\n    render() {\n        const {\n            bodyElement,\n            children,\n            className,\n            targetWrapperClassName,\n            constrainToScrollParent,\n            constrainToWindow,\n            constrainToWindowWithPin,\n            isResponsive,\n            isRightAligned,\n            tetherAttachment,\n            tetherTargetAttachment,\n        } = this.props;\n\n        const { isOpen, initialFocusIndex } = this.state;\n\n        const elements = React.Children.toArray(children);\n\n        if (elements.length !== 2) {\n            throw new Error('DropdownMenu must have exactly two children: A button component and a <Menu>');\n        }\n\n        const menuButton = elements[0];\n        const menu = elements[1];\n\n        const menuButtonProps: Object = {\n            id: this.menuButtonID,\n            key: this.menuButtonID,\n            onClick: this.handleButtonClick, // NOTE: Overrides button's handler\n            onKeyDown: this.handleButtonKeyDown, // NOTE: Overrides button's handler\n            'aria-expanded': isOpen ? 'true' : 'false',\n        };\n\n        if (menuButton.props['aria-haspopup'] === undefined) {\n            menuButtonProps['aria-haspopup'] = 'true';\n        }\n\n        // Add this only when its open, otherwise the menuID element isn't rendered\n        if (isOpen) {\n            menuButtonProps['aria-controls'] = this.menuID;\n        }\n\n        const menuProps = {\n            id: this.menuID,\n            key: this.menuID,\n            initialFocusIndex,\n            onClose: this.handleMenuClose,\n            'aria-labelledby': this.menuButtonID,\n        };\n\n        let attachment = 'top left';\n        let targetAttachment = 'bottom left';\n\n        if (isRightAligned) {\n            attachment = 'top right';\n            targetAttachment = 'bottom right';\n        }\n\n        const constraints = [];\n\n        if (constrainToScrollParent) {\n            constraints.push({\n                to: 'scrollParent',\n                attachment: 'together',\n            });\n        }\n\n        if (constrainToWindow) {\n            constraints.push({\n                to: 'window',\n                attachment: 'together',\n            });\n        }\n\n        if (constrainToWindowWithPin) {\n            constraints.push({\n                to: 'window',\n                attachment: 'together',\n                pin: true,\n            });\n        }\n\n        const bodyEl = bodyElement instanceof HTMLElement ? bodyElement : document.body;\n\n        return (\n            <TetherComponent\n                attachment={tetherAttachment || attachment}\n                className={classNames({ 'bdl-DropdownMenu--responsive': isResponsive }, className)}\n                classPrefix=\"dropdown-menu\"\n                constraints={constraints}\n                enabled={isOpen}\n                renderElementTo={bodyEl}\n                targetAttachment={tetherTargetAttachment || targetAttachment}\n                renderTarget={ref => (\n                    <div ref={ref} className={classNames('bdl-DropdownMenu-target', targetWrapperClassName)}>\n                        {React.cloneElement(menuButton, menuButtonProps)}\n                    </div>\n                )}\n                renderElement={ref => {\n                    return isOpen ? (\n                        <div ref={ref} className=\"bdl-DropdownMenu-element\">\n                            {React.cloneElement(menu, menuProps)}\n                        </div>\n                    ) : null;\n                }}\n            />\n        );\n    }\n}\n\nexport default DropdownMenu;\n"],"mappings":"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","ignoreList":[]}