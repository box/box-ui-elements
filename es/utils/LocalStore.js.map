{"version":3,"file":"LocalStore.js","names":["Cache","KEY_PREFIX","SERVICE_VERSION","LocalStore","constructor","memoryStore","localStorage","window","isLocalStorageAvailable","canUseLocalStorage","e","buildKey","key","setItem","removeItem","value","JSON","stringify","set","getItem","item","parse","get","unset"],"sources":["../../src/utils/LocalStore.js"],"sourcesContent":["/**\n * @flow\n * @file Local storage wrapper that falls back to an in memory store\n * @author Box\n */\n\nimport Cache from './Cache';\nimport type APICache from './Cache';\n\nconst KEY_PREFIX = 'localStore';\nconst SERVICE_VERSION = '0';\n\nclass LocalStore {\n    memoryStore: APICache;\n\n    localStorage: typeof localStorage;\n\n    isLocalStorageAvailable: boolean;\n\n    /**\n     * [constructor]\n     *\n     * @return {void}\n     */\n    constructor() {\n        this.memoryStore = new Cache();\n        try {\n            this.localStorage = window.localStorage;\n            this.isLocalStorageAvailable = this.canUseLocalStorage();\n        } catch (e) {\n            this.isLocalStorageAvailable = false;\n        }\n    }\n\n    /**\n     * Builds a key for the session store\n     * @private\n     * @param  {string} key\n     *\n     * @return {string}\n     */\n    buildKey(key: string): string {\n        return `${KEY_PREFIX}/${SERVICE_VERSION}/${key}`;\n    }\n\n    /**\n     * Test to see browser can use local storage.\n     * See http://stackoverflow.com/questions/14555347\n     * Note that this will return false if we are actually hitting the maximum localStorage\n     * size (5MB / 2.5M chars)\n     *\n     * @private\n     * @return {boolean} True if browser can use localStore\n     */\n    canUseLocalStorage(): boolean {\n        if (!this.localStorage) {\n            return false;\n        }\n\n        try {\n            this.localStorage.setItem(this.buildKey('TestKey'), 'testValue');\n            this.localStorage.removeItem(this.buildKey('TestKey'));\n            return true;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    /**\n     * Set an item\n     *\n     * @param {string} key\n     * @param {*} value\n     *\n     * @return {void}\n     */\n    setItem(key: string, value: any) {\n        if (this.isLocalStorageAvailable) {\n            try {\n                this.localStorage.setItem(this.buildKey(key), JSON.stringify(value));\n            } catch (e) {\n                // no-op\n            }\n        } else {\n            this.memoryStore.set(key, value);\n        }\n    }\n\n    /**\n     * Get an item\n     *\n     * @param  {string} key\n     *\n     * @return {*}\n     */\n    getItem(key: string): ?Object {\n        if (this.isLocalStorageAvailable) {\n            try {\n                const item = this.localStorage.getItem(this.buildKey(key));\n                if (!item) {\n                    return null;\n                }\n\n                return JSON.parse(item);\n            } catch (e) {\n                return null;\n            }\n        } else {\n            return this.memoryStore.get(key);\n        }\n    }\n\n    /**\n     * Remove an item\n     *\n     * @param  {string} key\n     *\n     * @return {void}\n     */\n    removeItem(key: string): void {\n        if (this.isLocalStorageAvailable) {\n            try {\n                this.localStorage.removeItem(this.buildKey(key));\n            } catch (e) {\n                // no-op\n            }\n\n            return;\n        }\n\n        this.memoryStore.unset(key);\n    }\n}\n\nexport default LocalStore;\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,KAAK,MAAM,SAAS;AAG3B,MAAMC,UAAU,GAAG,YAAY;AAC/B,MAAMC,eAAe,GAAG,GAAG;AAE3B,MAAMC,UAAU,CAAC;EAOb;AACJ;AACA;AACA;AACA;EACIC,WAAWA,CAAA,EAAG;IACV,IAAI,CAACC,WAAW,GAAG,IAAIL,KAAK,CAAC,CAAC;IAC9B,IAAI;MACA,IAAI,CAACM,YAAY,GAAGC,MAAM,CAACD,YAAY;MACvC,IAAI,CAACE,uBAAuB,GAAG,IAAI,CAACC,kBAAkB,CAAC,CAAC;IAC5D,CAAC,CAAC,OAAOC,CAAC,EAAE;MACR,IAAI,CAACF,uBAAuB,GAAG,KAAK;IACxC;EACJ;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;EACIG,QAAQA,CAACC,GAAW,EAAU;IAC1B,OAAO,GAAGX,UAAU,IAAIC,eAAe,IAAIU,GAAG,EAAE;EACpD;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIH,kBAAkBA,CAAA,EAAY;IAC1B,IAAI,CAAC,IAAI,CAACH,YAAY,EAAE;MACpB,OAAO,KAAK;IAChB;IAEA,IAAI;MACA,IAAI,CAACA,YAAY,CAACO,OAAO,CAAC,IAAI,CAACF,QAAQ,CAAC,SAAS,CAAC,EAAE,WAAW,CAAC;MAChE,IAAI,CAACL,YAAY,CAACQ,UAAU,CAAC,IAAI,CAACH,QAAQ,CAAC,SAAS,CAAC,CAAC;MACtD,OAAO,IAAI;IACf,CAAC,CAAC,OAAOD,CAAC,EAAE;MACR,OAAO,KAAK;IAChB;EACJ;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;EACIG,OAAOA,CAACD,GAAW,EAAEG,KAAU,EAAE;IAC7B,IAAI,IAAI,CAACP,uBAAuB,EAAE;MAC9B,IAAI;QACA,IAAI,CAACF,YAAY,CAACO,OAAO,CAAC,IAAI,CAACF,QAAQ,CAACC,GAAG,CAAC,EAAEI,IAAI,CAACC,SAAS,CAACF,KAAK,CAAC,CAAC;MACxE,CAAC,CAAC,OAAOL,CAAC,EAAE;QACR;MAAA;IAER,CAAC,MAAM;MACH,IAAI,CAACL,WAAW,CAACa,GAAG,CAACN,GAAG,EAAEG,KAAK,CAAC;IACpC;EACJ;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;EACII,OAAOA,CAACP,GAAW,EAAW;IAC1B,IAAI,IAAI,CAACJ,uBAAuB,EAAE;MAC9B,IAAI;QACA,MAAMY,IAAI,GAAG,IAAI,CAACd,YAAY,CAACa,OAAO,CAAC,IAAI,CAACR,QAAQ,CAACC,GAAG,CAAC,CAAC;QAC1D,IAAI,CAACQ,IAAI,EAAE;UACP,OAAO,IAAI;QACf;QAEA,OAAOJ,IAAI,CAACK,KAAK,CAACD,IAAI,CAAC;MAC3B,CAAC,CAAC,OAAOV,CAAC,EAAE;QACR,OAAO,IAAI;MACf;IACJ,CAAC,MAAM;MACH,OAAO,IAAI,CAACL,WAAW,CAACiB,GAAG,CAACV,GAAG,CAAC;IACpC;EACJ;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;EACIE,UAAUA,CAACF,GAAW,EAAQ;IAC1B,IAAI,IAAI,CAACJ,uBAAuB,EAAE;MAC9B,IAAI;QACA,IAAI,CAACF,YAAY,CAACQ,UAAU,CAAC,IAAI,CAACH,QAAQ,CAACC,GAAG,CAAC,CAAC;MACpD,CAAC,CAAC,OAAOF,CAAC,EAAE;QACR;MAAA;MAGJ;IACJ;IAEA,IAAI,CAACL,WAAW,CAACkB,KAAK,CAACX,GAAG,CAAC;EAC/B;AACJ;AAEA,eAAeT,UAAU","ignoreList":[]}