{"version":3,"file":"VersionsSidebarAPI.js","names":["API","FILE_VERSION_FIELDS_TO_FETCH","FILE_VERSION_FIELDS_TO_FETCH_ARCHIVE","VersionsSidebarAPI","constructor","api","fileId","isArchiveFeatureEnabled","_defineProperty","Promise","all","fetchFile","fetchVersions","then","fetchVersionCurrent","version","resolve","reject","Error","getFileAPI","getDownloadUrl","fields","getFile","forceFetch","getVersionsAPI","getVersions","fileResponse","versionsResponse","file_version","getVersion","id","currentVersionResponse","addCurrentVersion","versionId","permissions","deleteVersion","successCallback","errorCallback","promoteVersion","restoreVersion"],"sources":["../../../../src/elements/content-sidebar/versions/VersionsSidebarAPI.js"],"sourcesContent":["/**\n * @flow\n * @file Versions Sidebar API Helper\n * @author Box\n */\nimport API from '../../../api';\nimport { FILE_VERSION_FIELDS_TO_FETCH, FILE_VERSION_FIELDS_TO_FETCH_ARCHIVE } from '../../../utils/fields';\nimport type { BoxItem, FileVersions, BoxItemVersion } from '../../../common/types/core';\n\nexport type fetchPayload = [BoxItem, FileVersions];\n\nexport default class VersionsSidebarAPI {\n    api: API;\n\n    fileId: string;\n\n    isArchiveFeatureEnabled: boolean;\n\n    constructor({\n        api,\n        fileId,\n        isArchiveFeatureEnabled,\n    }: {\n        api: API,\n        fileId: string,\n        isArchiveFeatureEnabled: boolean,\n    }) {\n        this.api = api;\n        this.fileId = fileId;\n        this.isArchiveFeatureEnabled = isArchiveFeatureEnabled;\n    }\n\n    fetchData = (): Promise<fetchPayload> => {\n        return Promise.all([this.fetchFile(), this.fetchVersions()]).then(this.fetchVersionCurrent);\n    };\n\n    fetchDownloadUrl = (version: ?BoxItemVersion): Promise<string> => {\n        return new Promise((resolve, reject) => {\n            if (!version) {\n                return reject(new Error('Could not find requested version'));\n            }\n\n            return this.api.getFileAPI().getDownloadUrl(this.fileId, version, resolve, reject);\n        });\n    };\n\n    fetchFile = (): Promise<BoxItem> => {\n        const fields = this.isArchiveFeatureEnabled\n            ? FILE_VERSION_FIELDS_TO_FETCH_ARCHIVE\n            : FILE_VERSION_FIELDS_TO_FETCH;\n\n        return new Promise((resolve, reject) =>\n            this.api.getFileAPI().getFile(this.fileId, resolve, reject, {\n                fields,\n                forceFetch: true,\n            }),\n        );\n    };\n\n    fetchVersions = (): Promise<FileVersions> => {\n        return new Promise((resolve, reject) =>\n            this.api.getVersionsAPI(false).getVersions(this.fileId, resolve, reject),\n        );\n    };\n\n    fetchVersionCurrent = ([fileResponse, versionsResponse]: fetchPayload): Promise<fetchPayload> => {\n        const { file_version = {} } = fileResponse;\n\n        return new Promise((resolve, reject) =>\n            this.api.getVersionsAPI(false).getVersion(\n                this.fileId,\n                file_version.id,\n                (currentVersionResponse: BoxItemVersion) => {\n                    resolve([\n                        fileResponse,\n                        this.api\n                            .getVersionsAPI(false)\n                            .addCurrentVersion(currentVersionResponse, versionsResponse, fileResponse),\n                    ]);\n                },\n                reject,\n            ),\n        );\n    };\n\n    fetchVersion = (versionId: string): Promise<BoxItemVersion> => {\n        return new Promise((resolve, reject) =>\n            this.api.getVersionsAPI(false).getVersion(this.fileId, versionId, resolve, reject),\n        );\n    };\n\n    deleteVersion = (version: ?BoxItemVersion): Promise<null> => {\n        const { id: versionId, permissions = {} } = version || {};\n\n        return new Promise((resolve, reject) =>\n            this.api.getVersionsAPI(false).deleteVersion({\n                fileId: this.fileId,\n                permissions,\n                successCallback: resolve,\n                errorCallback: reject,\n                versionId,\n            }),\n        );\n    };\n\n    promoteVersion = (version: ?BoxItemVersion): Promise<BoxItemVersion> => {\n        const { id: versionId, permissions = {} } = version || {};\n\n        return new Promise((resolve, reject) =>\n            this.api.getVersionsAPI(false).promoteVersion({\n                fileId: this.fileId,\n                permissions,\n                successCallback: resolve,\n                errorCallback: reject,\n                versionId,\n            }),\n        );\n    };\n\n    restoreVersion = (version: ?BoxItemVersion): Promise<any> => {\n        const { id: versionId, permissions = {} } = version || {};\n\n        return new Promise((resolve, reject) =>\n            this.api.getVersionsAPI(false).restoreVersion({\n                fileId: this.fileId,\n                permissions,\n                successCallback: resolve,\n                errorCallback: reject,\n                versionId,\n            }),\n        );\n    };\n}\n"],"mappings":"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","ignoreList":[]}