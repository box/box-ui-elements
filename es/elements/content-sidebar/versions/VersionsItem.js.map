{"version":3,"file":"VersionsItem.js","names":["React","FormattedMessage","messages","selectors","sizeUtil","VersionsItemActions","VersionsItemButton","VersionsItemBadge","VersionsItemRetention","ReadableTime","FILE_REQUEST_NAME","VERSION_DELETE_ACTION","VERSION_PROMOTE_ACTION","VERSION_RESTORE_ACTION","VERSION_UPLOAD_ACTION","ACTION_MAP","versionDeletedBy","versionRestoredBy","versionPromotedBy","versionUploadedBy","FILE_EXTENSIONS_OFFICE","FIVE_MINUTES_MS","VersionsItem","fileId","isArchived","isCurrent","isSelected","isWatermarked","onDelete","onDownload","onPreview","onPromote","onRestore","version","versionCount","versionLimit","created_at","createdAt","extension","id","versionId","is_download_available","permissions","restored_at","restoredAt","retention","size","trashed_at","trashedAt","version_number","versionNumber","version_promoted","versionPromoted","can_delete","can_download","can_preview","can_upload","applied_at","retentionAppliedAt","disposition_at","retentionDispositionAt","retentionDispositionAtDate","Date","versionAction","getVersionAction","versionInteger","parseInt","versionTime","versionTimestamp","getTime","versionUserName","getVersionUser","name","createElement","versionUserUnknown","versionDisplayName","fileRequestDisplayName","isDeleted","isDownloadable","isLimited","isOffice","includes","isRestricted","isRetained","canPreview","showDelete","showDownload","showPromote","showRestore","showPreview","hasActions","handleAction","handler","className","isDisabled","onClick","versionCurrent","title","_extends","values","dateTime","alwaysShowTime","relativeThreshold","timestamp","versionLimitExceeded"],"sources":["../../../../src/elements/content-sidebar/versions/VersionsItem.js"],"sourcesContent":["/**\n * @flow\n * @file Versions Item component\n * @author Box\n */\n\nimport * as React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport messages from './messages';\nimport selectors from '../../common/selectors/version';\nimport sizeUtil from '../../../utils/size';\nimport VersionsItemActions from './VersionsItemActions';\nimport VersionsItemButton from './VersionsItemButton';\nimport VersionsItemBadge from './VersionsItemBadge';\nimport VersionsItemRetention from './VersionsItemRetention';\nimport { ReadableTime } from '../../../components/time';\nimport {\n    FILE_REQUEST_NAME,\n    VERSION_DELETE_ACTION,\n    VERSION_PROMOTE_ACTION,\n    VERSION_RESTORE_ACTION,\n    VERSION_UPLOAD_ACTION,\n} from '../../../constants';\nimport type { BoxItemVersion } from '../../../common/types/core';\nimport type { VersionActionCallback } from './flowTypes';\nimport './VersionsItem.scss';\n\ntype Props = {\n    fileId: string,\n    isArchived?: boolean,\n    isCurrent?: boolean,\n    isSelected?: boolean,\n    isWatermarked?: boolean,\n    onDelete?: VersionActionCallback,\n    onDownload?: VersionActionCallback,\n    onPreview?: VersionActionCallback,\n    onPromote?: VersionActionCallback,\n    onRestore?: VersionActionCallback,\n    version: BoxItemVersion,\n    versionCount: number,\n    versionLimit: number,\n};\n\nconst ACTION_MAP = {\n    [VERSION_DELETE_ACTION]: messages.versionDeletedBy,\n    [VERSION_RESTORE_ACTION]: messages.versionRestoredBy,\n    [VERSION_PROMOTE_ACTION]: messages.versionPromotedBy,\n    [VERSION_UPLOAD_ACTION]: messages.versionUploadedBy,\n};\nconst FILE_EXTENSIONS_OFFICE = ['xlsb', 'xlsm', 'xlsx'];\nconst FIVE_MINUTES_MS = 5 * 60 * 1000;\n\nconst VersionsItem = ({\n    fileId,\n    isArchived = false,\n    isCurrent = false,\n    isSelected = false,\n    isWatermarked = false,\n    onDelete,\n    onDownload,\n    onPreview,\n    onPromote,\n    onRestore,\n    version,\n    versionCount,\n    versionLimit,\n}: Props) => {\n    const {\n        created_at: createdAt,\n        extension,\n        id: versionId,\n        is_download_available,\n        permissions = {},\n        restored_at: restoredAt,\n        retention,\n        size,\n        trashed_at: trashedAt,\n        version_number: versionNumber,\n        version_promoted: versionPromoted,\n    } = version;\n    const { can_delete, can_download, can_preview, can_upload } = permissions;\n    const { applied_at: retentionAppliedAt, disposition_at: retentionDispositionAt } = retention || {};\n    const retentionDispositionAtDate = retentionDispositionAt && new Date(retentionDispositionAt);\n\n    // Version info helpers\n    const versionAction = selectors.getVersionAction(version);\n    const versionInteger = versionNumber ? parseInt(versionNumber, 10) : 1;\n    const versionTime = restoredAt || trashedAt || createdAt;\n    const versionTimestamp = versionTime && new Date(versionTime).getTime();\n    const versionUserName = selectors.getVersionUser(version).name || (\n        <FormattedMessage {...messages.versionUserUnknown} />\n    );\n    const versionDisplayName =\n        versionUserName !== FILE_REQUEST_NAME ? (\n            versionUserName\n        ) : (\n            <FormattedMessage {...messages.fileRequestDisplayName} />\n        );\n    // Version state helpers\n    const isDeleted = versionAction === VERSION_DELETE_ACTION;\n    const isDownloadable = !!is_download_available;\n    const isLimited = versionCount - versionInteger >= versionLimit;\n    const isOffice = FILE_EXTENSIONS_OFFICE.includes(extension);\n    const isRestricted = (isOffice || isWatermarked) && !isCurrent;\n    const isRetained = !!retentionAppliedAt && (!retentionDispositionAtDate || retentionDispositionAtDate > new Date());\n\n    // Version action helpers\n    const canPreview = can_preview && !isDeleted && !isLimited && !isRestricted;\n    const showDelete = can_delete && !isDeleted && !isArchived && !isCurrent;\n    const showDownload = can_download && !isDeleted && isDownloadable;\n    const showPromote = can_upload && !isDeleted && !isArchived && !isCurrent;\n    const showRestore = can_delete && isDeleted && !isArchived;\n    const showPreview = canPreview && !isSelected;\n    const hasActions = showDelete || showDownload || showPreview || showPromote || showRestore;\n\n    // Version action callback helper\n    const handleAction = (handler?: VersionActionCallback) => (): void => {\n        if (handler) {\n            handler(versionId);\n        }\n    };\n\n    return (\n        <div className=\"bcs-VersionsItem\">\n            <VersionsItemButton\n                fileId={fileId}\n                isCurrent={isCurrent}\n                isDisabled={!canPreview}\n                isSelected={isSelected}\n                onClick={handleAction(onPreview)}\n            >\n                <div className=\"bcs-VersionsItem-badge\">\n                    <VersionsItemBadge versionNumber={versionNumber} />\n                </div>\n\n                <div className=\"bcs-VersionsItem-details\">\n                    {isCurrent && (\n                        <div className=\"bcs-VersionsItem-current\">\n                            <FormattedMessage {...messages.versionCurrent} />\n                        </div>\n                    )}\n\n                    <div className=\"bcs-VersionsItem-log\" data-testid=\"bcs-VersionsItem-log\" title={versionDisplayName}>\n                        <FormattedMessage\n                            {...ACTION_MAP[versionAction]}\n                            values={{ name: versionDisplayName, versionPromoted }}\n                        />\n                    </div>\n\n                    <div className=\"bcs-VersionsItem-info\" data-testid=\"bcs-VersionsItem-info\">\n                        {versionTimestamp && (\n                            <time className=\"bcs-VersionsItem-date\" dateTime={versionTime}>\n                                <ReadableTime\n                                    alwaysShowTime\n                                    relativeThreshold={FIVE_MINUTES_MS}\n                                    timestamp={versionTimestamp}\n                                />\n                            </time>\n                        )}\n                        {!!size && <span className=\"bcs-VersionsItem-size\">{sizeUtil(size)}</span>}\n                    </div>\n\n                    {isRetained && (\n                        <div className=\"bcs-VersionsItem-retention\" data-testid=\"bcs-VersionsItem-retention\">\n                            <VersionsItemRetention retention={retention} />\n                        </div>\n                    )}\n\n                    {isLimited && hasActions && (\n                        <div className=\"bcs-VersionsItem-footer\">\n                            <FormattedMessage {...messages.versionLimitExceeded} values={{ versionLimit }} />\n                        </div>\n                    )}\n                </div>\n            </VersionsItemButton>\n\n            {!isLimited && hasActions && (\n                <VersionsItemActions\n                    fileId={fileId}\n                    isCurrent={isCurrent}\n                    isRetained={isRetained}\n                    onDelete={handleAction(onDelete)}\n                    onDownload={handleAction(onDownload)}\n                    onPreview={handleAction(onPreview)}\n                    onPromote={handleAction(onPromote)}\n                    onRestore={handleAction(onRestore)}\n                    showDelete={showDelete}\n                    showDownload={showDownload}\n                    showPreview={showPreview}\n                    showPromote={showPromote}\n                    showRestore={showRestore}\n                />\n            )}\n        </div>\n    );\n};\nexport default VersionsItem;\n"],"mappings":"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","ignoreList":[]}