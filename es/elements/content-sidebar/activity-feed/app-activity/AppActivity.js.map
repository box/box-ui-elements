{"version":3,"file":"AppActivity.js","names":["React","classNames","getProp","noop","TetherComponent","FormattedMessage","injectIntl","ActivityCard","ActivityTimestamp","DeleteConfirmation","IconTrash","Media","messages","bdlGray80","Link","MenuItem","mapActivityNodes","node","dataset","href","tagName","textContent","createElement","resinTarget","resinAction","key","rel","className","target","AppActivity","PureComponent","constructor","args","_defineProperty","DOMParser","isConfirmingDelete","setState","id","onDelete","permissions","props","rendered_text","renderedText","doc","parser","parseFromString","childNodes","Array","from","render","activity_template","templateId","app","name","icon_url","created_at","createdAt","created_by","createdBy","currentUser","error","intl","isPending","canDelete","createdAtTimestamp","Date","getTime","isMenuVisible","state","Figure","alt","formatMessage","appActivityAltIcon","appActivityName","src","Body","attachment","constraints","to","targetAttachment","renderTarget","ref","style","display","Menu","isDisabled","onClick","handleDeleteClick","color","appActivityDeleteMenuItem","renderElement","isOpen","message","appActivityDeletePrompt","onDeleteCancel","handleDeleteCancel","onDeleteConfirm","handleDeleteConfirm","date","parseActivity","map"],"sources":["../../../../../src/elements/content-sidebar/activity-feed/app-activity/AppActivity.js"],"sourcesContent":["/**\n * @flow\n * @file AppActivity component\n */\n\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport getProp from 'lodash/get';\nimport noop from 'lodash/noop';\nimport TetherComponent from 'react-tether';\nimport { FormattedMessage, injectIntl } from 'react-intl';\n\nimport ActivityCard from '../ActivityCard';\nimport ActivityTimestamp from '../common/activity-timestamp';\nimport DeleteConfirmation from '../common/delete-confirmation';\nimport IconTrash from '../../../../icons/general/IconTrash';\nimport Media from '../../../../components/media';\nimport messages from './messages';\nimport { bdlGray80 } from '../../../../styles/variables';\nimport { Link } from '../../../../components/link';\nimport { MenuItem } from '../../../../components/menu';\nimport type { AppItem, ActivityTemplateItem, ActionItemError } from '../../../../common/types/feed';\nimport type { User, BoxItemPermission } from '../../../../common/types/core';\nimport './AppActivity.scss';\n\ntype Props = {\n    activity_template: ActivityTemplateItem,\n    app: AppItem,\n    created_at: string,\n    created_by: User,\n    currentUser?: User,\n    error?: ActionItemError,\n    id: string,\n    intl: any,\n    isPending?: boolean,\n    onDelete: ({ id: string, permissions?: {} }) => void,\n    permissions?: BoxItemPermission,\n    rendered_text: string,\n};\n\ntype State = {\n    isConfirmingDelete: boolean,\n};\n\nfunction mapActivityNodes(node: HTMLLinkElement): React.Node {\n    const { dataset = {}, href = '#', tagName, textContent } = node;\n\n    switch (tagName) {\n        case 'A':\n            return (\n                <Link\n                    href={href}\n                    data-resin-target={dataset.resinTarget}\n                    data-resin-action={dataset.resinAction}\n                    key={`app_actvity_link_${href}`}\n                    rel=\"roreferrer noopener\"\n                    className=\"bcs-AppActivity-link\"\n                    target=\"_blank\"\n                >\n                    {textContent}\n                </Link>\n            );\n        default:\n            return textContent;\n    }\n}\n\nclass AppActivity extends React.PureComponent<Props, State> {\n    static defaultProps = {\n        onDelete: noop,\n        permissions: {},\n    };\n\n    parser = new DOMParser();\n\n    state: State = {\n        isConfirmingDelete: false,\n    };\n\n    handleDeleteCancel = (): void => {\n        this.setState({ isConfirmingDelete: false });\n    };\n\n    handleDeleteClick = () => {\n        this.setState({ isConfirmingDelete: true });\n    };\n\n    handleDeleteConfirm = (): void => {\n        const { id, onDelete, permissions } = this.props;\n\n        onDelete({ id, permissions });\n    };\n\n    parseActivity = (): Array<HTMLLinkElement> => {\n        const { rendered_text: renderedText } = this.props;\n        const doc: Document = this.parser.parseFromString(renderedText, 'text/html');\n        if (!doc) {\n            return [];\n        }\n\n        const childNodes = getProp(doc, 'body.childNodes', []);\n        return Array.from(childNodes);\n    };\n\n    render() {\n        const {\n            activity_template: { id: templateId },\n            app: { name, icon_url },\n            created_at: createdAt,\n            created_by: createdBy,\n            currentUser,\n            error,\n            intl,\n            isPending,\n            permissions,\n        } = this.props;\n\n        const canDelete = getProp(permissions, 'can_delete', false) || (currentUser && currentUser.id === createdBy.id);\n        const createdAtTimestamp = new Date(createdAt).getTime();\n        const isMenuVisible = canDelete && !isPending;\n        const { isConfirmingDelete } = this.state;\n\n        return (\n            <ActivityCard\n                className=\"bcs-AppActivity\"\n                data-resin-target=\"loaded\"\n                data-resin-feature={`appActivityCard${templateId}`}\n            >\n                <Media\n                    className={classNames({\n                        'bcs-is-pending': isPending || error,\n                    })}\n                >\n                    <Media.Figure>\n                        <img\n                            className=\"bcs-AppActivity-icon\"\n                            alt={intl.formatMessage(messages.appActivityAltIcon, { appActivityName: name })}\n                            src={icon_url}\n                        />\n                    </Media.Figure>\n\n                    <Media.Body className=\"bcs-AppActivity-body\">\n                        {isMenuVisible && (\n                            <TetherComponent\n                                attachment=\"top right\"\n                                className=\"bcs-AppActivity-confirm\"\n                                constraints={[{ to: 'scrollParent', attachment: 'together' }]}\n                                targetAttachment=\"bottom right\"\n                                renderTarget={ref => (\n                                    <div ref={ref} style={{ display: 'inline-block' }}>\n                                        <Media.Menu isDisabled={isConfirmingDelete}>\n                                            <MenuItem onClick={this.handleDeleteClick}>\n                                                <IconTrash color={bdlGray80} />\n                                                <FormattedMessage {...messages.appActivityDeleteMenuItem} />\n                                            </MenuItem>\n                                        </Media.Menu>\n                                    </div>\n                                )}\n                                renderElement={ref => {\n                                    return isConfirmingDelete ? (\n                                        <div ref={ref}>\n                                            <DeleteConfirmation\n                                                isOpen={isConfirmingDelete}\n                                                message={messages.appActivityDeletePrompt}\n                                                onDeleteCancel={this.handleDeleteCancel}\n                                                onDeleteConfirm={this.handleDeleteConfirm}\n                                            />\n                                        </div>\n                                    ) : null;\n                                }}\n                            />\n                        )}\n\n                        <figcaption className=\"bcs-AppActivity-headline\">{name}</figcaption>\n\n                        <div>\n                            <ActivityTimestamp date={createdAtTimestamp} />\n                        </div>\n\n                        {this.parseActivity().map(mapActivityNodes)}\n                    </Media.Body>\n                </Media>\n            </ActivityCard>\n        );\n    }\n}\n\nexport default injectIntl(AppActivity);\n"],"mappings":"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","ignoreList":[]}