{"version":3,"file":"AnnotationThread.js","names":["React","debounce","classNames","IntlProvider","AnnotationThreadContent","AnnotationThreadCreate","useAnnotationThread","API","DEFAULT_COLLAB_DEBOUNCE","DEFAULT_HOSTNAME_API","AnnotationThread","annotationId","apiHost","cache","className","clientName","currentUser","eventEmitter","file","getUserProfileUrl","handleCancel","language","messages","onAnnotationCreate","onError","target","token","mentionSelectorContacts","setMentionSelectorContacts","useState","api","annotation","replies","isLoading","error","annotationActions","handleAnnotationCreate","handleAnnotationDelete","handleAnnotationEdit","handleAnnotationStatusChange","repliesActions","handleReplyEdit","handleReplyCreate","handleReplyDelete","errorCallback","getAvatarUrl","userId","getUsersAPI","getAvatarUrlWithAccessToken","id","getMentionContactsSuccessCallback","entries","getMentionWithQuery","searchStr","getFileCollaboratorsAPI","getCollaboratorsWithQuery","createElement","locale","isPending","onFormCancel","onFormSubmit","onAnnotationDelete","onAnnotationEdit","onAnnotationStatusChange","onReplyCreate","onReplyDelete","onReplyEdit"],"sources":["../../../../../src/elements/content-sidebar/activity-feed/annotation-thread/AnnotationThread.js"],"sourcesContent":["/**\n * @flow\n * @file Annotation Thread Container\n * @author Box\n */\n\nimport * as React from 'react';\nimport debounce from 'lodash/debounce';\nimport classNames from 'classnames';\nimport { IntlProvider } from 'react-intl';\nimport type EventEmitter from 'events';\nimport AnnotationThreadContent from './AnnotationThreadContent';\nimport AnnotationThreadCreate from './AnnotationThreadCreate';\nimport useAnnotationThread from './useAnnotationThread';\nimport API from '../../../../api/APIFactory';\nimport { DEFAULT_COLLAB_DEBOUNCE, DEFAULT_HOSTNAME_API } from '../../../../constants';\n\nimport type APICache from '../../../../utils/Cache';\nimport type { BoxItem, SelectorItems, StringMap, Token, User } from '../../../../common/types/core';\nimport type { ElementOrigin, ElementsXhrError } from '../../../../common/types/api';\nimport type { Annotation, Target } from '../../../../common/types/annotations';\nimport type { GetProfileUrlCallback } from '../../../common/flowTypes';\n\nimport './AnnotationThread.scss';\n\ntype Props = {\n    annotationId?: string,\n    apiHost?: string,\n    cache?: APICache,\n    className?: string,\n    clientName: string,\n    currentUser: User,\n    eventEmitter: EventEmitter,\n    file: BoxItem,\n    getUserProfileUrl?: GetProfileUrlCallback,\n    handleCancel: () => void,\n    language?: string,\n    messages?: StringMap,\n    onAnnotationCreate: (annotation: Annotation) => void,\n    onError: (error: ElementsXhrError | Error, code: string, contextInfo?: Object, origin?: ElementOrigin) => void,\n    target: Target,\n    token: Token,\n};\n\nconst AnnotationThread = ({\n    annotationId,\n    apiHost = DEFAULT_HOSTNAME_API,\n    cache,\n    className = '',\n    clientName,\n    currentUser,\n    eventEmitter,\n    file,\n    getUserProfileUrl,\n    handleCancel,\n    language,\n    messages,\n    onAnnotationCreate,\n    onError,\n    target,\n    token,\n}: Props) => {\n    const [mentionSelectorContacts, setMentionSelectorContacts] = React.useState<SelectorItems<>>([]);\n\n    const api = new API({\n        apiHost,\n        cache,\n        clientName,\n        language,\n        token,\n    });\n\n    const {\n        annotation,\n        replies,\n        isLoading,\n        error,\n        annotationActions: {\n            handleAnnotationCreate,\n            handleAnnotationDelete,\n            handleAnnotationEdit,\n            handleAnnotationStatusChange,\n        },\n        repliesActions: { handleReplyEdit, handleReplyCreate, handleReplyDelete },\n    } = useAnnotationThread({\n        api,\n        annotationId,\n        currentUser,\n        errorCallback: onError,\n        eventEmitter,\n        file,\n        onAnnotationCreate,\n        target,\n    });\n\n    const getAvatarUrl = async (userId: string): Promise<?string> =>\n        api.getUsersAPI(false).getAvatarUrlWithAccessToken(userId, file.id);\n\n    const getMentionContactsSuccessCallback = ({ entries }: { entries: SelectorItems<> }): void => {\n        setMentionSelectorContacts(entries);\n    };\n\n    const getMentionWithQuery = debounce(searchStr => {\n        api.getFileCollaboratorsAPI(false).getCollaboratorsWithQuery(\n            file.id,\n            getMentionContactsSuccessCallback,\n            onError,\n            searchStr,\n        );\n    }, DEFAULT_COLLAB_DEBOUNCE);\n\n    return (\n        <div className={classNames('AnnotationThread', className)} data-testid=\"annotation-thread\">\n            <IntlProvider locale={language} messages={messages}>\n                {!annotationId ? (\n                    <AnnotationThreadCreate\n                        currentUser={currentUser}\n                        getAvatarUrl={getAvatarUrl}\n                        getMentionWithQuery={getMentionWithQuery}\n                        isPending={isLoading}\n                        mentionSelectorContacts={mentionSelectorContacts}\n                        onFormCancel={handleCancel}\n                        onFormSubmit={handleAnnotationCreate}\n                    />\n                ) : (\n                    <AnnotationThreadContent\n                        annotation={annotation}\n                        currentUser={currentUser}\n                        error={error}\n                        getAvatarUrl={getAvatarUrl}\n                        getMentionWithQuery={getMentionWithQuery}\n                        getUserProfileUrl={getUserProfileUrl}\n                        isLoading={isLoading}\n                        mentionSelectorContacts={mentionSelectorContacts}\n                        onAnnotationDelete={handleAnnotationDelete}\n                        onAnnotationEdit={handleAnnotationEdit}\n                        onAnnotationStatusChange={handleAnnotationStatusChange}\n                        onReplyCreate={handleReplyCreate}\n                        onReplyDelete={handleReplyDelete}\n                        onReplyEdit={handleReplyEdit}\n                        replies={replies}\n                    />\n                )}\n            </IntlProvider>\n        </div>\n    );\n};\n\nexport default AnnotationThread;\n"],"mappings":"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","ignoreList":[]}