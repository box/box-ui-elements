{"version":3,"file":"useAnnotationThread.js","names":["React","uniqueId","commonMessages","annotationErrors","commentsErrors","API","useRepliesAPI","useAnnotatorEvents","useAnnotationAPI","normalizeReplies","repliesArray","reduce","prevValues","reply","_objectSpread","id","denormalizeReplies","repliesMap","Object","keys","map","key","useAnnotationThread","annotationId","api","currentUser","errorCallback","eventEmitter","file","onAnnotationCreate","target","annotation","setAnnotation","useState","replies","setReplies","error","setError","isLoading","setIsLoading","file_version","fileVersionId","fileId","permissions","filePermissions","updateOrCreateReplyItem","replyId","updatedReplyValues","prevReplies","removeReplyItem","newReplies","addPendingReply","baseReply","requestId","date","Date","toISOString","pendingReply","created_at","created_by","isPending","modified_at","isCurrentAnnotation","handleAnnotationUpdateStartEvent","updatedAnnotation","prevAnnotation","handleAnnotationUpdateEndEvent","handleAnnotationDeleteStartEvent","originAnnotationId","handleAnnotationReplyAddStartEvent","handleAnnotationReplyAddEndEvent","handleAnnotationReplyUpdateStart","handleAnnotationReplyUpdateEnd","handleAnnotationReplyDeleteStart","handleAnnotationReplyDeleteEnd","emitAddAnnotationEndEvent","emitAddAnnotationReplyEndEvent","emitAddAnnotationReplyStartEvent","emitAddAnnotationStartEvent","emitAnnotationActiveChangeEvent","emitDeleteAnnotationEndEvent","emitDeleteAnnotationReplyEndEvent","emitDeleteAnnotationReplyStartEvent","emitDeleteAnnotationStartEvent","emitUpdateAnnotationEndEvent","emitUpdateAnnotationReplyEndEvent","emitUpdateAnnotationReplyStartEvent","emitUpdateAnnotationStartEvent","onAnnotationDeleteStart","onAnnotationReplyAddEnd","onAnnotationReplyAddStart","onAnnotationReplyUpdateEnd","onAnnotationReplyUpdateStart","onAnnotationUpdateEnd","onAnnotationUpdateStart","onAnnotationReplyDeleteEnd","onAnnotationReplyDeleteStart","handleUpdateAnnotation","updatedValues","annotationErrorCallback","useCallback","e","code","title","errorOccured","message","default","handleCreate","handleDelete","handleEdit","handleFetch","handleStatusChange","replyErrorCallback","createReply","deleteReply","editReply","handleAnnotationCreate","text","successCallback","newAnnotation","payload","description","handleAnnotationDelete","annotationDeleteSuccessCallback","onAnnotationEditSuccessCallback","handleAnnotationEdit","handleAnnotationStatusChange","status","handleReplyCreate","replyData","tagged_message","type","comment","handleReplyEdit","hasMention","updates","handleReplyDelete","useEffect","_ref","fetchedReplies","normalizedAnnotation","_objectWithoutProperties","_excluded","undefined","annotationActions","repliesActions"],"sources":["../../../../../src/elements/content-sidebar/activity-feed/annotation-thread/useAnnotationThread.js"],"sourcesContent":["// @flow\n\nimport * as React from 'react';\nimport uniqueId from 'lodash/uniqueId';\nimport type EventEmitter from 'events';\nimport commonMessages from '../../../common/messages';\nimport { annotationErrors, commentsErrors } from './errors';\nimport API from '../../../../api/APIFactory';\nimport useRepliesAPI from './useRepliesAPI';\nimport { useAnnotatorEvents } from '../../../common/annotator-context';\nimport useAnnotationAPI from './useAnnotationAPI';\nimport type { Annotation, AnnotationPermission, NewAnnotation, Target } from '../../../../common/types/annotations';\nimport type { BoxItem, User } from '../../../../common/types/core';\nimport type { BoxCommentPermission, Comment, FeedItemStatus } from '../../../../common/types/feed';\nimport type { ElementOrigin, ElementsXhrError } from '../../../../common/types/api';\nimport type { AnnotationThreadError } from './types';\nimport type { OnAnnotationEdit, OnAnnotationStatusChange } from '../comment/types';\n\nconst normalizeReplies = (repliesArray?: Array<Comment>): { [string]: Comment } => {\n    if (!repliesArray) {\n        return {};\n    }\n    return repliesArray.reduce((prevValues, reply) => {\n        return {\n            ...prevValues,\n            [reply.id]: reply,\n        };\n    }, {});\n};\n\nconst denormalizeReplies = (repliesMap: { [string]: Comment }): Array<Comment> => {\n    return Object.keys(repliesMap).map(key => repliesMap[key]);\n};\n\ntype Props = {\n    annotationId?: string,\n    api: API,\n    currentUser: User,\n    errorCallback: (\n        error: ElementsXhrError | Error,\n        code: string,\n        contextInfo?: Object,\n        origin?: ElementOrigin,\n    ) => void,\n    eventEmitter: EventEmitter,\n    file: BoxItem,\n    onAnnotationCreate: (annotation: Annotation) => void,\n    target: Target,\n};\n\ntype UseAnnotationThread = {\n    annotation?: Annotation,\n    annotationActions: {\n        handleAnnotationCreate: (text: string) => void,\n        handleAnnotationDelete: ({ id: string, permissions: AnnotationPermission }) => void,\n        handleAnnotationEdit: OnAnnotationEdit,\n        handleAnnotationStatusChange: OnAnnotationStatusChange,\n    },\n    error?: AnnotationThreadError,\n    isLoading: boolean,\n    replies: Array<Comment>,\n    repliesActions: {\n        handleReplyCreate: (message: string) => void,\n        handleReplyDelete: ({ id: string, permissions: BoxCommentPermission }) => void,\n        handleReplyEdit: (\n            replyId: string,\n            message: string,\n            status?: FeedItemStatus,\n            hasMention?: boolean,\n            permissions: BoxCommentPermission,\n        ) => void,\n    },\n};\n\nconst useAnnotationThread = ({\n    annotationId,\n    api,\n    currentUser,\n    errorCallback,\n    eventEmitter,\n    file,\n    onAnnotationCreate,\n    target,\n}: Props): UseAnnotationThread => {\n    const [annotation, setAnnotation] = React.useState<Annotation | typeof undefined>();\n    const [replies, setReplies] = React.useState<{ [string]: Comment }>({});\n    const [error, setError] = React.useState<AnnotationThreadError | typeof undefined>();\n    const [isLoading, setIsLoading] = React.useState<boolean>(false);\n\n    const { file_version: { id: fileVersionId } = {}, id: fileId, permissions: filePermissions = {} } = file;\n\n    const updateOrCreateReplyItem = (replyId: string, updatedReplyValues: Object) => {\n        setReplies(prevReplies => ({\n            ...prevReplies,\n            [replyId]: {\n                ...prevReplies[replyId],\n                ...updatedReplyValues,\n            },\n        }));\n    };\n\n    const removeReplyItem = (replyId: string) => {\n        setReplies(prevReplies => {\n            const newReplies = { ...prevReplies };\n            delete newReplies[replyId];\n            return newReplies;\n        });\n    };\n\n    const addPendingReply = (baseReply: Object, requestId: string) => {\n        const date = new Date().toISOString();\n        const pendingReply: Comment = {\n            created_at: date,\n            created_by: currentUser,\n            id: requestId,\n            isPending: true,\n            modified_at: date,\n            ...baseReply,\n        };\n        updateOrCreateReplyItem(requestId, pendingReply);\n    };\n\n    const isCurrentAnnotation = (id: string) => annotationId === id;\n\n    const handleAnnotationUpdateStartEvent = (updatedAnnotation: Annotation) => {\n        if (!isCurrentAnnotation(updatedAnnotation.id) || !annotation) {\n            return;\n        }\n        setAnnotation(prevAnnotation => ({ ...prevAnnotation, ...updatedAnnotation, isPending: true }));\n    };\n\n    const handleAnnotationUpdateEndEvent = (updatedAnnotation: Annotation) => {\n        if (!isCurrentAnnotation(updatedAnnotation.id) || !annotation) {\n            return;\n        }\n        setAnnotation(prevAnnotation => ({ ...prevAnnotation, ...updatedAnnotation, isPending: false }));\n    };\n\n    const handleAnnotationDeleteStartEvent = (originAnnotationId: string) => {\n        if (!isCurrentAnnotation(originAnnotationId) || !annotation) {\n            return;\n        }\n        setAnnotation(prevAnnotation => ({ ...prevAnnotation, isPending: true }));\n    };\n\n    const handleAnnotationReplyAddStartEvent = ({ annotationId: originAnnotationId, reply, requestId }) => {\n        if (!isCurrentAnnotation(originAnnotationId)) {\n            return;\n        }\n        addPendingReply(reply, requestId);\n    };\n\n    const handleAnnotationReplyAddEndEvent = ({ annotationId: originAnnotationId, reply, requestId }) => {\n        if (!isCurrentAnnotation(originAnnotationId)) {\n            return;\n        }\n        updateOrCreateReplyItem(requestId, { ...reply, isPending: false });\n    };\n\n    const handleAnnotationReplyUpdateStart = ({ annotationId: originAnnotationId, reply }) => {\n        if (!isCurrentAnnotation(originAnnotationId)) {\n            return;\n        }\n        updateOrCreateReplyItem(reply.id, { ...reply, isPending: true });\n    };\n\n    const handleAnnotationReplyUpdateEnd = ({ annotationId: originAnnotationId, reply }) => {\n        if (!isCurrentAnnotation(originAnnotationId)) {\n            return;\n        }\n        updateOrCreateReplyItem(reply.id, { ...reply, isPending: false });\n    };\n\n    const handleAnnotationReplyDeleteStart = ({ annotationId: originAnnotationId, id: replyId }) => {\n        if (!isCurrentAnnotation(originAnnotationId)) {\n            return;\n        }\n        updateOrCreateReplyItem(replyId, { isPending: true });\n    };\n\n    const handleAnnotationReplyDeleteEnd = ({ annotationId: originAnnotationId, id: replyId }) => {\n        if (!isCurrentAnnotation(originAnnotationId)) {\n            return;\n        }\n        removeReplyItem(replyId);\n    };\n\n    const {\n        emitAddAnnotationEndEvent,\n        emitAddAnnotationReplyEndEvent,\n        emitAddAnnotationReplyStartEvent,\n        emitAddAnnotationStartEvent,\n        emitAnnotationActiveChangeEvent,\n        emitDeleteAnnotationEndEvent,\n        emitDeleteAnnotationReplyEndEvent,\n        emitDeleteAnnotationReplyStartEvent,\n        emitDeleteAnnotationStartEvent,\n        emitUpdateAnnotationEndEvent,\n        emitUpdateAnnotationReplyEndEvent,\n        emitUpdateAnnotationReplyStartEvent,\n        emitUpdateAnnotationStartEvent,\n    } = useAnnotatorEvents({\n        eventEmitter,\n        onAnnotationDeleteStart: handleAnnotationDeleteStartEvent,\n        onAnnotationReplyAddEnd: handleAnnotationReplyAddEndEvent,\n        onAnnotationReplyAddStart: handleAnnotationReplyAddStartEvent,\n        onAnnotationReplyUpdateEnd: handleAnnotationReplyUpdateEnd,\n        onAnnotationReplyUpdateStart: handleAnnotationReplyUpdateStart,\n        onAnnotationUpdateEnd: handleAnnotationUpdateEndEvent,\n        onAnnotationUpdateStart: handleAnnotationUpdateStartEvent,\n        onAnnotationReplyDeleteEnd: handleAnnotationReplyDeleteEnd,\n        onAnnotationReplyDeleteStart: handleAnnotationReplyDeleteStart,\n    });\n\n    const handleUpdateAnnotation = (updatedValues: Object) => {\n        setAnnotation(prevAnnotation => ({ ...prevAnnotation, ...updatedValues }));\n    };\n\n    const annotationErrorCallback = React.useCallback(\n        (e: ElementsXhrError, code: string): void => {\n            setIsLoading(false);\n            setError({\n                title: commonMessages.errorOccured,\n                message: annotationErrors[code] || annotationErrors.default,\n            });\n\n            errorCallback(e, code, {\n                error: e,\n            });\n        },\n        [errorCallback],\n    );\n\n    const { handleCreate, handleDelete, handleEdit, handleFetch, handleStatusChange } = useAnnotationAPI({\n        api,\n        file,\n        errorCallback: annotationErrorCallback,\n    });\n\n    const replyErrorCallback = React.useCallback(\n        (replyId: string, e: ElementsXhrError, code: string): void => {\n            updateOrCreateReplyItem(replyId, {\n                error: {\n                    title: commonMessages.errorOccured,\n                    message: commentsErrors[code] || commentsErrors.default,\n                },\n            });\n\n            errorCallback(e, code, {\n                error: e,\n            });\n        },\n        [errorCallback],\n    );\n\n    const { createReply, deleteReply, editReply } = useRepliesAPI({\n        annotationId,\n        api,\n        errorCallback: replyErrorCallback,\n        fileId,\n        filePermissions,\n    });\n\n    const handleAnnotationCreate = (text: string) => {\n        setIsLoading(true);\n\n        const requestId = uniqueId('annotation_');\n\n        const successCallback = (newAnnotation: Annotation) => {\n            setIsLoading(false);\n            emitAddAnnotationEndEvent(newAnnotation, requestId);\n            onAnnotationCreate(newAnnotation);\n        };\n\n        const payload: NewAnnotation = {\n            description: { message: text },\n            target,\n        };\n\n        emitAddAnnotationStartEvent(payload, requestId);\n\n        handleCreate({ payload, successCallback });\n    };\n\n    const handleAnnotationDelete = ({ id, permissions }: { id: string, permissions: AnnotationPermission }): void => {\n        const annotationDeleteSuccessCallback = () => {\n            emitDeleteAnnotationEndEvent(id);\n        };\n\n        setAnnotation(prevAnnotation => ({ ...prevAnnotation, isPending: true }));\n\n        emitDeleteAnnotationStartEvent(id);\n\n        handleDelete({\n            id,\n            permissions,\n            successCallback: annotationDeleteSuccessCallback,\n        });\n    };\n\n    const onAnnotationEditSuccessCallback = (updatedAnnotation: Annotation): void => {\n        handleUpdateAnnotation({\n            ...updatedAnnotation,\n            isPending: false,\n        });\n\n        emitUpdateAnnotationEndEvent(updatedAnnotation);\n    };\n\n    const handleAnnotationEdit = ({ id, text, permissions }): void => {\n        setAnnotation(prevAnnotation => ({ ...prevAnnotation, isPending: true }));\n\n        emitUpdateAnnotationStartEvent({\n            id,\n            description: { message: text },\n        });\n\n        handleEdit({\n            id,\n            text: text ?? '',\n            permissions,\n            successCallback: onAnnotationEditSuccessCallback,\n        });\n    };\n\n    const handleAnnotationStatusChange: OnAnnotationStatusChange = ({ id, permissions, status }): void => {\n        setAnnotation(prevAnnotation => ({ ...prevAnnotation, isPending: true }));\n\n        handleStatusChange({\n            id,\n            status,\n            permissions,\n            successCallback: onAnnotationEditSuccessCallback,\n        });\n    };\n\n    const handleReplyCreate = (message: string) => {\n        const requestId = uniqueId('reply_');\n        const replyData = {\n            tagged_message: message,\n            type: 'comment',\n        };\n\n        const successCallback = (comment: Comment) => {\n            updateOrCreateReplyItem(requestId, { ...comment, isPending: false });\n            emitAddAnnotationReplyEndEvent(comment, annotationId, requestId);\n        };\n\n        addPendingReply(replyData, requestId);\n        emitAddAnnotationReplyStartEvent(replyData, annotationId, requestId);\n\n        createReply({ message, requestId, successCallback });\n    };\n\n    const handleReplyEdit = (\n        replyId: string,\n        message: string,\n        status?: FeedItemStatus,\n        hasMention?: boolean,\n        permissions: BoxCommentPermission,\n    ) => {\n        const updates = {\n            id: replyId,\n            tagged_message: message,\n        };\n\n        const successCallback = (comment: Comment) => {\n            updateOrCreateReplyItem(comment.id, { ...comment, isPending: false });\n            emitUpdateAnnotationReplyEndEvent(comment, annotationId);\n        };\n\n        updateOrCreateReplyItem(replyId, { message, isPending: true });\n        emitUpdateAnnotationReplyStartEvent(updates, annotationId);\n\n        editReply({ id: replyId, message, permissions, successCallback });\n    };\n\n    const handleReplyDelete = ({ id, permissions }: { id: string, permissions: BoxCommentPermission }) => {\n        updateOrCreateReplyItem(id, { isPending: true });\n        emitDeleteAnnotationReplyStartEvent(id, annotationId);\n\n        const successCallback = () => {\n            removeReplyItem(id);\n            emitDeleteAnnotationReplyEndEvent(id, annotationId);\n        };\n\n        deleteReply({ id, permissions, successCallback });\n    };\n\n    React.useEffect(() => {\n        if (!annotationId || isLoading || (annotation && annotation.id === annotationId)) {\n            return;\n        }\n        setIsLoading(true);\n        handleFetch({\n            id: annotationId,\n            successCallback: ({ replies: fetchedReplies, ...normalizedAnnotation }: Annotation) => {\n                setAnnotation({ ...normalizedAnnotation });\n                setReplies(normalizeReplies(fetchedReplies));\n                setError(undefined);\n                setIsLoading(false);\n                emitAnnotationActiveChangeEvent(normalizedAnnotation.id, fileVersionId);\n            },\n        });\n    }, [annotation, annotationId, emitAnnotationActiveChangeEvent, fileVersionId, handleFetch, isLoading]);\n\n    return {\n        annotation,\n        error,\n        isLoading,\n        replies: denormalizeReplies(replies),\n        annotationActions: {\n            handleAnnotationCreate,\n            handleAnnotationDelete,\n            handleAnnotationEdit,\n            handleAnnotationStatusChange,\n        },\n        repliesActions: {\n            handleReplyCreate,\n            handleReplyEdit,\n            handleReplyDelete,\n        },\n    };\n};\n\nexport default useAnnotationThread;\n"],"mappings":"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","ignoreList":[]}