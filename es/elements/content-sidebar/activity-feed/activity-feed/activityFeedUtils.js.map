{"version":3,"file":"activityFeedUtils.js","names":["selectors","FEED_ITEM_TYPE_VERSION","PLACEHOLDER_USER","VERSION_UPLOAD_ACTION","ItemTypes","fileVersion","collapseFeedState","feedState","reduce","collapsedFeedState","feedItem","previousFeedItem","pop","concat","type","getVersionAction","modified_by","tmpModifiedBy","versions","version_start","parseInt","version_number","version_end","prevModifiedBy","tmpCurModifiedBy","created_at","trashed_at","id","parsedVersionNumber","collaborators","_objectSpread","modifiedBy","Math","min","max"],"sources":["../../../../../src/elements/content-sidebar/activity-feed/activity-feed/activityFeedUtils.js"],"sourcesContent":["/**\n * @flow\n * @file Activity feed utility methods\n */\n\nimport selectors from '../../../common/selectors/version';\nimport { FEED_ITEM_TYPE_VERSION, PLACEHOLDER_USER, VERSION_UPLOAD_ACTION } from '../../../../constants';\nimport type { FeedItems } from '../../../../common/types/feed';\n\nexport const ItemTypes = {\n    fileVersion: FEED_ITEM_TYPE_VERSION,\n};\n\nexport function collapseFeedState(feedState: ?FeedItems): FeedItems {\n    if (!feedState) {\n        return [];\n    }\n\n    return feedState.reduce((collapsedFeedState, feedItem) => {\n        const previousFeedItem = collapsedFeedState.pop();\n\n        if (!previousFeedItem) {\n            return collapsedFeedState.concat([feedItem]);\n        }\n\n        if (\n            feedItem.type === ItemTypes.fileVersion &&\n            previousFeedItem.type === ItemTypes.fileVersion &&\n            selectors.getVersionAction(feedItem) === VERSION_UPLOAD_ACTION &&\n            selectors.getVersionAction(previousFeedItem) === VERSION_UPLOAD_ACTION\n        ) {\n            const {\n                modified_by: tmpModifiedBy,\n                versions = [previousFeedItem],\n                version_start = parseInt(previousFeedItem.version_number, 10),\n                version_end = parseInt(previousFeedItem.version_number, 10),\n            } = previousFeedItem;\n\n            const prevModifiedBy = tmpModifiedBy || PLACEHOLDER_USER;\n\n            const { modified_by: tmpCurModifiedBy, created_at, trashed_at, id, version_number } = feedItem;\n            const parsedVersionNumber = parseInt(version_number, 10);\n            const collaborators = previousFeedItem.collaborators || {\n                [prevModifiedBy.id]: { ...prevModifiedBy },\n            };\n\n            const modifiedBy = tmpCurModifiedBy || PLACEHOLDER_USER;\n\n            // add collaborators\n            // $FlowFixMe\n            collaborators[modifiedBy.id] = { ...modifiedBy };\n\n            return collapsedFeedState.concat([\n                {\n                    collaborators,\n                    created_at,\n                    modified_by: modifiedBy,\n                    trashed_at,\n                    id,\n                    type: ItemTypes.fileVersion,\n                    version_number,\n                    versions: versions.concat([feedItem]),\n                    version_start: Math.min(version_start, parsedVersionNumber),\n                    version_end: Math.max(version_end, parsedVersionNumber),\n                },\n            ]);\n        }\n\n        return collapsedFeedState.concat([previousFeedItem, feedItem]);\n    }, []);\n}\n"],"mappings":";;;;;AAAA;AACA;AACA;AACA;;AAEA,OAAOA,SAAS,MAAM,mCAAmC;AACzD,SAASC,sBAAsB,EAAEC,gBAAgB,EAAEC,qBAAqB,QAAQ,uBAAuB;AAGvG,OAAO,MAAMC,SAAS,GAAG;EACrBC,WAAW,EAAEJ;AACjB,CAAC;AAED,OAAO,SAASK,iBAAiBA,CAACC,SAAqB,EAAa;EAChE,IAAI,CAACA,SAAS,EAAE;IACZ,OAAO,EAAE;EACb;EAEA,OAAOA,SAAS,CAACC,MAAM,CAAC,CAACC,kBAAkB,EAAEC,QAAQ,KAAK;IACtD,MAAMC,gBAAgB,GAAGF,kBAAkB,CAACG,GAAG,CAAC,CAAC;IAEjD,IAAI,CAACD,gBAAgB,EAAE;MACnB,OAAOF,kBAAkB,CAACI,MAAM,CAAC,CAACH,QAAQ,CAAC,CAAC;IAChD;IAEA,IACIA,QAAQ,CAACI,IAAI,KAAKV,SAAS,CAACC,WAAW,IACvCM,gBAAgB,CAACG,IAAI,KAAKV,SAAS,CAACC,WAAW,IAC/CL,SAAS,CAACe,gBAAgB,CAACL,QAAQ,CAAC,KAAKP,qBAAqB,IAC9DH,SAAS,CAACe,gBAAgB,CAACJ,gBAAgB,CAAC,KAAKR,qBAAqB,EACxE;MACE,MAAM;QACFa,WAAW,EAAEC,aAAa;QAC1BC,QAAQ,GAAG,CAACP,gBAAgB,CAAC;QAC7BQ,aAAa,GAAGC,QAAQ,CAACT,gBAAgB,CAACU,cAAc,EAAE,EAAE,CAAC;QAC7DC,WAAW,GAAGF,QAAQ,CAACT,gBAAgB,CAACU,cAAc,EAAE,EAAE;MAC9D,CAAC,GAAGV,gBAAgB;MAEpB,MAAMY,cAAc,GAAGN,aAAa,IAAIf,gBAAgB;MAExD,MAAM;QAAEc,WAAW,EAAEQ,gBAAgB;QAAEC,UAAU;QAAEC,UAAU;QAAEC,EAAE;QAAEN;MAAe,CAAC,GAAGX,QAAQ;MAC9F,MAAMkB,mBAAmB,GAAGR,QAAQ,CAACC,cAAc,EAAE,EAAE,CAAC;MACxD,MAAMQ,aAAa,GAAGlB,gBAAgB,CAACkB,aAAa,IAAI;QACpD,CAACN,cAAc,CAACI,EAAE,GAAAG,aAAA,KAAQP,cAAc;MAC5C,CAAC;MAED,MAAMQ,UAAU,GAAGP,gBAAgB,IAAItB,gBAAgB;;MAEvD;MACA;MACA2B,aAAa,CAACE,UAAU,CAACJ,EAAE,CAAC,GAAAG,aAAA,KAAQC,UAAU,CAAE;MAEhD,OAAOtB,kBAAkB,CAACI,MAAM,CAAC,CAC7B;QACIgB,aAAa;QACbJ,UAAU;QACVT,WAAW,EAAEe,UAAU;QACvBL,UAAU;QACVC,EAAE;QACFb,IAAI,EAAEV,SAAS,CAACC,WAAW;QAC3BgB,cAAc;QACdH,QAAQ,EAAEA,QAAQ,CAACL,MAAM,CAAC,CAACH,QAAQ,CAAC,CAAC;QACrCS,aAAa,EAAEa,IAAI,CAACC,GAAG,CAACd,aAAa,EAAES,mBAAmB,CAAC;QAC3DN,WAAW,EAAEU,IAAI,CAACE,GAAG,CAACZ,WAAW,EAAEM,mBAAmB;MAC1D,CAAC,CACJ,CAAC;IACN;IAEA,OAAOnB,kBAAkB,CAACI,MAAM,CAAC,CAACF,gBAAgB,EAAED,QAAQ,CAAC,CAAC;EAClE,CAAC,EAAE,EAAE,CAAC;AACV","ignoreList":[]}