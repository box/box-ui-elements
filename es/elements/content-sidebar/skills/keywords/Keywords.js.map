{"version":3,"file":"Keywords.js","names":["React","PureComponent","FormattedMessage","classNames","PlainButton","IconEdit","LoadingIndicatorWrapper","InlineError","Tooltip","messages","SKILLS_TARGETS","EditableKeywords","ReadOnlyKeywords","Keywords","constructor","props","_defineProperty","setState","prevState","isEditing","keyword","transcript","adds","state","locations","regex","RegExp","text","Array","isArray","entries","forEach","appears","test","length","push","slice","removes","addedIndex","findIndex","added","splice","onSkillChange","toggleIsEditing","isLoading","resetState","keywords","card","hasError","render","getViewer","isEditable","duration","hasKeywords","filter","face","includes","concat","editClassName","createElement","className","editLabel","KEYWORDS","EDIT","onClick","type","title","sidebarSkillsErrorTitle","sidebarSkillsErrorContent","onAdd","onCancel","onDelete","onSave","skillNoInfoFoundError"],"sources":["../../../../../src/elements/content-sidebar/skills/keywords/Keywords.js"],"sourcesContent":["/**\n * @flow\n * @file File Keywords SkillCard component\n * @author Box\n */\n\nimport React, { PureComponent } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport classNames from 'classnames';\nimport PlainButton from '../../../../components/plain-button/PlainButton';\nimport IconEdit from '../../../../icons/general/IconEdit';\nimport LoadingIndicatorWrapper from '../../../../components/loading-indicator/LoadingIndicatorWrapper';\nimport InlineError from '../../../../components/inline-error/InlineError';\nimport Tooltip from '../../../../components/tooltip/Tooltip';\nimport messages from '../../../common/messages';\nimport { SKILLS_TARGETS } from '../../../common/interactionTargets';\nimport EditableKeywords from './EditableKeywords';\nimport ReadOnlyKeywords from './ReadOnlyKeywords';\nimport type { SkillCardEntry, SkillCard } from '../../../../common/types/skills';\n\nimport './Keywords.scss';\n\ntype Props = {\n    card: SkillCard,\n    getViewer?: Function,\n    hasError: boolean,\n    isEditable: boolean,\n    onSkillChange: Function,\n    transcript?: SkillCard,\n};\n\ntype State = {\n    adds: Array<SkillCardEntry>,\n    hasError: boolean,\n    isEditing: boolean,\n    isLoading: boolean,\n    keywords: Array<SkillCardEntry>,\n    removes: Array<SkillCardEntry>,\n};\n\nclass Keywords extends PureComponent<Props, State> {\n    props: Props;\n\n    state: State;\n\n    /**\n     * [constructor]\n     *\n     * @public\n     * @return {Keywords}\n     */\n    constructor(props: Props) {\n        super(props);\n        this.state = {\n            keywords: props.card.entries,\n            adds: [],\n            removes: [],\n            isEditing: props.hasError,\n            hasError: props.hasError,\n            isLoading: false,\n        };\n    }\n\n    /**\n     * Helper to reset the state\n     *\n     * @private\n     * @param {Object} props - component props\n     * @return {void}\n     */\n    resetState(props: Props): void {\n        this.setState({\n            keywords: props.card.entries,\n            adds: [],\n            removes: [],\n            isEditing: false,\n            hasError: false,\n            isLoading: false,\n        });\n    }\n\n    /**\n     * Toggles the edit mode\n     *\n     * @private\n     * @return {void}\n     */\n    toggleIsEditing = (): void => {\n        this.setState(prevState => ({\n            isEditing: !prevState.isEditing,\n        }));\n    };\n\n    /**\n     * Adds a new keyword.\n     * Iterates over the transcript to find locations\n     *\n     * @private\n     * @return {void}\n     */\n    onAdd = (keyword: SkillCardEntry): void => {\n        const { transcript }: Props = this.props;\n        const { adds } = this.state;\n        const locations = [];\n        const regex = new RegExp(`\\\\b${((keyword.text: any): string)}\\\\b`, 'i');\n\n        if (transcript && Array.isArray(transcript.entries)) {\n            transcript.entries.forEach(({ text, appears }: SkillCardEntry): void => {\n                if (text && regex.test(text) && Array.isArray(appears) && appears.length > 0) {\n                    locations.push(appears[0]);\n                }\n            });\n        }\n\n        keyword.appears = locations;\n        adds.push(keyword);\n        this.setState({ adds: adds.slice(0) });\n    };\n\n    /**\n     * Deletes a keyword\n     *\n     * @private\n     * @return {void}\n     */\n    onDelete = (keyword: SkillCardEntry): void => {\n        const { adds, removes } = this.state;\n        const addedIndex = adds.findIndex(added => added === keyword);\n        if (addedIndex > -1) {\n            adds.splice(addedIndex, 1);\n            this.setState({ adds: adds.slice(0) });\n        } else {\n            removes.push(keyword);\n            this.setState({ removes: removes.slice(0) });\n        }\n    };\n\n    /**\n     * Saves the new card data\n     *\n     * @private\n     * @return {void}\n     */\n    onSave = (): void => {\n        const { onSkillChange }: Props = this.props;\n        const { removes, adds }: State = this.state;\n        this.toggleIsEditing();\n        if (removes.length > 0 || adds.length > 0) {\n            this.setState({ isLoading: true });\n            onSkillChange(removes, adds);\n        }\n    };\n\n    /**\n     * Cancels editing\n     *\n     * @private\n     * @return {void}\n     */\n    onCancel = (): void => {\n        this.resetState(this.props);\n    };\n\n    /**\n     * Renders the keywords\n     *\n     * @private\n     * @return {void}\n     */\n    render() {\n        const { card, getViewer, isEditable }: Props = this.props;\n        const { duration }: SkillCard = card;\n        const { isEditing, isLoading, hasError, keywords, removes, adds }: State = this.state;\n        const hasKeywords = keywords.length > 0;\n        const entries = keywords.filter((face: SkillCardEntry) => !removes.includes(face)).concat(adds);\n        const editClassName = classNames('be-keyword-edit', {\n            'be-keyword-is-editing': isEditing,\n        });\n\n        return (\n            <LoadingIndicatorWrapper className=\"be-keywords\" isLoading={isLoading}>\n                {hasKeywords && isEditable && !isLoading && (\n                    <Tooltip text={<FormattedMessage {...messages.editLabel} />}>\n                        <PlainButton\n                            className={editClassName}\n                            data-resin-target={SKILLS_TARGETS.KEYWORDS.EDIT}\n                            onClick={this.toggleIsEditing}\n                            type=\"button\"\n                        >\n                            <IconEdit />\n                        </PlainButton>\n                    </Tooltip>\n                )}\n                {hasError && (\n                    <InlineError title={<FormattedMessage {...messages.sidebarSkillsErrorTitle} />}>\n                        <FormattedMessage {...messages.sidebarSkillsErrorContent} />\n                    </InlineError>\n                )}\n                {isEditing && (\n                    <EditableKeywords\n                        keywords={entries}\n                        onAdd={this.onAdd}\n                        onCancel={this.onCancel}\n                        onDelete={this.onDelete}\n                        onSave={this.onSave}\n                    />\n                )}\n                {!isEditing && hasKeywords && (\n                    <ReadOnlyKeywords duration={duration} getViewer={getViewer} keywords={entries} />\n                )}\n                {!isEditing && !hasKeywords && <FormattedMessage {...messages.skillNoInfoFoundError} />}\n            </LoadingIndicatorWrapper>\n        );\n    }\n}\n\nexport default Keywords;\n"],"mappings":"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","ignoreList":[]}