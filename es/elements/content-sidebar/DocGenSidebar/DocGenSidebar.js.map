{"version":3,"file":"DocGenSidebar.js","names":["React","useState","useCallback","useEffect","classNames","flow","useIntl","LoadingIndicator","ORIGIN_DOCGEN_SIDEBAR","SIDEBAR_VIEW_DOCGEN","withAPIContext","withErrorBoundary","withLogger","Error","EmptyTags","SidebarContent","TagsSection","messages","commonMessages","DEFAULT_RETRIES","DocGenSidebar","getDocGenTags","formatMessage","hasError","setHasError","isLoading","setIsLoading","tags","setTags","text","image","jsonPaths","setJsonPaths","textTree","imageTree","createNestedObject","base","paths","reduce","obj","path","tagsToJsonPaths","docGenTags","jsonPathsMap","forEach","tag","json_paths","jsonPath","split","loadTags","attempts","response","message","call","data","textTags","filter","tag_type","imageTags","error","isEmpty","length","createElement","sidebarView","title","className","center","onClick","loading","Fragment","DocGenSidebarComponent"],"sources":["../../../../src/elements/content-sidebar/DocGenSidebar/DocGenSidebar.tsx"],"sourcesContent":["import React, { useState, useCallback, useEffect } from 'react';\nimport classNames from 'classnames';\nimport flow from 'lodash/flow';\nimport { useIntl } from 'react-intl';\n\nimport { LoadingIndicator } from '@box/blueprint-web';\n\n// @ts-ignore: no ts definition\n// eslint-disable-next-line import/named\nimport { ORIGIN_DOCGEN_SIDEBAR, SIDEBAR_VIEW_DOCGEN } from '../../../constants';\n// @ts-ignore: no ts definition\n// eslint-disable-next-line import/named\nimport { withAPIContext } from '../../common/api-context';\n// @ts-ignore: no ts definition\n// eslint-disable-next-line import/named\nimport { withErrorBoundary } from '../../common/error-boundary';\n// @ts-ignore: no ts definition\n// eslint-disable-next-line import/named\nimport { withLogger } from '../../common/logger';\nimport Error from './Error';\nimport EmptyTags from './EmptyTags';\n// @ts-ignore: no ts definition\nimport SidebarContent from '../SidebarContent';\nimport TagsSection from './TagsSection';\n// @ts-ignore: no ts definition\nimport messages from './messages';\n// @ts-ignore: no ts definition\nimport { ErrorContextProps } from '../../../common/types/api';\n// @ts-ignore: no ts definition\nimport { WithLoggerProps } from '../../../common/types/logging';\nimport commonMessages from '../../common/messages';\n\nimport './DocGenSidebar.scss';\nimport { DocGenTag, DocGenTemplateTagsResponse, JsonPathsMap } from './types';\n\nconst DEFAULT_RETRIES = 10;\n\ntype ExternalProps = {\n    enabled: boolean;\n    getDocGenTags: () => Promise<DocGenTemplateTagsResponse>;\n    isDocgenTemplate: boolean;\n    checkDocGenTemplate: void;\n};\n\ntype Props = ExternalProps & ErrorContextProps & WithLoggerProps;\n\ntype TagState = {\n    text: DocGenTag[];\n    image: DocGenTag[];\n};\n\ntype JsonPathsState = {\n    textTree: JsonPathsMap;\n    imageTree: JsonPathsMap;\n};\n\nconst DocGenSidebar = ({ getDocGenTags }: Props) => {\n    const { formatMessage } = useIntl();\n\n    const [hasError, setHasError] = useState<boolean>(false);\n    const [isLoading, setIsLoading] = useState<boolean>(false);\n    const [tags, setTags] = useState<TagState>({\n        text: [],\n        image: [],\n    });\n    const [jsonPaths, setJsonPaths] = useState<JsonPathsState>({\n        textTree: {},\n        imageTree: {},\n    });\n\n    const createNestedObject = (base: JsonPathsMap, paths: string[]) => {\n        paths.reduce((obj, path) => {\n            if (!obj[path]) obj[path] = {};\n            return obj[path];\n        }, base);\n    };\n\n    const tagsToJsonPaths = useCallback((docGenTags: DocGenTag[]): JsonPathsMap => {\n        const jsonPathsMap: JsonPathsMap = {};\n\n        docGenTags.forEach(tag => {\n            tag.json_paths.forEach(jsonPath => {\n                const paths = jsonPath.split('.');\n                createNestedObject(jsonPathsMap, paths);\n            });\n        });\n\n        return jsonPathsMap;\n    }, []);\n\n    const loadTags = useCallback(\n        async (attempts = DEFAULT_RETRIES) => {\n            if (attempts <= 0) {\n                setIsLoading(false);\n                return;\n            }\n            setIsLoading(true);\n            try {\n                const response: DocGenTemplateTagsResponse = await getDocGenTags();\n                if (response?.message) {\n                    loadTags.call(this, attempts - 1);\n                } else if (response?.data) {\n                    const { data } = response;\n                    // anything that is not an image tag for this view is treated as a text tag\n                    const textTags = data?.filter(tag => tag.tag_type !== 'image') || [];\n                    const imageTags = data?.filter(tag => tag.tag_type === 'image') || [];\n                    setTags({\n                        text: textTags,\n                        image: imageTags,\n                    });\n                    setJsonPaths({\n                        textTree: tagsToJsonPaths(textTags),\n                        imageTree: tagsToJsonPaths(imageTags),\n                    });\n                    setHasError(false);\n                    setIsLoading(false);\n                } else {\n                    setHasError(true);\n                    setIsLoading(false);\n                }\n            } catch (error) {\n                setHasError(true);\n                setIsLoading(false);\n            }\n        },\n        // disabling eslint because the getDocGenTags prop is changing very frequently\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [tagsToJsonPaths],\n    );\n\n    useEffect(() => {\n        loadTags(DEFAULT_RETRIES);\n    }, [loadTags]);\n\n    const isEmpty = tags.image.length + tags.text.length === 0;\n\n    return (\n        <SidebarContent sidebarView={SIDEBAR_VIEW_DOCGEN} title={formatMessage(messages.docGenTags)}>\n            <div className={classNames('bcs-DocGenSidebar', { center: isEmpty || hasError || isLoading })}>\n                {hasError && <Error onClick={() => loadTags(DEFAULT_RETRIES)} />}\n                {isLoading && (\n                    <LoadingIndicator\n                        aria-label={formatMessage(commonMessages.loading)}\n                        className=\"bcs-DocGenSidebar-loading\"\n                    />\n                )}\n                {!hasError && !isLoading && isEmpty && <EmptyTags />}\n                {!hasError && !isLoading && !isEmpty && (\n                    <>\n                        <TagsSection message={messages.textTags} data={jsonPaths.textTree} />\n                        <TagsSection message={messages.imageTags} data={jsonPaths.imageTree} />\n                    </>\n                )}\n            </div>\n        </SidebarContent>\n    );\n};\n\nexport type DocGenSidebarProps = ExternalProps;\nexport { DocGenSidebar as DocGenSidebarComponent };\nexport default flow([withLogger(ORIGIN_DOCGEN_SIDEBAR), withErrorBoundary(ORIGIN_DOCGEN_SIDEBAR), withAPIContext])(\n    DocGenSidebar,\n);\n"],"mappings":"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","ignoreList":[]}