{"version":3,"file":"useInvites.js","names":["React","useState","noop","API","useInvites","api","itemID","itemType","options","sendInvites","setSendInvites","handleSuccess","handleError","setIsLoading","transformRequest","transformResponse","arg","useEffect","itemData","id","type","sendCollabRequest","collab","getCollaborationsAPI","addCollaboration","response","createPostCollaborationFn","collabRequest","Promise","resolve","users","groups","all","map","user","group"],"sources":["../../../../src/elements/content-sharing/hooks/useInvites.js"],"sourcesContent":["// @flow\n\nimport React, { useState } from 'react';\nimport noop from 'lodash/noop';\nimport API from '../../../api';\nimport type { SendInvitesFnType, UseInvitesOptions } from '../types';\nimport type { InviteCollaboratorsRequest } from '../../../features/unified-share-modal/flowTypes';\nimport type { ItemType } from '../../../common/types/core';\n\n/**\n * Generate the sendInvites() function, which is used for inviting collaborators in the USM.\n *\n * @param {API} api\n * @param {string} itemID\n * @param {ItemType} itemType\n * @param {UseInvitesOptions} options\n */\nfunction useInvites(api: API, itemID: string, itemType: ItemType, options: UseInvitesOptions) {\n    const [sendInvites, setSendInvites] = useState<null | SendInvitesFnType>(null);\n    const {\n        handleSuccess = noop,\n        handleError = noop,\n        setIsLoading = noop,\n        transformRequest,\n        transformResponse = arg => arg,\n    } = options;\n\n    React.useEffect(() => {\n        if (sendInvites) return;\n\n        const itemData = {\n            id: itemID,\n            type: itemType,\n        };\n        const sendCollabRequest = collab => {\n            setIsLoading(true);\n            return api.getCollaborationsAPI(false).addCollaboration(\n                itemData,\n                collab,\n                response => {\n                    handleSuccess(response);\n                    return transformResponse(response);\n                },\n                handleError,\n            );\n        };\n\n        const createPostCollaborationFn: SendInvitesFnType = () => async (\n            collabRequest: InviteCollaboratorsRequest,\n        ) => {\n            if (!transformRequest) return Promise.resolve(null);\n\n            const { users, groups } = transformRequest(collabRequest);\n            return Promise.all([\n                users.map(user => sendCollabRequest(user)),\n                groups.map(group => sendCollabRequest(group)),\n            ]);\n        };\n\n        if (!sendInvites) {\n            setSendInvites(createPostCollaborationFn);\n        }\n    }, [\n        api,\n        handleError,\n        handleSuccess,\n        itemID,\n        itemType,\n        sendInvites,\n        setIsLoading,\n        transformRequest,\n        transformResponse,\n    ]);\n\n    return sendInvites;\n}\n\nexport default useInvites;\n"],"mappings":"AAEA,OAAOA,KAAK,IAAIC,QAAQ,QAAQ,OAAO;AACvC,OAAOC,IAAI,MAAM,aAAa;AAC9B,OAAOC,GAAG,MAAM,cAAc;AAK9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,UAAUA,CAACC,GAAQ,EAAEC,MAAc,EAAEC,QAAkB,EAAEC,OAA0B,EAAE;EAC1F,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGT,QAAQ,CAA2B,IAAI,CAAC;EAC9E,MAAM;IACFU,aAAa,GAAGT,IAAI;IACpBU,WAAW,GAAGV,IAAI;IAClBW,YAAY,GAAGX,IAAI;IACnBY,gBAAgB;IAChBC,iBAAiB,GAAGC,GAAG,IAAIA;EAC/B,CAAC,GAAGR,OAAO;EAEXR,KAAK,CAACiB,SAAS,CAAC,MAAM;IAClB,IAAIR,WAAW,EAAE;IAEjB,MAAMS,QAAQ,GAAG;MACbC,EAAE,EAAEb,MAAM;MACVc,IAAI,EAAEb;IACV,CAAC;IACD,MAAMc,iBAAiB,GAAGC,MAAM,IAAI;MAChCT,YAAY,CAAC,IAAI,CAAC;MAClB,OAAOR,GAAG,CAACkB,oBAAoB,CAAC,KAAK,CAAC,CAACC,gBAAgB,CACnDN,QAAQ,EACRI,MAAM,EACNG,QAAQ,IAAI;QACRd,aAAa,CAACc,QAAQ,CAAC;QACvB,OAAOV,iBAAiB,CAACU,QAAQ,CAAC;MACtC,CAAC,EACDb,WACJ,CAAC;IACL,CAAC;IAED,MAAMc,yBAA4C,GAAGA,CAAA,KAAM,MACvDC,aAAyC,IACxC;MACD,IAAI,CAACb,gBAAgB,EAAE,OAAOc,OAAO,CAACC,OAAO,CAAC,IAAI,CAAC;MAEnD,MAAM;QAAEC,KAAK;QAAEC;MAAO,CAAC,GAAGjB,gBAAgB,CAACa,aAAa,CAAC;MACzD,OAAOC,OAAO,CAACI,GAAG,CAAC,CACfF,KAAK,CAACG,GAAG,CAACC,IAAI,IAAIb,iBAAiB,CAACa,IAAI,CAAC,CAAC,EAC1CH,MAAM,CAACE,GAAG,CAACE,KAAK,IAAId,iBAAiB,CAACc,KAAK,CAAC,CAAC,CAChD,CAAC;IACN,CAAC;IAED,IAAI,CAAC1B,WAAW,EAAE;MACdC,cAAc,CAACgB,yBAAyB,CAAC;IAC7C;EACJ,CAAC,EAAE,CACCrB,GAAG,EACHO,WAAW,EACXD,aAAa,EACbL,MAAM,EACNC,QAAQ,EACRE,WAAW,EACXI,YAAY,EACZC,gBAAgB,EAChBC,iBAAiB,CACpB,CAAC;EAEF,OAAON,WAAW;AACtB;AAEA,eAAeL,UAAU","ignoreList":[]}