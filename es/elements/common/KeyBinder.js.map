{"version":3,"file":"KeyBinder.js","names":["React","PureComponent","noop","isInputElement","KeyBinder","getDerivedStateFromProps","props","state","prevId","prevScrollToColumn","prevScrollToRow","id","scrollToColumn","scrollToColumnProp","scrollToRow","scrollToRowProp","focusOnRender","newState","Object","keys","length","constructor","_defineProperty","event","target","columnCount","rowCount","onSelect","onRename","onDownload","onShare","onDelete","onOpen","items","scrollToColumnPrevious","scrollToRowPrevious","currentItem","ctrlMeta","metaKey","ctrlKey","key","Math","min","stopPropagation","max","preventDefault","updateScrollState","columnStartIndex","columnStopIndex","rowStartIndex","rowStopIndex","onScrollToChange","setState","render","className","children","createElement","onKeyDown","onSectionRendered"],"sources":["../../../src/elements/common/KeyBinder.js"],"sourcesContent":["/**\n * @flow\n * @file Item List Key bindings\n * @author Box\n */\n\nimport React, { PureComponent } from 'react';\nimport noop from 'lodash/noop';\nimport { isInputElement } from '../../utils/dom';\nimport type { BoxItem } from '../../common/types/core';\n\ntype Props = {\n    children: Function,\n    className: string,\n    columnCount: number,\n    id: string | void,\n    items: BoxItem[],\n    onDelete: Function,\n    onDownload: Function,\n    onOpen: Function,\n    onRename: Function,\n    onScrollToChange: Function,\n    onSelect: Function,\n    onShare: Function,\n    rowCount: number,\n    scrollToColumn: number,\n    scrollToRow: number,\n};\n\ntype State = {\n    focusOnRender: boolean,\n    prevId: string | void,\n    prevScrollToColumn: number,\n    prevScrollToRow: number,\n    scrollToColumn: number,\n    scrollToRow: number,\n};\n\nclass KeyBinder extends PureComponent<Props, State> {\n    state: State;\n\n    props: Props;\n\n    columnStartIndex: number;\n\n    columnStopIndex: number;\n\n    rowStartIndex: number;\n\n    rowStopIndex: number;\n\n    static defaultProps = {\n        scrollToColumn: 0,\n        scrollToRow: 0,\n        onRename: noop,\n        onShare: noop,\n        onDownload: noop,\n        onOpen: noop,\n        onSelect: noop,\n        onDelete: noop,\n    };\n\n    /**\n     * Resets scroll position if props change\n     * @private\n     * @inheritdoc\n     * @return {State|null}\n     */\n    static getDerivedStateFromProps(props: Props, state: State) {\n        const { prevId, prevScrollToColumn, prevScrollToRow }: State = state;\n        const { id, scrollToColumn: scrollToColumnProp, scrollToRow: scrollToRowProp }: Props = props;\n\n        if (id !== prevId) {\n            return {\n                focusOnRender: false,\n                prevId: id,\n                prevScrollToColumn: 0,\n                prevScrollToRow: 0,\n                scrollToColumn: 0,\n                scrollToRow: 0,\n            };\n        }\n\n        const newState = {};\n\n        if (prevScrollToColumn !== scrollToColumnProp && prevScrollToRow !== scrollToRowProp) {\n            newState.prevScrollToColumn = scrollToColumnProp;\n            newState.prevScrollToRow = scrollToRowProp;\n            newState.scrollToColumn = scrollToColumnProp;\n            newState.scrollToRow = scrollToRowProp;\n        } else if (scrollToRowProp !== prevScrollToRow) {\n            newState.prevScrollToRow = scrollToRowProp;\n            newState.scrollToRow = scrollToRowProp;\n        } else if (scrollToColumnProp !== prevScrollToColumn) {\n            newState.prevScrollToColumn = scrollToColumnProp;\n            newState.scrollToColumn = scrollToColumnProp;\n        }\n\n        return Object.keys(newState).length ? newState : null;\n    }\n\n    /**\n     * [constructor]\n     *\n     * @private\n     * @return {KeyBinder}\n     */\n    constructor(props: Props) {\n        super(props);\n\n        const { id, scrollToRow, scrollToColumn }: Props = props;\n        this.state = {\n            focusOnRender: false,\n            prevId: id,\n            prevScrollToColumn: scrollToColumn,\n            prevScrollToRow: scrollToRow,\n            scrollToColumn,\n            scrollToRow,\n        };\n\n        this.columnStartIndex = 0;\n        this.columnStopIndex = 0;\n        this.rowStartIndex = 0;\n        this.rowStopIndex = 0;\n    }\n\n    /**\n     * Keyboard events\n     *\n     * @private\n     * @inheritdoc\n     * @return {void}\n     */\n    onKeyDown = (event: SyntheticKeyboardEvent<HTMLElement>) => {\n        if (isInputElement(event.target)) {\n            return;\n        }\n\n        const {\n            columnCount,\n            rowCount,\n            onSelect,\n            onRename,\n            onDownload,\n            onShare,\n            onDelete,\n            onOpen,\n            items,\n        }: Props = this.props;\n        const { scrollToColumn: scrollToColumnPrevious, scrollToRow: scrollToRowPrevious }: State = this.state;\n        let { scrollToColumn, scrollToRow }: State = this.state;\n        const currentItem: BoxItem = items[scrollToRow];\n        const ctrlMeta: boolean = event.metaKey || event.ctrlKey;\n\n        // The above cases all prevent default event event behavior.\n        // This is to keep the grid from scrolling after the snap-to update.\n        switch (event.key) {\n            case 'ArrowDown':\n                scrollToRow = ctrlMeta ? rowCount - 1 : Math.min(scrollToRow + 1, rowCount - 1);\n                event.stopPropagation(); // To prevent the arrow down capture of parent\n                break;\n            case 'ArrowLeft':\n                scrollToColumn = ctrlMeta ? 0 : Math.max(scrollToColumn - 1, 0);\n                break;\n            case 'ArrowRight':\n                scrollToColumn = ctrlMeta ? columnCount - 1 : Math.min(scrollToColumn + 1, columnCount - 1);\n                break;\n            case 'ArrowUp':\n                scrollToRow = ctrlMeta ? 0 : Math.max(scrollToRow - 1, 0);\n                break;\n            case 'Enter':\n                onOpen(currentItem);\n                event.preventDefault();\n                break;\n            case 'Delete':\n                onDelete(currentItem);\n                event.preventDefault();\n                break;\n            case 'X':\n                onSelect(currentItem);\n                event.preventDefault();\n                break;\n            case 'D':\n                onDownload(currentItem);\n                event.preventDefault();\n                break;\n            case 'S':\n                onShare(currentItem);\n                event.preventDefault();\n                break;\n            case 'R':\n                onRename(currentItem);\n                event.preventDefault();\n                break;\n            default:\n                return;\n        }\n\n        if (scrollToColumn !== scrollToColumnPrevious || scrollToRow !== scrollToRowPrevious) {\n            event.preventDefault();\n            this.updateScrollState({ scrollToColumn, scrollToRow });\n        }\n    };\n\n    /**\n     * Callback for set of rows rendered\n     *\n     * @private\n     * @inheritdoc\n     * @return {void}\n     */\n    onSectionRendered = ({\n        columnStartIndex,\n        columnStopIndex,\n        rowStartIndex,\n        rowStopIndex,\n    }: {\n        columnStartIndex: number,\n        columnStopIndex: number,\n        rowStartIndex: number,\n        rowStopIndex: number,\n    }): void => {\n        this.columnStartIndex = columnStartIndex;\n        this.columnStopIndex = columnStopIndex;\n        this.rowStartIndex = rowStartIndex;\n        this.rowStopIndex = rowStopIndex;\n    };\n\n    /**\n     * Updates the scroll states\n     *\n     * @private\n     * @inheritdoc\n     * @return {void}\n     */\n    updateScrollState({ scrollToColumn, scrollToRow }: { scrollToColumn: number, scrollToRow: number }): void {\n        const { onScrollToChange } = this.props;\n        onScrollToChange({ scrollToColumn, scrollToRow });\n        this.setState({ scrollToColumn, scrollToRow, focusOnRender: true });\n    }\n\n    /**\n     * Renders the HOC\n     *\n     * @private\n     * @inheritdoc\n     * @return {void}\n     */\n    render() {\n        const { className, children } = this.props;\n        const { scrollToColumn, scrollToRow, focusOnRender }: State = this.state;\n\n        /* eslint-disable jsx-a11y/no-static-element-interactions */\n        return (\n            <div className={className} onKeyDown={this.onKeyDown}>\n                {children({\n                    onSectionRendered: this.onSectionRendered,\n                    scrollToColumn,\n                    scrollToRow,\n                    focusOnRender,\n                })}\n            </div>\n        );\n        /* eslint-enable jsx-a11y/no-static-element-interactions */\n    }\n}\n\nexport default KeyBinder;\n"],"mappings":"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","ignoreList":[]}