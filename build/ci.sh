#!/bin/bash

export NODE_PATH=$NODE_PATH:./node_modules


echo "----------------------------------------------"
echo "Starting install, clean and locale build"
echo "----------------------------------------------"
if yarn run pre-build; then
    echo "----------------------------------------------------"
    echo "Pre build assets"
    echo "----------------------------------------------------"
else
    echo "----------------------------------------------------"
    echo "Failed to pre build assets!"
    echo "----------------------------------------------------"
    exit 1;
fi



echo "----------------------------------------------------"
echo "Running linter"
echo "----------------------------------------------------"
if yarn run lint; then
    echo "----------------------------------------------------"
    echo "Done linting"
    echo "----------------------------------------------------"
else
    echo "----------------------------------------------------"
    echo "Failed linting!"
    echo "----------------------------------------------------"
    exit 1;
fi



echo "----------------------------------------------------"
echo "Running flow"
echo "----------------------------------------------------"
if yarn run flow; then
    echo "----------------------------------------------------"
    echo "Done flowing"
    echo "----------------------------------------------------"
else
    echo "----------------------------------------------------"
    echo "Failed flowing!"
    echo "----------------------------------------------------"
    exit 1;
fi



echo "----------------------------------------------------"
echo "Running tests"
echo "----------------------------------------------------"
if yarn run test; then
    echo "----------------------------------------------------"
    echo "Done testing"
    echo "----------------------------------------------------"
else
    echo "----------------------------------------------------"
    echo "Failed testing!"
    echo "----------------------------------------------------"
    exit 1;
fi



echo "----------------------------------------------------"
echo "Running release build"
echo "----------------------------------------------------"
if yarn run build-ci; then
    echo "----------------------------------------------------"
    echo "Built assets for version"
    echo "----------------------------------------------------"
else
    echo "----------------------------------------------------"
    echo "Failed to build assets!"
    echo "----------------------------------------------------"
    exit 1;
fi
