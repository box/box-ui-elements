"use strict";(globalThis.webpackChunkbox_ui_elements=globalThis.webpackChunkbox_ui_elements||[]).push([[74594],{"./src/elements/content-preview/PreviewContext.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});const PreviewContext=__webpack_require__("./node_modules/react/index.js").createContext(null);PreviewContext.displayName="PreviewContext";const __WEBPACK_DEFAULT_EXPORT__=PreviewContext},"./src/elements/content-sidebar/MetadataSidebarRedesign.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MetadataSidebarRedesignComponent:()=>MetadataSidebarRedesign_MetadataSidebarRedesign,default:()=>elements_content_sidebar_MetadataSidebarRedesign});var react=__webpack_require__("./node_modules/react/index.js"),flow=__webpack_require__("./node_modules/lodash/flow.js"),flow_default=__webpack_require__.n(flow),useIntl=__webpack_require__("./node_modules/react-intl/lib/src/components/useIntl.js"),message=__webpack_require__("./node_modules/react-intl/lib/src/components/message.js"),react_router=__webpack_require__("./node_modules/react-router/esm/react-router.js"),inline_error=__webpack_require__("./node_modules/@box/blueprint-web/dist/lib-esm/primitives/inline-error/inline-error.js"),loading_indicator=__webpack_require__("./node_modules/@box/blueprint-web/dist/lib-esm/loading-indicator/loading-indicator.js"),add_metadata_template_dropdown=__webpack_require__("./node_modules/@box/metadata-editor/dist/esm/lib/components/add-metadata-template-dropdown/add-metadata-template-dropdown.js"),filter_instances_dropdown=__webpack_require__("./node_modules/@box/metadata-editor/dist/esm/lib/components/filter-instances-dropdown/filter-instances-dropdown.js"),metadata_empty_state=__webpack_require__("./node_modules/@box/metadata-editor/dist/esm/lib/components/metadata-empty-state/metadata-empty-state.js"),autofill_context=__webpack_require__("./node_modules/@box/metadata-editor/dist/esm/lib/utils/autofill-context.js"),metadata_instance_list=__webpack_require__("./node_modules/@box/metadata-editor/dist/esm/lib/components/metadata-instance-list/metadata-instance-list.js"),SidebarContent=__webpack_require__("./src/elements/content-sidebar/SidebarContent.js"),api_context=__webpack_require__("./src/elements/common/api-context/index.js"),error_boundary=__webpack_require__("./src/elements/common/error-boundary/index.js"),logger=__webpack_require__("./src/elements/common/logger/index.js"),feature_checking=__webpack_require__("./src/elements/common/feature-checking/index.js"),constants=__webpack_require__("./src/constants.js"),logger_constants=__webpack_require__("./src/elements/common/logger/constants.js"),performance=__webpack_require__("./src/utils/performance.js"),get=__webpack_require__("./node_modules/lodash/get.js"),get_default=__webpack_require__.n(get),isEmpty=__webpack_require__("./node_modules/lodash/isEmpty.js"),isEmpty_default=__webpack_require__.n(isEmpty),utils_error=__webpack_require__("./src/utils/error.js"),messages=__webpack_require__("./src/elements/common/messages.js");function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}let STATUS=function(STATUS){return STATUS.IDLE="idle",STATUS.LOADING="loading",STATUS.ERROR="error",STATUS.SUCCESS="success",STATUS}({});const hooks_useSidebarMetadataFetcher=function useSidebarMetadataFetcher(api,fileId,onError,onSuccess,isFeatureEnabled){const[status,setStatus]=react.useState(STATUS.IDLE),[file,setFile]=react.useState(null),[templates,setTemplates]=react.useState(null),[errorMessage,setErrorMessage]=react.useState(null),[templateInstances,setTemplateInstances]=react.useState([]),[extractErrorCode,setExtractErrorCode]=react.useState(null),onApiError=react.useCallback(((error,code,message)=>{const{status:errorStatus}=error,isValidError=(0,utils_error.OB)(errorStatus);setStatus(STATUS.ERROR),setErrorMessage(message),onError(error,code,{error,isErrorDisplayed:isValidError})}),[onError]),fetchMetadataSuccessCallback=react.useCallback((({templates:fetchedTemplates,templateInstances:fetchedTemplateInstances})=>{setErrorMessage(null),setStatus(STATUS.SUCCESS),setTemplateInstances(fetchedTemplateInstances),setTemplates(fetchedTemplates)}),[]),fetchMetadataErrorCallback=react.useCallback(((e,code)=>{setTemplates(null),setTemplateInstances(null),onApiError(e,code,messages.A.sidebarMetadataFetchingErrorContent)}),[onApiError]),fetchMetadata=react.useCallback((fetchedFile=>{api.getMetadataAPI(!1).getMetadata(fetchedFile,fetchMetadataSuccessCallback,fetchMetadataErrorCallback,isFeatureEnabled,{refreshCache:!0},!0)}),[api,fetchMetadataErrorCallback,fetchMetadataSuccessCallback,isFeatureEnabled]),fetchFileSuccessCallback=react.useCallback((fetchedFile=>{const{currentFile}=file??{},currentFileCanUpload=get_default()(currentFile,constants.fep,!1),newFileCanUpload=get_default()(fetchedFile,constants.fep,!1),shouldFetchMetadata=!currentFile||currentFileCanUpload!==newFileCanUpload;setFile(fetchedFile),shouldFetchMetadata&&fetchedFile?fetchMetadata(fetchedFile):setStatus(STATUS.SUCCESS)}),[fetchMetadata,file]),fetchFileErrorCallback=react.useCallback(((e,code)=>{setFile(void 0),onApiError(e,code,messages.A.sidebarMetadataEditingErrorContent)}),[onApiError]),handleDeleteMetadataInstance=react.useCallback((async metadataInstance=>{file&&metadataInstance&&(setStatus(STATUS.LOADING),await api.getMetadataAPI(!1).deleteMetadata(file,metadataInstance,(()=>{setStatus(STATUS.SUCCESS),onSuccess(constants.$pu,!0)}),((error,code)=>{onApiError(error,code,messages.A.sidebarMetadataEditingErrorContent)}),!0))}),[api,onApiError,onSuccess,file]),handleCreateMetadataInstance=react.useCallback((async(templateInstance,successCallback)=>{await api.getMetadataAPI(!1).createMetadataRedesign(file,templateInstance,(()=>{successCallback(),onSuccess(constants.cpU,!0)}),((error,code)=>onApiError(error,code,messages.A.sidebarMetadataEditingErrorContent)))}),[api,file,onApiError,onSuccess]),handleUpdateMetadataInstance=react.useCallback((async(metadataInstance,JSONPatch,successCallback)=>{await api.getMetadataAPI(!1).updateMetadataRedesign(file,metadataInstance,JSONPatch,(()=>{successCallback(),onSuccess(constants.joV,!0)}),((error,code)=>{onApiError(error,code,messages.A.sidebarMetadataEditingErrorContent)}))}),[api,file,onApiError,onSuccess]),[,setError]=react.useState(),extractSuggestions=react.useCallback((async(templateKey,scope,agentId)=>{const aiAPI=api.getIntelligenceAPI();setExtractErrorCode(null);let answer=null;const customAiAgent=agentId?{ai_agent:{type:"ai_agent_id",id:agentId}}:{},requestBody=_objectSpread({items:[{id:file.id,type:file.type}],metadata_template:{template_key:templateKey,scope,type:"metadata_template"}},customAiAgent);try{answer=await aiAPI.extractStructured(requestBody)}catch(error){return 408===error.response?.status?(onError(error,constants.C83),setExtractErrorCode(constants.C83)):412===error.response?.status?(onError(error,constants.igz),setExtractErrorCode(constants.igz)):500===error.response?.status?(onError(error,constants.cU2),setExtractErrorCode(constants.cU2)):(0,utils_error.OB)(error.response?.status)?onError(error,constants.O5J,{showNotification:!0}):(onError(error,constants.cU2,{showNotification:!0}),setError((()=>{throw error}))),[]}if(isEmpty_default()(answer)){const error=new Error("No suggestions found.");return onError(error,constants.DxP,{showNotification:!0}),[]}const templateInstance=templates.find((template=>template.templateKey===templateKey&&template.scope));return(templateInstance?.fields||[]).map((field=>{const value=answer[field.key];return value&&"taxonomy"!==field.type?_objectSpread(_objectSpread({},field),{},{aiSuggestion:value}):field}))}),[api,file,onError,templates]);return react.useEffect((()=>{status===STATUS.IDLE&&(setStatus(STATUS.LOADING),api.getFileAPI().getFile(fileId,fetchFileSuccessCallback,fetchFileErrorCallback,{fields:[constants.by8,constants.En1],refreshCache:!0}))}),[api,fetchFileErrorCallback,fetchFileSuccessCallback,fileId,status]),{clearExtractError:()=>setExtractErrorCode(null),extractSuggestions,handleCreateMetadataInstance,handleDeleteMetadataInstance,handleUpdateMetadataInstance,extractErrorCode,errorMessage,file,status,templateInstances,templates}};var injectStylesIntoStyleTag=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),MetadataSidebarRedesign=__webpack_require__("./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[13].use[2]!./src/elements/content-sidebar/MetadataSidebarRedesign.scss"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(MetadataSidebarRedesign.A,options);MetadataSidebarRedesign.A&&MetadataSidebarRedesign.A.locals&&MetadataSidebarRedesign.A.locals;var metadata_instance_form=__webpack_require__("./node_modules/@box/metadata-editor/dist/esm/lib/components/metadata-instance-editor/subcomponents/metadata-instance-form/metadata-instance-form.js"),PreviewContext=__webpack_require__("./src/elements/content-preview/PreviewContext.ts");const MetadataInstanceEditor=({areAiSuggestionsAvailable,errorCode,isBetaLanguageEnabled,isBoxAiSuggestionsEnabled,isDeleteButtonDisabled,isDeleteConfirmationModalCheckboxEnabled,isLargeFile,isMetadataMultiLevelTaxonomyFieldEnabled,isUnsavedChangesModalOpen,onCancel,onDelete,onDiscardUnsavedChanges,onSubmit,setIsUnsavedChangesModalOpen,taxonomyOptionsFetcher,template,isAdvancedExtractAgentEnabled=!1})=>{const previewContext=(0,react.useContext)(PreviewContext.A),customRef=previewContext?.previewBodyRef?.current;return react.createElement(metadata_instance_form.V,{isMultilevelTaxonomyFieldEnabled:isMetadataMultiLevelTaxonomyFieldEnabled,areAiSuggestionsAvailable,errorCode,isAiSuggestionsFeatureEnabled:isBoxAiSuggestionsEnabled,isBetaLanguageEnabled,isDeleteButtonDisabled,isDeleteConfirmationModalCheckboxEnabled,isLargeFile,isUnsavedChangesModalOpen,onCancel,onDelete,onDiscardUnsavedChanges,onSubmit,selectedTemplateInstance:template,setIsUnsavedChangesModalOpen,taxonomyOptionsFetcher,isAdvancedExtractAgentEnabled,customRef})},content_sidebar_MetadataInstanceEditor=MetadataInstanceEditor;try{MetadataInstanceEditor.displayName="MetadataInstanceEditor",MetadataInstanceEditor.__docgenInfo={description:"",displayName:"MetadataInstanceEditor",props:{areAiSuggestionsAvailable:{defaultValue:null,description:"",name:"areAiSuggestionsAvailable",required:!0,type:{name:"boolean"}},errorCode:{defaultValue:null,description:"",name:"errorCode",required:!1,type:{name:"any"}},isBetaLanguageEnabled:{defaultValue:null,description:"",name:"isBetaLanguageEnabled",required:!0,type:{name:"boolean"}},isBoxAiSuggestionsEnabled:{defaultValue:null,description:"",name:"isBoxAiSuggestionsEnabled",required:!0,type:{name:"boolean"}},isDeleteButtonDisabled:{defaultValue:null,description:"",name:"isDeleteButtonDisabled",required:!0,type:{name:"boolean"}},isDeleteConfirmationModalCheckboxEnabled:{defaultValue:null,description:"",name:"isDeleteConfirmationModalCheckboxEnabled",required:!0,type:{name:"boolean"}},isLargeFile:{defaultValue:null,description:"",name:"isLargeFile",required:!0,type:{name:"boolean"}},isMetadataMultiLevelTaxonomyFieldEnabled:{defaultValue:null,description:"",name:"isMetadataMultiLevelTaxonomyFieldEnabled",required:!0,type:{name:"boolean"}},isUnsavedChangesModalOpen:{defaultValue:null,description:"",name:"isUnsavedChangesModalOpen",required:!0,type:{name:"boolean"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!0,type:{name:"() => void"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"(metadataInstance: MetadataTemplateInstance) => void"}},onDiscardUnsavedChanges:{defaultValue:null,description:"",name:"onDiscardUnsavedChanges",required:!0,type:{name:"() => void"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(values: FormValues, operations: JSONPatchOperations) => Promise<void>"}},setIsUnsavedChangesModalOpen:{defaultValue:null,description:"",name:"setIsUnsavedChangesModalOpen",required:!0,type:{name:"(isUnsavedChangesModalOpen: boolean) => void"}},taxonomyOptionsFetcher:{defaultValue:null,description:"",name:"taxonomyOptionsFetcher",required:!0,type:{name:"TaxonomyOptionsFetcher"}},template:{defaultValue:null,description:"",name:"template",required:!0,type:{name:"MetadataTemplateInstance"}},isAdvancedExtractAgentEnabled:{defaultValue:{value:"false"},description:"",name:"isAdvancedExtractAgentEnabled",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/elements/content-sidebar/MetadataInstanceEditor.tsx#MetadataInstanceEditor"]={docgenInfo:MetadataInstanceEditor.__docgenInfo,name:"MetadataInstanceEditor",path:"src/elements/content-sidebar/MetadataInstanceEditor.tsx#MetadataInstanceEditor"})}catch(__react_docgen_typescript_loader_error){}const convertTemplateToTemplateInstance=(file,template)=>({canEdit:!!file.permissions.can_upload,displayName:template.displayName,hidden:template.hidden,id:template.id,fields:template.fields,scope:template.scope,templateKey:template.templateKey,type:template.type}),SUPPORTED_FILE_EXTENSIONS=new Set(["as","as3","asm","bat","c","cc","cmake","cpp","cs","css","csv","cxx","diff","doc","docx","erb","gdoc","groovy","gsheet","h","haml","hh","htm","html","java","js","json","less","log","m","make","md","ml","mm","msg","ods","odt","pdf","php","pl","properties","py","rb","rst","rtf","sass","scala","scm","script","sh","sml","sql","txt","vi","vim","webdoc","wpd","xhtml","xls","xlsb","xlsm","xlsx","xml","xsd","xsl","xbd","xdw","yaml","key","pages","numbers","gslide","gslides","odp","ppt","pptx","boxcanvas","boxnote","ai","bmp","cr2","crw","dcm","dicm","dicom","dng","dwg","eps","gif","heic","jpeg","jpg","nef","png","ps","psd","raf","svg","tga","tif","tiff","webp"]);const _excluded=["display_name","displayName"];function metadataTaxonomyFetcher_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function metadataTaxonomyFetcher_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?metadataTaxonomyFetcher_ownKeys(Object(t),!0).forEach((function(r){metadataTaxonomyFetcher_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):metadataTaxonomyFetcher_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function metadataTaxonomyFetcher_defineProperty(e,r,t){return(r=function metadataTaxonomyFetcher_toPropertyKey(t){var i=function metadataTaxonomyFetcher_toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==typeof i?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}const metadataTaxonomyFetcher=async(api,fileId,scope,templateKey,fieldKey,level,options)=>{const metadataOptions=await api.getMetadataAPI(!1).getMetadataOptions(fileId,scope,templateKey,fieldKey,level,options),{marker=null}=options;return metadataTaxonomyFetcher_objectSpread(metadataTaxonomyFetcher_objectSpread({options:metadataOptions.entries.map((metadataOption=>({value:metadataOption.id,displayValue:metadataOption.display_name||metadataOption.displayName,level:metadataOption.level,parentId:metadataOption.parentId,nodePath:metadataOption.nodePath,deprecated:metadataOption.deprecated,ancestors:metadataOption.ancestors?.map((_ref=>{let{display_name,displayName}=_ref;return metadataTaxonomyFetcher_objectSpread(metadataTaxonomyFetcher_objectSpread({},function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(-1!==e.indexOf(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],-1===t.indexOf(o)&&{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}(_ref,_excluded)),{},{displayName:display_name||displayName})})),selectable:metadataOption.selectable}))),marker},void 0!==metadataOptions.total_result_count&&{totalResultCount:metadataOptions.total_result_count}),void 0!==metadataOptions.limit&&{limit:metadataOptions.limit})},metadataTaxonomyNodeAncestorsFetcher=async(api,fileID,scope,taxonomyKey,nodeID)=>{const[metadataTaxonomy,metadataTaxonomyNode]=await Promise.all([api.getMetadataAPI(!1).getMetadataTaxonomy(fileID,scope,taxonomyKey),api.getMetadataAPI(!1).getMetadataTaxonomyNode(fileID,scope,taxonomyKey,nodeID,!0)]);if(!metadataTaxonomy?.levels)return[];const levelsMap=new Map;for(const item of metadataTaxonomy.levels){const levelData={level:item.level,levelName:item.displayName||item.display_name,description:item.description};metadataTaxonomyNode.level===item.level?levelsMap.set(item.level,metadataTaxonomyFetcher_objectSpread(metadataTaxonomyFetcher_objectSpread({},levelData),{},{id:metadataTaxonomyNode.id,levelValue:metadataTaxonomyNode.displayName||metadataTaxonomyNode.display_name})):levelsMap.set(item.level,levelData)}if(metadataTaxonomyNode.ancestors?.length)for(const ancestor of metadataTaxonomyNode.ancestors){const levelData=levelsMap.get(ancestor.level);levelData&&levelsMap.set(ancestor.level,metadataTaxonomyFetcher_objectSpread(metadataTaxonomyFetcher_objectSpread({},levelData),{},{levelValue:ancestor.displayName||ancestor.display_name,id:ancestor.id}))}return Array.from(levelsMap.values()).filter((level=>!!level.id))};const MARK_NAME_JS_READY=`${constants.A5A}_${logger_constants.T}`;function MetadataSidebarRedesign_MetadataSidebarRedesign({api,elementId,fileExtension,fileId,filteredTemplateIds=[],history,onError,onSuccess,isFeatureEnabled,createSessionRequest,getStructuredTextRep}){const{clearExtractError,extractSuggestions,file,handleCreateMetadataInstance,handleDeleteMetadataInstance,handleUpdateMetadataInstance,templates,extractErrorCode,errorMessage,status,templateInstances}=hooks_useSidebarMetadataFetcher(api,fileId,onError,onSuccess,isFeatureEnabled),{formatMessage}=(0,useIntl.A)(),isBoxAiSuggestionsEnabled=(0,feature_checking.useFeatureEnabled)("metadata.aiSuggestions.enabled"),isBetaLanguageEnabled=(0,feature_checking.useFeatureEnabled)("metadata.betaLanguage.enabled"),isMetadataMultiLevelTaxonomyFieldEnabled=(0,feature_checking.useFeatureEnabled)("metadata.multilevelTaxonomy.enabled"),isAdvancedExtractAgentEnabled=(0,feature_checking.useFeatureEnabled)("metadata.extractAdvancedAgents.enabled"),isDeleteConfirmationModalCheckboxEnabled=(0,feature_checking.useFeatureEnabled)("metadata.deleteConfirmationModalCheckbox.enabled"),isSessionInitiated=(0,react.useRef)(!1),[isLargeFile,setIsLargeFile]=(0,react.useState)(!1),[editingTemplate,setEditingTemplate]=(0,react.useState)(null),[isUnsavedChangesModalOpen,setIsUnsavedChangesModalOpen]=(0,react.useState)(!1),[isDeleteButtonDisabled,setIsDeleteButtonDisabled]=(0,react.useState)(!1),[appliedTemplateInstances,setAppliedTemplateInstances]=(0,react.useState)(templateInstances),[pendingTemplateToEdit,setPendingTemplateToEdit]=(0,react.useState)(null),shouldFetchStructuredTextRep=isBoxAiSuggestionsEnabled&&"pdf"===fileExtension?.toLowerCase()&&api.options?.token&&!!getStructuredTextRep;(0,react.useEffect)((()=>{shouldFetchStructuredTextRep&&api.options.token(fileId).then((({read})=>{getStructuredTextRep(fileId,read).then().catch((error=>{onError(error,constants.FOn)}))}))}),[api.options,fileExtension,fileId,getStructuredTextRep,isBoxAiSuggestionsEnabled,onError,shouldFetchStructuredTextRep]),(0,react.useEffect)((()=>{const isEditingTemplateAlreadyExisting=editingTemplate&&templateInstances.some((t=>t.templateKey===editingTemplate.templateKey&&t.scope===editingTemplate.scope));setAppliedTemplateInstances(!editingTemplate||isEditingTemplateAlreadyExisting?templateInstances:[...templateInstances,editingTemplate])}),[editingTemplate,templateInstances,templateInstances.length]);const handleCancel=()=>{clearExtractError(),setEditingTemplate(null)},visibleTemplateInstances=templateInstances.filter((templateInstance=>!templateInstance.hidden)),isSuccess=status===STATUS.SUCCESS,isLoading=status===STATUS.LOADING,isViewMode=!isLoading&&file&&templates&&templateInstances&&!editingTemplate,showEmptyState=isViewMode&&0===visibleTemplateInstances.length,showList=isViewMode&&visibleTemplateInstances.length>0,areAiSuggestionsAvailable=function isExtensionSupportedForMetadataSuggestions(extension){return SUPPORTED_FILE_EXTENSIONS.has(extension)}(file?.extension??""),metadataDropdown=isSuccess&&templates&&react.createElement(add_metadata_template_dropdown.k,{availableTemplates:templates,selectedTemplates:appliedTemplateInstances,onSelect:selectedTemplate=>{clearExtractError(),editingTemplate?(setPendingTemplateToEdit(convertTemplateToTemplateInstance(file,selectedTemplate)),setIsUnsavedChangesModalOpen(!0)):(setEditingTemplate(convertTemplateToTemplateInstance(file,selectedTemplate)),setIsDeleteButtonDisabled(!0))}}),{handleSetFilteredTemplates,filteredTemplates,templateInstancesList}=function useMetadataSidebarFilteredTemplates(history,filteredTemplateIds,templateInstances){const[filteredTemplates,setFilteredTemplates]=react.useState([]);react.useEffect((()=>{const matchingFilteredTemplateIds=templateInstances.filter((instance=>filteredTemplateIds.includes(instance.id)&&!instance.hidden)).map((instance=>instance.id));setFilteredTemplates(matchingFilteredTemplateIds)}),[filteredTemplateIds,templateInstances]);const templateInstancesList=react.useMemo((()=>{const filteredTemplateInstances=templateInstances.filter((instance=>filteredTemplates.some((template=>template===instance.id&&!instance.hidden))));return 0===filteredTemplates.length?templateInstances:filteredTemplateInstances}),[templateInstances,filteredTemplates]);return{filteredTemplates,templateInstancesList,handleSetFilteredTemplates:templateIds=>{0===templateIds.length?history.push(`/${constants.HM6}`):history.push(`/${constants.HM6}/filteredTemplates/${templateIds.join(",")}`),setFilteredTemplates(templateIds)}}}(history,filteredTemplateIds,templateInstances),filterDropdown=isSuccess&&isViewMode&&visibleTemplateInstances.length>1?react.createElement(filter_instances_dropdown.M,{appliedTemplates:visibleTemplateInstances,selectedTemplates:filteredTemplates,setSelectedTemplates:handleSetFilteredTemplates}):null,errorMessageDisplay=status===STATUS.ERROR&&errorMessage&&react.createElement(inline_error.W,{className:"bcs-MetadataSidebarRedesign-inline-error"},react.createElement(message.A,errorMessage)),taxonomyOptionsFetcher=(0,react.useCallback)(((scope,templateKey,fieldKey,level,options)=>metadataTaxonomyFetcher(api,fileId,scope,templateKey,fieldKey,level,options)),[api,fileId]),taxonomyNodeFetcher=(0,react.useCallback)(((scope,taxonomyKey,nodeID)=>metadataTaxonomyNodeAncestorsFetcher(api,fileId,scope,taxonomyKey,nodeID)),[api,fileId]);return(0,react.useEffect)((()=>{createSessionRequest&&fileId&&!isSessionInitiated.current&&(isSessionInitiated.current=!0,createSessionRequest({items:[{id:fileId}]},fileId).then((({metadata={is_large_file:!1}})=>{setIsLargeFile(metadata.is_large_file)})))}),[createSessionRequest,fileId]),react.createElement(SidebarContent.A,{actions:metadataDropdown,className:"bcs-MetadataSidebarRedesign",elementId,sidebarView:constants.HM6,title:formatMessage(messages.A.sidebarMetadataTitle),subheader:filterDropdown},react.createElement("div",{className:"bcs-MetadataSidebarRedesign-content"},errorMessageDisplay,isLoading&&react.createElement(loading_indicator.I,{"aria-label":formatMessage(messages.A.loading)}),showEmptyState&&react.createElement(metadata_empty_state.g,{level:"file",isBoxAiSuggestionsFeatureEnabled:isBoxAiSuggestionsEnabled}),react.createElement(autofill_context.Jx,{fetchSuggestions:extractSuggestions,isAiSuggestionsFeatureEnabled:isBoxAiSuggestionsEnabled},editingTemplate&&react.createElement(content_sidebar_MetadataInstanceEditor,{areAiSuggestionsAvailable,errorCode:extractErrorCode,isBetaLanguageEnabled,isBoxAiSuggestionsEnabled,isDeleteButtonDisabled,isDeleteConfirmationModalCheckboxEnabled,isLargeFile,isMetadataMultiLevelTaxonomyFieldEnabled,isUnsavedChangesModalOpen,onCancel:handleCancel,onDelete:async metadataInstance=>{try{await handleDeleteMetadataInstance(metadataInstance)}catch{}clearExtractError(),setEditingTemplate(null)},onDiscardUnsavedChanges:()=>{pendingTemplateToEdit?(setEditingTemplate(pendingTemplateToEdit),setIsDeleteButtonDisabled(!0),setPendingTemplateToEdit(null)):handleCancel(),setIsUnsavedChangesModalOpen(!1)},onSubmit:async(values,operations)=>{editingTemplate&&templateInstances.find((templateInstance=>templateInstance.id===editingTemplate.id))?await handleUpdateMetadataInstance(values.metadata,operations,(()=>setEditingTemplate(null))):await handleCreateMetadataInstance(values.metadata,(()=>setEditingTemplate(null)))},setIsUnsavedChangesModalOpen,taxonomyOptionsFetcher,template:editingTemplate,isAdvancedExtractAgentEnabled}),showList&&react.createElement(metadata_instance_list.x,{areAiSuggestionsAvailable,isAdvancedExtractAgentEnabled,isAiSuggestionsFeatureEnabled:isBoxAiSuggestionsEnabled,isBetaLanguageEnabled,onEdit:templateInstance=>{setEditingTemplate(templateInstance),setIsDeleteButtonDisabled(!1)},templateInstances:templateInstancesList,taxonomyNodeFetcher}))))}(0,performance.G)(MARK_NAME_JS_READY);const elements_content_sidebar_MetadataSidebarRedesign=flow_default()([react_router.y,(0,logger.V)(constants.A5A),(0,error_boundary.X)(constants.A5A),api_context.S])(MetadataSidebarRedesign_MetadataSidebarRedesign);try{MetadataSidebarRedesign_MetadataSidebarRedesign.displayName="MetadataSidebarRedesign",MetadataSidebarRedesign_MetadataSidebarRedesign.__docgenInfo={description:"",displayName:"MetadataSidebarRedesign",props:{api:{defaultValue:null,description:"",name:"api",required:!0,type:{name:"API"}},createSessionRequest:{defaultValue:null,description:"",name:"createSessionRequest",required:!1,type:{name:"(payload: Record<string, unknown>, fileId: string) => Promise<{ metadata: { is_large_file: boolean; }; }>"}},elementId:{defaultValue:null,description:"",name:"elementId",required:!0,type:{name:"string"}},fileExtension:{defaultValue:null,description:"",name:"fileExtension",required:!1,type:{name:"string"}},fileId:{defaultValue:null,description:"",name:"fileId",required:!0,type:{name:"string"}},filteredTemplateIds:{defaultValue:{value:"[]"},description:"",name:"filteredTemplateIds",required:!1,type:{name:"string[]"}},hasSidebarInitialized:{defaultValue:null,description:"",name:"hasSidebarInitialized",required:!1,type:{name:"boolean"}},isFeatureEnabled:{defaultValue:null,description:"",name:"isFeatureEnabled",required:!0,type:{name:"boolean"}},getStructuredTextRep:{defaultValue:null,description:"",name:"getStructuredTextRep",required:!1,type:{name:"(fileId: string, accessToken: string) => Promise<string>"}},onError:{defaultValue:null,description:"",name:"onError",required:!0,type:{name:"(error: Error, code: string, contextInfo?: Record<string, unknown>) => void"}},onSuccess:{defaultValue:null,description:"",name:"onSuccess",required:!0,type:{name:"(code: string, showNotification: boolean) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/elements/content-sidebar/MetadataSidebarRedesign.tsx#MetadataSidebarRedesign"]={docgenInfo:MetadataSidebarRedesign_MetadataSidebarRedesign.__docgenInfo,name:"MetadataSidebarRedesign",path:"src/elements/content-sidebar/MetadataSidebarRedesign.tsx#MetadataSidebarRedesign"})}catch(__react_docgen_typescript_loader_error){}},"./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[13].use[2]!./src/elements/content-sidebar/MetadataSidebarRedesign.scss":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".bcs-MetadataSidebarRedesign{border-left:1px solid var(--gray-10)}.bcs-MetadataSidebarRedesign .bcs-MetadataSidebarRedesign-content{position:absolute;top:0;right:0;left:0;padding:var(--space-4)}.bcs-MetadataSidebarRedesign .bcs-MetadataSidebarRedesign-inline-error{margin-bottom:var(--space-4)}","",{version:3,sources:["webpack://./src/elements/content-sidebar/MetadataSidebarRedesign.scss"],names:[],mappings:"AAAA,6BACI,oCAAA,CAEA,kEACI,iBAAA,CACA,KAAA,CACA,OAAA,CACA,MAAA,CACA,sBAAA,CAGJ,uEACI,4BAAA",sourcesContent:[".bcs-MetadataSidebarRedesign {\n    border-left: 1px solid var(--gray-10);\n\n    .bcs-MetadataSidebarRedesign-content {\n        position: absolute;\n        top: 0;\n        right: 0;\n        left: 0;\n        padding: var(--space-4);\n    }\n\n    .bcs-MetadataSidebarRedesign-inline-error {\n        margin-bottom: var(--space-4);\n    }\n}\n"],sourceRoot:""}]);const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___}}]);