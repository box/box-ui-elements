<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Sidebar Test Page</title>
        <style>
            body,
            html,
            .container,
            .sidebar {
                background: #ccc;
                border: 0 none;
                box-sizing: border-box !important;
                height: 100%;
                margin: 0;
                padding: 0;
                width: 100%;
            }

            .sidebar1,
            .sidebar2,
            .sidebar3 {
                height: 90%;
            }

            h4 {
                font-family: Lato,Helvetica Neue,Helvetica,Arial,sans-serif;
                text-align: center;
            }

            .container {
                display: flex;
            }

            .inputs {
                padding: 15px;
            }

            .inputs input {
                margin-bottom: 10px;
            }
        </style>
        <div class="container">
            <div class="sidebar">
                <span><h4>Active State with API Data</h4></span>
                <div class="sidebar1"></div>
            </div>
            <div class="gap">&nbsp;&nbsp;</div>
            <div class="sidebar">
                <span><h4>Active State with Dummy Data</h4></span>
                <div class="sidebar2"></div>
            </div>
            <div class="inputs">
                <div>
                    <label>
                        <div>File Id</div>
                        <input class="file" type="text" placeholder="Enter file id" />
                    </label>
                    <label>
                        <div>Auth Token</div>
                        <input class="token" type="text" placeholder="Enter auth token" />
                    </label>
                </div>
                <button type="button" onclick="load()">Submit</button>
            </div>
            </div>
        <link rel="stylesheet" type="text/css" href="../dev/en-US/sidebar.css" />
        <script src="../dev/en-US/sidebar.js"></script>
    </head>
    <body>
        <script>
            function load() {
                const { ContentSidebar } = Box;
                const token = document.querySelector('.token').value || localStorage.getItem('token');
                const fileId = document.querySelector('.file').value || localStorage.getItem('file');

                if (!token || !fileId) {
                    return;
                }

                localStorage.setItem('token', token);
                document.querySelector('.token').value = token;

                localStorage.setItem('file', fileId);
                document.querySelector('.file').value = fileId;

                const msOneDayAgo = 86400 * 1000;
                const TIME_STRING_SEPT_27_2017 = '2017-08-27T10:40:41-07:00';

                const feedState = [
                    {
                        createdAt: new Date().toISOString(),
                        id: 'bb6d6c62-f411-43e8-840f-e17bb3611d34',
                        action: 'applied',
                        type: 'keywords',
                        words: 'cartoon font logo brand clip art illustration line artwork'
                    },
                    {
                        createdAt: new Date(Date.now() - 5 * msOneDayAgo).toISOString(),
                        id: '123122432',
                        taggedMessage: '私は、これは言うことを知りません ＠[2031225629:リュ]',
                        createdBy: {
                            name: 'The man formerly known as Prince and other things',
                            id: 1
                        },
                        type: 'comment'
                    },
                    {
                        createdAt: Date.now() - 1 * msOneDayAgo,
                        id: '1231231234',
                        taggedMessage: 'An error comment',
                        isPending: true,
                        error: {
                            title: 'An error occured',
                            message: 'Stuff got fudged up, who knows what happened. Probably your fault tho...',
                            action: {
                                text: 'Fix it',
                                onAction: () => console.log('confirm')
                            }
                        },
                        createdBy: { name: 'Kanye West', id: 10 },
                        type: 'comment'
                    },
                    {
                        createdAt: Date.now(),
                        id: '148953',
                        versionNumber: 1,
                        createdBy: { name: 'Kanye West', id: 10 },
                        action: 'upload',
                        type: 'file_version'
                    },
                    {
                        createdAt: Date.now(),
                        id: '1489531',
                        versionNumber: 2,
                        createdBy: { name: 'Kanye West', id: 10 },
                        action: 'upload',
                        type: 'file_version'
                    },
                    {
                        createdAt: Date.now(),
                        id: '1489532',
                        versionNumber: 3,
                        createdBy: { name: 'Abel Tesfaye', id: 13 },
                        action: 'upload',
                        type: 'file_version'
                    },
                    {
                        createdAt: Date.now(),
                        id: '1489533',
                        versionNumber: 4,
                        createdBy: { name: 'Abel Tesfaye', id: 13 },
                        action: 'upload',
                        type: 'file_version'
                    },
                    {
                        createdAt: new Date(Date.now() - 1500 * 1000).toISOString(),
                        dueDate: Date.now(),
                        id: '123125312',
                        taggedMessage: 'Do it! Do it! Do it! Do it! Do it! Do it! Do it! Do it! .',
                        createdBy: { name: 'Aubrey Graham', id: 7 },
                        isPending: true,
                        error: {
                            title: 'An error occured',
                            message: 'Stuff got fudged up, who knows what happened. Probably your fault tho...',
                            action: {
                                text: 'Fix it',
                                onAction: () => console.log('confirm')
                            }
                        },
                        assignees: [
                            {
                                id: 0,
                                user: { name: 'Kanye West', id: 10 },
                                status: 'incomplete'
                            },
                            {
                                id: 1,
                                user: { name: 'The man formerly known as Prince and other things', id: 3 },
                                status: 'incomplete'
                            },
                            {
                                id: 2,
                                user: { name: 'Shawn Carter', id: 2 },
                                status: 'completed'
                            },
                            {
                                id: 3,
                                user: { name: 'Beyonce', id: 4 },
                                status: 'rejected'
                            }
                        ],
                        type: 'task'
                    },
                    {
                        createdAt: Date.now(),
                        dueDate: null,
                        id: '123125',
                        taggedMessage: 'Click this link http://www.google.com Also, <b>This text should not show up bold</b>',
                        createdBy: { name: 'Aubrey Graham', id: 7 },
                        assignees: [
                            {
                                id: 0,
                                user: { name: 'Kanye West', id: 10 },
                                status: 'incomplete'
                            },
                            {
                                id: 1,
                                user: { name: 'The man formerly known as Prince and other things', id: 3 },
                                status: 'incomplete'
                            },
                            {
                                id: 2,
                                user: { name: 'Shawn Carter', id: 2 },
                                status: 'completed'
                            },
                            {
                                id: 3,
                                user: { name: 'Beyonce', id: 4 },
                                status: 'rejected'
                            }
                        ],
                        type: 'task'
                    },
                    {
                        createdAt: Date.now(),
                        id: '123123',
                        taggedMessage:
                            'Hey bru, how u doing @[2030326577:Young Jeezy]? @[123:Kanye] is dope! <a href="http://www.box.com">This should not show up as a link</a>',
                        createdBy: { name: 'Kanye West', id: 2 },
                        type: 'comment'
                    },
                    {
                        createdAt: Date.now(),
                        id: '123123123',
                        taggedMessage: 'A pending comment',
                        isPending: true,
                        createdBy: { name: 'Kanye West', id: 2 },
                        type: 'comment'
                    },
                    {
                        createdAt: TIME_STRING_SEPT_27_2017,
                        dueDate: Date.now(),
                        id: '12312445',
                        taggedMessage: 'Do it! Do it! Do it! Do it! Do it! Do it! Do it! Do it! .',
                        createdBy: { name: 'Aubrey Graham', id: 7 },
                        assignees: [
                            {
                                id: 0,
                                user: { name: 'Kanye West', id: 10 },
                                status: 'incomplete'
                            },
                            {
                                id: 1,
                                user: { name: 'The man formerly known as Prince and other things', id: 3 },
                                status: 'incomplete'
                            },
                            {
                                id: 2,
                                user: { name: 'Shawn Carter', id: 2 },
                                status: 'completed'
                            }
                        ],
                        type: 'task',
                        isPending: true
                    },
                    {
                        createdAt: Date.now(),
                        id: '148954',
                        versionNumber: 1,
                        createdBy: {
                            name: 'The man formerly known as Prince and other things',
                            id: 1
                        },
                        action: 'restore',
                        type: 'file_version'
                    },
                    {
                        createdAt: Date.now(),
                        id: '14895356',
                        versionNumber: 9,
                        createdBy: { name: 'Abel Tesfaye', id: 13 },
                        action: 'upload',
                        type: 'file_version'
                    },
                    {
                        createdAt: Date.now(),
                        id: '14895357',
                        versionNumber: 7,
                        createdBy: { name: 'Abel Tesfaye', id: 13 },
                        action: 'upload',
                        type: 'file_version'
                    },
                    {
                        createdAt: Date.now(),
                        id: '14895358',
                        versionNumber: 7,
                        createdBy: { name: 'Abel Tesfaye', id: 13 },
                        action: 'upload',
                        type: 'file_version'
                    },
                    {
                        createdAt: Date.now(),
                        id: '14895359',
                        versionNumber: 6,
                        createdBy: { name: 'Abel Tesfaye', id: 13 },
                        action: 'upload',
                        type: 'file_version'
                    },
                    {
                        createdAt: Date.now(),
                        id: '14895360',
                        versionNumber: 5,
                        createdBy: { name: 'Abel Tesfaye', id: 13 },
                        action: 'upload',
                        type: 'file_version'
                    },
                    {
                        createdAt: Date.now(),
                        id: '14895361',
                        versionNumber: 4,
                        createdBy: { name: 'Abel Tesfaye', id: 13 },
                        action: 'upload',
                        type: 'file_version'
                    }
                ];

                const currentUser = { name: 'Aubrey Graham', id: '7' };

                const contacts = [
                    {
                        id: 1,
                        name: 'Ken',
                        item: { id: 1, name: 'Ken', email: 'ken@box.com' }
                    },
                    {
                        id: 2,
                        name: 'Ryu',
                        item: { id: 2, name: 'Ryu', email: 'ryu@box.com' }
                    },
                    {
                        id: 3,
                        name: 'Guile',
                        item: { id: 3, name: 'Guile', email: 'guile@box.com' }
                    },
                    {
                        id: 4,
                        name: 'Kylo Ren',
                        item: { id: 4, name: 'Kylo Ren', email: 'kren@box.com' }
                    },
                    {
                        id: 5,
                        name: 'Han Solo',
                        item: { id: 5, name: 'Han Solo', email: 'hsolo@box.com' }
                    },
                    {
                        id: 6,
                        name: 'Luke',
                        item: { id: 6, name: 'Luke', email: 'lskywalker@box.com' }
                    },
                    {
                        id: 7,
                        name: 'Yoda',
                        item: { id: 7, name: 'Yoda', email: 'yoda@box.com' }
                    },
                ];

                function getMatchingContacts(str, contacts) {
                    const matches = [];
                    contacts.forEach(function(contact) {
                        const { name, email } = contact.item;
                        if (name.toLowerCase().startsWith(str) || email.toLowerCase().startsWith(str)) {
                            matches.push(contact);
                        }
                    });
                    return matches;
                }

                const handlers = {
                    comments: {
                        create: ({ text }) => console.log(`comment create: ${text}`),
                        delete: ({ id }) => console.log(`delete comment: ${id}`),
                    },
                    tasks: {
                        create: () => console.log('task create'),
                        delete: ({ id }) => console.log(`delete task: ${id}`),
                        edit: ({ id, text }) =>
                            console.log(`edit task: ${id} with comment ${text}`),
                        onTaskAssignmentUpdate: (taskId, taskAssignmentId, status) =>
                            console.log(`task assignment update: ${status}`),
                    },
                    contacts: {
                        getApproverWithQuery: (mentionString) => {
                            console.log(`contacts get approver with query: ${mentionString}`);
                            return getMatchingContacts(mentionString, contacts);
                        },
                        getMentionWithQuery: (mentionString) => {
                            console.log(`contacts get mentions with query: ${mentionString}`);
                            return getMatchingContacts(mentionString, contacts);
                        },
                    },
                    versions: {
                        info: version => console.log('version info for version: ', version),
                    },
                };

                // Populated w/ API data
                const sidebar1 = new ContentSidebar();
                sidebar1.show(fileId, token, {
                    container: '.sidebar1',
                    hasActivityFeed: true
                });

                // Populated w/ dummy data
                const sidebar2 = new ContentSidebar();
                sidebar2.show(fileId, token, {
                    container: '.sidebar2',
                    getPreviewer: () => { return currentUser; },
                    hasActivityFeed: true,
                    activityFeedState: feedState,
                    onCommentCreate: handlers.comments.create,
                    onCommentDelete: handlers.comments.delete,
                    onTaskCreate: handlers.tasks.create,
                    onTaskDelete: handlers.tasks.delete,
                    onTaskUpdate: handlers.tasks.edit,
                    onTaskAssignmentUpdate: handlers.tasks.onTaskAssignmentUpdate,
                    getApproverWithQuery: handlers.contacts.getApproverWithQuery,
                    getMentionWithQuery: handlers.contacts.getMentionWithQuery
                });
            }
            load();

            console.log('test push');
        </script>
    </body>
</html>
